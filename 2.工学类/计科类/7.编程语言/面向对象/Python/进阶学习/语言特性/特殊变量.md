# [python中的特殊变量](https://www.cnblogs.com/lanston1/p/11013733.html "发布于 2019-06-13 00:47")

- 类似__xx，以双下划线开头的实例变量名，是一个私有变量（private），只有内部可以访问，外部不能访问；
- 类似__xx__，以双下划线开头，并且以双下划线结尾的，是特殊变量，特殊变量是可以直接访问的，它不是private变量，下面会介绍Python中的常见特殊变量；
- 类似_x，以单下划线开头的实例变量名，这样的变量外部是可以访问的，但是，按照约定俗成的规定，当你看到这样的变量时，意思就是，“虽然我可以被访问，但是请把我视为私有变量，不要随意访问”。

## 特殊变量

### __name__

- 如果直接执行某个`.py`文件的时候，这个文件里面的`__name__`就是`__main__`，如果不是直接执行，而是被另外一个`.py`文件`import`的时候，这个文件里面的`__name__`是这个`py`的文件名。
- 使用这个`__name__`可以对程序进行调试，如果说当程序之间互相之间调用，比较复杂的关系的时候，使用`if __name__ == '__main__':`将执行的代码放在里面，在执行其他的程序的时候，测试的程序本身不会运行，而这个程序有问题的时候，可以执行这个文件，那么`if __name__ == '__main__':`里面的代码就执行了。

### __doc__

获取模块注释

### __file__

当前执行文件的路径

### __cached__

对应pycache文件的位置

### __name__

执行当前文件的时候，等于__main__;否则不等于；一般在主文件里写

### __package__

模块所在package

### __all__

python模块中的__all__，可用于模块导入时限制，如：

from module import *

此时被导入模块若定义了__all__属性，则只有__all__内指定的属性、方法、类可被导入。

若没定义，则导入模块内的所有公有属性，方法和类 。

|                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11<br><br>12<br><br>13<br><br>14<br><br>15<br><br>16<br><br>17 | `# 在别的模块中，导入该模块时，只能导入__all__中的变量，方法和类`<br><br>`__all__` `=` `(``'A'``,` `'func'``)` <br><br>`class` `A():`<br><br>    `def` `__init__(``self``, name, age):`<br><br>        `self``.name` `=` `name`<br><br>        `self``.age` `=` `age`<br><br>`class` `B():`<br><br>    `def` `__init__(``self``, name,` `id``):`<br><br>        `self``.name` `=` `name`<br><br>        `self``.``id` `=` `id`<br><br>`def` `func():`<br><br>    `print``(``'func() is called!'``)`<br><br>`def` `func1():`<br><br>    `print``(``'func1() is called!'``)` |

|                                                         |                                                                                                                                                                                                                                                                                                           |
| ------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7 | `#test.py中定义了__all__属性，只能导入__all__中定义的属性，方法和类`<br><br>`from` `test` `import` `*` <br><br>`a``=``A(``'python'``,``'24'``)` <br><br>`print``(a.name,a.age)` <br><br>`func()` <br><br>`#func1() #NameError: name 'func1' is not defined` <br><br>`#b=B('python',123456) #NameError: name 'B' is not defined` |

### **__slots__**

Python允许在定义class的时候，定义一个特殊的__slots__变量，来限制该class实例能添加的属性范围

|                     |                                                                                                 |
| ------------------- | ----------------------------------------------------------------------------------------------- |
| 1<br><br>2<br><br>3 | `class` `P(``object``):`<br><br>    `__slots__` `=` `(``"name"``,` `"age"``)`<br><br>    `pass` |

### __init__()

构造函数，创建实例的时候，可以调用__init__方法做一些初始化的工作，如果子类重写了__init__，实例化子类时，则只会调用子类的__init__，此时如果想使用父类的__init__，可以使用super函数，如下：

|                                                                                     |                                                                                                                                                                                                                                                                                                                                                 |
| ----------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10 | `class` `P(``object``):`<br><br>    `def` `__init__(``self``, name, score):`<br><br>        `self``.name` `=` `name`<br><br>        `self``.score` `=` `name`<br><br>`class` `C(P):`<br><br>    `def` `__init__(``self``, name, score, age):`<br><br>        `super``(C,` `self``).__init__(name, score)`<br><br>        `self``.age` `=` `age` |

### __new__()

注意：__init__是实例创建之后调用的第一个方法，而__new__更像构造函数，它在__init__之前被调用。

另外，__new__方法是一个静态方法，第一参数是cls，__new__方法必须返回创建出来的实例。

例如，用__new__实现单例模式：

|                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ----------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11<br><br>12<br><br>13 | `class` `Singleton(``object``):`<br><br>    `def` `__new__(``cls``):`<br><br>        `# 关键在于这，每一次实例化的时候，我们都只会返回这同一个instance对象`<br><br>        `if` `not` `hasattr``(``cls``,` `'instance'``):`<br><br>            `cls``.instance` `=` `super``(Singleton,` `cls``).__new__(``cls``)`<br><br>        `return` `cls``.instance`<br><br>`obj1` `=` `Singleton()`<br><br>`obj2` `=` `Singleton()`<br><br>`obj1.attr1` `=` `'value1'`<br><br>`print``(obj1.attr1, obj2.attr1)`<br><br>`print``(obj1` `is` `obj2)` |

### __del__()

析构函数：__del__()    释放对象是自动调用

### __str__()

在调用print打印对象时自动调用，是给用户用的，是一个描述对象的方法。

###   __repr__()

是给机器用的，在Python解释器里面直接敲对象名在回车后调用的方法。（用于调试）

|   |   |
|---|---|
|1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9|`# test.py`<br><br>`class` `P(``object``):`<br><br>    `def` `__str__(``self``):`<br><br>        `return` `"__str__ called"`<br><br>    `def` `__repr__(``self``):`<br><br>        `return` `"__repr__ called"`<br><br>`p` `=` `P()`|

可以看下__str__和__repr__的区别：

|   |   |
|---|---|
|1<br><br>2<br><br>3<br><br>4<br><br>5|`>>>` `from` `test` `import` `p`<br><br>`>>> p`<br><br>`__repr__ called`<br><br>`>>>` `print` `p`<br><br>`__str__ called`|

### __enter__

### __exit__

这两个方法是用于支持with语句的上下文管理器。

例如让文件句柄支持with语法的实现：

|   |   |
|---|---|
|1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10|`class` `File``(``object``):`<br><br>    `def` `__init__(``self``, file_name, method):`<br><br>        `self``.file_obj` `=` `open``(file_name, method)`<br><br>    `def` `__enter__(``self``):`<br><br>        `return` `self``.file_obj`<br><br>    `def` `__exit__(``self``,` `type``, value, traceback):`<br><br>        `self``.file_obj.close()`<br><br>`with` `File``(``'demo.txt'``,` `'w'``) as opened_file:`<br><br>    `opened_file.write(``'Hola!'``)`|

### __iter__

### next

如果一个类想被用于`for ... in`循环，类似list或tuple那样，就必须实现一个`__iter__()`方法，该方法返回一个迭代对象，然后，Python的for循环就会不断调用该迭代对象的`next()`方法拿到循环的下一个值，直到遇到StopIteration错误时退出循环。

|   |   |
|---|---|
|1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11<br><br>12|`class` `Fib(``object``):`<br><br>    `def` `__init__(``self``):`<br><br>        `self``.a,` `self``.b` `=` `0``,` `1` `# 初始化两个计数器a，b`<br><br>    `def` `__iter__(``self``):`<br><br>        `return` `self` `# 实例本身就是迭代对象，故返回自己`<br><br>    `def` `next``(``self``):`<br><br>        `self``.a,` `self``.b` `=` `self``.b,` `self``.a` `+` `self``.b` `# 计算下一个值`<br><br>        `if` `self``.a >` `100000``:` `# 退出循环的条件`<br><br>            `raise` `StopIteration();`<br><br>        `return` `self``.a` `# 返回下一个值`|

### __call__

实例可以像函数一样调用。

|   |   |
|---|---|
|1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11|`class` `Student(``object``):`<br><br>    `def` `__init__(``self``):`<br><br>        `self``.name` `=` `"Michael"`<br><br>    `def` `__call__(``self``):`<br><br>        `print``(``'__call__ called'``)`<br><br>`s` `=` `Student()`<br><br>`s()`|

### __getitem__

### __setitem__

### __delitem__

支持下标（或切片）操作的函数

|   |   |
|---|---|
|1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11<br><br>12<br><br>13<br><br>14<br><br>15<br><br>16<br><br>17<br><br>18<br><br>19<br><br>20<br><br>21<br><br>22|`class` `Fib(``object``):`<br><br>    `def` `__getitem__(``self``, n):`<br><br>        `if` `isinstance``(n,` `int``):`<br><br>            `a, b` `=` `1``,` `1`<br><br>            `for` `x` `in` `range``(n):`<br><br>                `a, b` `=` `b, a` `+` `b`<br><br>            `return` `a`<br><br>        `if` `isinstance``(n,` `slice``):`<br><br>            `start` `=` `n.start`<br><br>            `stop` `=` `n.stop`<br><br>            `a, b` `=` `1``,` `1`<br><br>            `L` `=` `[]`<br><br>            `for` `x` `in` `range``(stop):`<br><br>                `if` `x >``=` `start:`<br><br>                    `L.append(a)`<br><br>                `a, b` `=` `b, a` `+` `b`<br><br>            `return` `L`<br><br>`fib` `=` `Fib()`<br><br>`print``(fib[``10``])`<br><br>`print``(fib[``0``:``10``])`|

### __getattr__

### __getattribute__

### __setattr__

### __delattr__

支持点操作（即 "对象.属性" 访问方式），

当访问不存在的属性时，才会使用__getattr__  方法。

|   |   |
|---|---|
|1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11<br><br>12<br><br>13<br><br>14<br><br>15<br><br>16|`class` `Student(``object``):`<br><br>    `def` `__init__(``self``):`<br><br>        `self``.name` `=` `"Michael"`<br><br>    `def` `__getattr__(``self``, attr):`<br><br>        `print` `'__getattr__ called'`<br><br>        `if` `attr``=``=``'score'``:`<br><br>            `return` `99`<br><br>        `elif` `attr``=``=``'name'``:`<br><br>            `return` `"Tom"`<br><br>`s` `=` `Student()`<br><br>`print``(s.score)`       `# 99`<br><br>`print``(s.name)`        `# Michael`|

Python的字典支持下标操作，但不支持 "." 操作，如果想让其支持，如下实现：

|                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11<br><br>12<br><br>13<br><br>14<br><br>15<br><br>16<br><br>17<br><br>18<br><br>19<br><br>20<br><br>21<br><br>22<br><br>23<br><br>24<br><br>25<br><br>26<br><br>27<br><br>28<br><br>29<br><br>30<br><br>31<br><br>32<br><br>33<br><br>34<br><br>35<br><br>36<br><br>37<br><br>38 | `class` `Storage(``dict``):`<br><br>    `__slots__` `=` `()`<br><br>    `"""`<br><br>    ``A Storage object is like a dictionary except `obj.foo` can be used``<br><br>    ``in addition to `obj['foo']`.``<br><br>        `>>> o = Storage(a=1)`<br><br>        `>>> o.a`<br><br>        `>>> o['a']`<br><br>        `>>> o.a = 2`<br><br>        `>>> o['a']`<br><br>        `>>> del o.a`<br><br>        `>>> o.a`<br><br>        `Traceback (most recent call last):`<br><br>            `...`<br><br>        `AttributeError: 'a'`<br><br>        `>>> 'b' in o`<br><br>        `False`<br><br>    `"""`<br><br>    `def` `__getattr__(``self``, key):`<br><br>        `try``:`<br><br>            `return` `self``[key]`<br><br>        `except` `KeyError, k:`<br><br>            `raise` `AttributeError(k)`<br><br>    `def` `__setattr__(``self``, key, value):`<br><br>        `self``[key]` `=` `value`<br><br>    `def` `__delattr__(``self``, key):`<br><br>        `try``:`<br><br>            `del` `self``[key]`<br><br>        `except` `KeyError, k:`<br><br>            `raise` `AttributeError(k)`<br><br>    `def` `__repr__(``self``):`<br><br>        `return` `'<Storage '` `+` `dict``.__repr__(``self``)` `+` `'>'` |