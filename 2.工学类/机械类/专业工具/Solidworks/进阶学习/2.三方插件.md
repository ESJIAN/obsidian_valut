# å¤§å›½å·¥åŒ 
# 3D Source

# SolidWorks + AI

![SolidWorks DeepSeek AI](https://i-blog.csdnimg.cn/direct/5d70dd2183434b5bba7a24976e25522d.png)

### ğŸš€ é¡¹ç›®ç®€ä»‹

**å¼€å‘ç¯å¢ƒ**ï¼šWindowsÂ 10 / Visual Studio 2017 / .Net 4.7.2 /Â [SolidWorks 2021](https://so.csdn.net/so/search?q=SolidWorks%202021&spm=1001.2101.3001.7020)

æœ¬æ•™ç¨‹ä»‹ç»å¦‚ä½•å°†Â **DeepSeek AI**Â é›†æˆåˆ°Â **SolidWorks**Â æ’ä»¶ï¼Œå®ç°Â **AI ç”Ÿæˆ VBA Macro ä»£ç **Â çš„è‡ªåŠ¨åŒ–æ“ä½œã€‚é€šè¿‡ DeepSeek AIï¼Œæ‚¨å¯ä»¥å¿«é€Ÿç”Ÿæˆé«˜æ•ˆçš„Â **VBA ä»£ç **ï¼Œæå‡Â **SolidWorks å»ºæ¨¡æ•ˆç‡**ï¼

ğŸ’¡Â **æ ¸å¿ƒåŠŸèƒ½**ï¼š

- ğŸ¤–Â **AI ç”Ÿæˆå¹¶ä¼˜åŒ– VBA ä»£ç **ï¼Œä¸€é”®è‡ªåŠ¨åŒ–
- ğŸ› Â **å†…ç½® SolidWorks UI å¯¹è¯ç•Œé¢**ï¼Œæ— ç¼é›†æˆ
- ğŸ”‘Â **æ”¯æŒ API Key é…ç½®**ï¼Œä¸ªæ€§åŒ–æ™ºèƒ½å¯¹è¯

---

### ğŸ“Œ 1. ç”³è¯· DeepSeek API Key

1. è®¿é—®Â **[DeepSeek API Key é¡µé¢](https://platform.deepseek.com/api_keys)**ã€‚
2. ç”Ÿæˆå¹¶å¤åˆ¶Â **API Key**ï¼Œç”¨äºæ’ä»¶è°ƒç”¨ã€‚

---

### ğŸ— 2. åˆ›å»º SolidWorks AI æ’ä»¶

#### ğŸ”¹ 2.1 åœ¨ SolidWorks ä¾§è¾¹æ åˆ›å»º DeepSeek äº¤äº’ UI

ä½¿ç”¨Â `CreateTaskpaneView2 Method (ISldWorks)`Â **åˆ›å»º Taskpane**Â ä¾§è¾¹æ ã€‚

**ğŸ“Œ ä¾èµ–åº“ï¼ˆéœ€å¼•ç”¨ï¼‰ï¼š**

- SolidWorks.Interop.sldworks.dll
- SolidWorks.Interop.swpublished.dll

##### âœ… TaskpaneIntegration.cs

```csharp
using SolidWorks.Interop.sldworks;
using SolidWorks.Interop.swpublished;
using System;
using System.IO;
using System.Runtime.InteropServices;

namespace Solidworks.DeepSeekAI
{
    public class TaskpaneIntegration : ISwAddin
    {
        private int mSwCookie;
        private TaskpaneView mtaskpaneView;
        private TaskpaneHostUI mtaskpaneHost;
        public static SldWorks mSolidWorksApplication;
        
        public const string SWTASKPANE_PROGID = "Solidworks.DeepSeekAI.Taskpane";

        public bool ConnectToSW(object ThisSW, int Cookie)
        {
            mSolidWorksApplication = (SldWorks)ThisSW;
            mSwCookie = Cookie;
            mSolidWorksApplication.SetAddinCallbackInfo2(0, this, mSwCookie);
            LoadUI();
            return true;
        }

        public bool DisconnectFromSW()
        {
            UnloadUI();
            return true;
        }

        private void LoadUI()
        {
            string dllPath = Path.GetDirectoryName(
                typeof(TaskpaneIntegration).Assembly.CodeBase
            ).Replace(@"file:\", string.Empty);
            var imagePath = Path.Combine(dllPath, "deepseek_logo_16x.png");
            mtaskpaneView = mSolidWorksApplication.CreateTaskpaneView2(
                imagePath, "Solidworks.DeepSeekAI"
            );
            mtaskpaneHost = (TaskpaneHostUI)mtaskpaneView.AddControl(SWTASKPANE_PROGID, string.Empty);
        }

        private void UnloadUI()
        {
            mtaskpaneHost = null;
            mtaskpaneView.DeleteView();
            Marshal.FinalReleaseComObject(mtaskpaneView);
            mtaskpaneView = null;
        }
    }
}
```

---

#### ğŸ”¹ 2.2 AI è‡ªåŠ¨ç”Ÿæˆ VBA ä»£ç 

ğŸ’¡Â **åŠŸèƒ½ç‚¹**ï¼š

- è¯»å– API Key
- å‘é€ç”¨æˆ·è¾“å…¥åˆ° DeepSeek AI
- è·å– AI ç”Ÿæˆçš„ VBA ä»£ç 
- è¿”å›ç»“æœå¹¶æ˜¾ç¤ºåˆ° UI

ğŸ“ŒÂ **å®‰è£… NuGet åŒ…**ï¼ˆéœ€å®‰è£…ï¼‰ï¼š

- Newtonsoft.Json
- SunnyUIï¼ˆå¯é€‰ï¼‰

##### âœ… TaskpaneHostUI.cs

```csharp
using System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Net.Http;
using Newtonsoft.Json;

namespace Solidworks.DeepSeekAI
{
    [ProgId(TaskpaneIntegration.SWTASKPANE_PROGID)]
    public partial class TaskpaneHostUI : UserControl
    {
        private async void btnSend_Click(object sender, EventArgs e)
        {
            string apiKey = Utility.ReadRegistryKey();
            if (string.IsNullOrEmpty(apiKey))
            {
                MessageBox.Show("è¯·å…ˆé…ç½® API Keyï¼", "æç¤º", MessageBoxButtons.OK, MessageBoxIcon.Asterisk);
                return;
            }
            string userInput = TxtInput.Text.Trim();
            if (string.IsNullOrEmpty(userInput))
            {
                MessageBox.Show("è¯·è¾“å…¥å†…å®¹ï¼");
                return;
            }
            AppendMessage("æˆ‘", userInput);
            string aiResponse = await GetAIResponse(userInput);
            TxtInput.Clear();
            AppendMessage("AI", aiResponse);
        }
    }
}
```

---

#### ğŸ”¹ 2.3 è®¾ç½® DeepSeek API Key

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/36f355854d754aaaa559e73769d89f70.png)

è‹¥è¦æä¾›ä¸€ä¸ªé…ç½®çª—å£ï¼Œå¯åœ¨æŒ‰é’®äº‹ä»¶ä¸­è°ƒç”¨Â `OptionsForm`ï¼ˆæˆ–ç±»ä¼¼çš„è‡ªå®šä¹‰çª—ä½“ï¼‰ï¼Œåœ¨å…¶ä¸­è¯»å–å¹¶æ›´æ–°æ³¨å†Œè¡¨ä¿¡æ¯ã€‚  
ç”¨æˆ·å¯ä»¥åœ¨é€‰é¡¹è¡¨å•ä¸­ï¼Œå°†ç”Ÿæˆçš„ API Key å­˜å‚¨åˆ°æ³¨å†Œè¡¨ã€‚ç¤ºä¾‹ï¼š

##### âœ… OptionsForm.cs

```csharp
using Sunny.UI;
using System;
using System.Windows.Forms;

namespace Solidworks.DeepSeekAI
{
    public partial class OptionsForm : UIForm
    {
        public OptionsForm()
        {
            InitializeComponent();

            txtApiKey.Text = Utility.ReadRegistryKey();
        }

        private void btnSave_Click(object sender, EventArgs e)
        {
            if (txtApiKey.Text != "")
            {
                Utility.CreateRegistryKey(txtApiKey.Text);
                MessageBox.Show("API Keyé…ç½®å®Œæˆï¼", "æç¤º", MessageBoxButtons.OK, MessageBoxIcon.Asterisk);
                this.Close();
            }
            else
            {
                MessageBox.Show("è¯·å¡«å†™æ­£ç¡®çš„API Keyï¼", "æç¤º", MessageBoxButtons.OK, MessageBoxIcon.Asterisk);
            }
        }
    }
}

```

##### âœ… Utility.cs

```csharp
using Microsoft.Win32;

namespace Solidworks.DeepSeekAI
{
    public class Utility
    {
        // åˆ›å»ºå¹¶å†™å…¥ API Key
        public static void CreateRegistryKey(
            string ApiKey,
            string path = @"SOFTWARE\Solidworks.DeepSeekAI\Settings")
        {
            var key = Registry.CurrentUser.CreateSubKey(path);
            key.SetValue("API_Key", ApiKey);
            key.Close();
        }

        // è¯»å– API Key
        public static string ReadRegistryKey(
            string path = @"SOFTWARE\Solidworks.DeepSeekAI\Settings")
        {
            var key = Registry.CurrentUser.OpenSubKey(path, false);
            return key?.GetValue("API_Key") as string ?? string.Empty;
        }
    }
}
```

---

### ğŸ›  3. SolidWorks AI æ’ä»¶å®‰è£… & å¸è½½

ğŸ“ŒÂ **æ³¨å†Œæ’ä»¶ï¼ˆç®¡ç†å‘˜èº«ä»½è¿è¡Œ Register.cmdï¼‰**

```cmd
"%windir%\Microsoft.NET\Framework64\v4.0.30319\RegAsm.exe" /codebase "%~dp0Solidworks.DeepSeekAI.dll"
```

ğŸ“ŒÂ **å¸è½½æ’ä»¶ï¼ˆç®¡ç†å‘˜èº«ä»½è¿è¡Œ Unregister.cmdï¼‰**

```cmd
"%windir%\Microsoft.NET\Framework64\v4.0.30319\RegAsm.exe" /codebase "%~dp0Solidworks.DeepSeekAI.dll" /u
```

---

### ğŸ¯ 4. AI è‡ªåŠ¨ç”Ÿæˆ SolidWorks VBA å®

ğŸ“ŒÂ **ç›®æ ‡**ï¼š  
è‡ªåŠ¨åˆ›å»ºÂ **ç›´å¾„ 20mmï¼Œé•¿åº¦ 100mm**Â çš„Â **åœ†æŸ±ä½“**ï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•ã€‚

##### âœ… ç”Ÿæˆçš„ VBA ä»£ç 

```vba
Option Explicit

Sub CreateCylinder()
    Dim swApp As SldWorks.SldWorks
    Dim swModel As SldWorks.ModelDoc2
    Dim swSketchMgr As SldWorks.SketchManager
    Dim swFeatMgr As SldWorks.FeatureManager
    
    Set swApp = Application.SldWorks
    Set swModel = swApp.NewDocument("C:\\...\\part.prtdot", 0, 0, 0)
    Set swSketchMgr = swModel.SketchManager
    Set swFeatMgr = swModel.FeatureManager
    
    swModel.ClearSelection2 True
    swModel.Extension.SelectByID2 "å‰è§†åŸºå‡†é¢", "PLANE", 0, 0, 0, False, 0, Nothing, 0
    swSketchMgr.InsertSketch True
    swSketchMgr.CreateCircle 0#, 0#, 0#, 0.01, 0#, 0#
    swSketchMgr.InsertSketch True
    swFeatMgr.FeatureExtrusion2 True, False, False, 0, 0, 0.1, 0.01, False
    swModel.SaveAs3 "D:\\Cylinder.SLDPRT", 0, 2
    MsgBox "åœ†æŸ±åˆ›å»ºæˆåŠŸï¼"
End Sub
```

---

### âš  5. é‡è¦æç¤º

1. **ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ SolidWorks**ï¼Œé¿å…æ’ä»¶åŠ è½½å¤±è´¥ã€‚
2. **ä¿æŒç½‘ç»œè¿æ¥**ï¼ŒDeepSeek AI éœ€è¦ API è®¿é—®ã€‚
3. **ç¡®ä¿ API Key å¯ç”¨**ï¼Œé¿å…è°ƒç”¨å¤±è´¥ã€‚

ğŸ”¥ é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²æˆåŠŸå°†Â **AI æ™ºèƒ½åŒ–è‡ªåŠ¨ç¼–å†™ VBA ä»£ç **Â åº”ç”¨äºÂ **SolidWorks**ï¼Œå¤§å¤§æå‡å»ºæ¨¡æ•ˆç‡ï¼

ğŸ¯Â **å¿«æ¥è¯•è¯•ï¼Œè®© SolidWorks æ’ä»¶æ›´æ™ºèƒ½ï¼**Â ğŸš€