
首先我们扩展认知，一个电路系统上同一条支路上的电流利用傅里叶变换可以分解成很多个电流相量，这些电流相量有些是我们想要的有些是我们不想要的。而电容对不同电流相量的阻抗是不一样的，这样可以使得一些电流相量被某处的电流给过滤掉。





# 1. 去耦电容、旁路电容

## 1.1. 引言与问题提出

**1.【背景引入】**
- 在查看CAN总线资料时，注意到TJA1050 CAN收发器电源管脚外接了一个电容到地。联想到同事提到的布线建议（电源先接电容再接芯片管脚）。
- 示例电路：
    ![CAN收发器电源引脚电容](http://file.elecfans.com/web1/M00/5C/42/pIYBAFtzgqOAIYnqAAAvyJq8FKI397.jpg)

**2.【核心疑问】**
- 这个电容的作用是什么？
- 为什么常选用0.1uF？这个值有特定要求吗？
- 了解到它有时被称为“旁路电容”，有时被称为“去耦电容”、“退耦电容”。

## 1.2. 定义与区分

**1.【基本定义】**
- **旁路电容 (Bypass Capacitor)**：主要滤除输入信号中的高频噪声成分，为本地器件提供能量。
- **去耦电容 (Decoupling Capacitor)**：也称退耦电容，主要滤除输出信号的干扰，或抑制器件自身产生的高频噪声，防止其通过电源线传播。

**2.【核心区别与联系】**
- **目标对象**：旁路针对输入端噪声，去耦针对器件本身产生的噪声及对电源的影响。
- **本质作用**：两者都是起到抗干扰的作用。电容所处的位置不同，称呼就不一样了。实际应用中，尤其是在IC电源引脚附近的电容，往往同时起到旁路和去耦的作用。
- **典型容值差异**：高频旁路/去耦电容一般比较小（如0.1uF, 0.01uF），用于滤除高频噪声；而用于储能或滤除低频噪声的去耦电容（有时也称Bulk电容）一般比较大（如10uF或更大）。
- **概念图示**：
    ![旁路与去耦概念图](https://www.helloimg.com/i/2024/12/09/6756a54537cfc.jpg)

## 1.3. 主要作用

**1.【噪声滤波与抗干扰】**
- **滤除电源线噪声**：电力线像天线会拾取高频(HF)噪声，电容提供高频噪声到地的低阻抗路径，将其短路。
- **抑制器件自身噪声**：有源器件（特别是数字IC）在开关时会产生高频开关噪声，去耦电容将其就近引导到地，减少在板上的传播，防止影响其他电路。
- **消除自激 (放大电路)**：去耦电容用在放大电路中不需要交流的地方，可以消除自激，使放大器稳定工作。

**2.【局部储能与稳定电压】**
- **提供瞬时电流**：高频器件工作时电流需求不连续且频率高。电源路径存在阻抗（特别是电感 $Z=i\omega L+R$），导致远端电源响应慢。去耦电容作为局部的直流电源（类似小电池），可以快速提供瞬时大电流，弥补此不足。
- **稳定电压/防止耦合干扰**：
    - **电压稳定**：补偿IC工作或负载变化（如驱动大电容负载充放电）时引起的电源电压跌落（ΔU），维持电压在允许误差范围内。
    - **减少耦合**：避免因瞬态大电流通过电源线产生的电压噪声（尤其由引脚电感引起的反弹）影响前级或其他电路的正常工作。

**3.【作用总结】**
- 去耦电容在IC电源和地之间主要有两个作用：
    - **蓄能电容**：提供和吸收IC开关瞬间的充放电能量。
    - **旁路高频噪声**：滤除器件自身产生的高频噪声。
- 简单总结：去耦电容和旁路电容都是起到抗干扰的作用。旁路侧重滤除输入端噪声，去耦侧重滤除输出端或器件自身噪声。

# 2. IC 去耦的必要性与效果

## 2.1. 为何IC需要独立去耦

**1.【保证高频输入输出】**
- 这是IC需要自身去耦电容的核心原因之一。

**2.【双重防护机制】**
- **防止外部噪声影响**：防止电源线上的高频噪声影响IC本身性能。
- **防止自身噪声传播**：防止IC产生的噪声通过电源线影响其它电路性能。

**3.【线路电感影响】**
- **高频阻抗**：即使很短的导线或PCB走线（如1cm ≈ 8nH）在高频下也具有显著电感，使得电源远端难以形成对高频噪声的有效短路。
- **靠近放置的必要性**：为实现有效的高频短路，去耦电容必须非常靠近IC的电源和地引脚，以最小化引线和走线电感。
- **天线效应**：长引线不仅电感大，还会充当天线，辐射或拾取噪声。

**4.【地线处理】**
- IC可能有多个地引脚，必须用宽的、低电感的走线将它们连接在一起，形成单个低阻抗等电位星型接地点。

## 2.2. 去耦效果实例

**1.【稳定性与瞬态响应改善】**
- **无去耦**：缓冲电路驱动R-C负载时，输出信号可能包含高频振荡（如示例中的3.8MHz）。放大器可能表现出稳定性低、瞬态响应差、启动故障等问题。
- **有去耦**：输出信号稳定。
- **测量结果对比**：
    ![带去耦与不带去耦的缓冲电路输出](http://file.elecfans.com/web1/M00/5C/43/pIYBAFtzgqOAWUTrAACFM5HctbQ227.jpg)

**2.【瞬态电流供应能力】**
- **无去耦**：电源线迹的电感限制了瞬态电流供应。器件内部节点电压可能下垂（干扰），导致工作不连续（内部节点未正确偏置）。
- **有去耦**：靠近器件的电容因路径电感小，可在极短时间内提供超大瞬态电流。
- **电流波形对比**：
    ![带去耦与不带去耦情况下的电流](http://file.elecfans.com/web1/M00/5C/43/pIYBAFtzgqSAb5LGAAB9AvYJ1ZA957.jpg)

# 3. 设计与实现考量

## 3.1. 电容选择

### 3.1.1. 容值确定

**1.【经验法则与典型值】**
- **数字电路**：IC电源引脚旁典型的去耦电容值为 0.1μF (100nF)。
- **微控制器系统**：取 0.1μF ~ 0.01μF 之间都可以。
- **通用经验**：如果没有Datasheet推荐值，可以使用 0.1uF。

**2.【频率估算法】**
- 可按 $C \approx 1/f$ 估算（f为目标频率）。
    - 例如：10MHz 取 0.1μF，100MHz 取 0.01μF。

**3.【基于电压跌落计算】**
- **公式**：$C \cdot \Delta U = I \cdot \Delta t$
    - $C$：所需电容量 (F)
    - $\Delta U$：允许的电源总线电压最大降低值 (V)
    - $I$：最大瞬时电流需求 (A)
    - $\Delta t$：电流持续时间 (s)
- **目标**：不论IC电流波动如何，都要使电压维持在允许误差范围内。

**4.【基于功耗计算 (某公司推荐方法)】**
- **步骤1：计算等效开路电容 $C_{eq}$**
    - $C_{eq} = P / (f \cdot U^2)$
        - $P$：IC总功耗 (W)
        - $U$：IC最大DC供电电压 (V)
        - $f$：IC时钟频率 (Hz)
- **步骤2：计算总去耦电容 $C_{total}$**
    - $C_{total} \gg C_{eq} / m$ （远大于 $C_{eq}$ 除以允许电压变化百分比 $m$）
        - $m$：允许的电源电压最大变化百分数（通常由IC数据手册给出）。
- **步骤3：计算单个电容值**
    - $C_{pin} \approx C_{total} / (\text{连接到该电源总线的电源引脚总数})$

### 3.1.2. 多容值组合策略

**1.【原因：宽带低阻抗】**
- 单个电容由于存在ESL（等效串联电感）和ESR（等效串联电阻），只在自身谐振频率(SRF)附近呈现最低阻抗。
- 使用不同容值（通常相差几个数量级，如0.01uF, 0.1uF, 10uF）的电容并联组合，可以分散谐振点，从而在更宽的频率范围内获得较低的整体阻抗。

**2.【电容频率特性】**
- **谐振现象**：电容与其ESL形成LC串联谐振电路。
    - 低于SRF：呈容性。
    - 高于SRF：呈感性，失去去耦效果。
- **阻抗曲线**：
    ![电容阻抗频率特性曲线](http://file.elecfans.com/web1/M00/5C/43/pIYBAFtzgqWAHiDWAABMwlyPKdQ395.jpg)
- **SRF与容值/封装关系**：容值越小、封装越小（ESL越小），SRF越高。
    - **示例SRF表**：
        ![不同容值和封装电容的谐振频率](http://file.elecfans.com/web1/M00/5C/43/pIYBAFtzgqaABoXrAAB6o2l8X3w226.jpg)

### 3.1.3. 关键参数考量

**1.【ESL (等效串联电感)】**
- **影响**：决定高频性能，限制SRF。越小越好。
- **来源**：电容内部结构、引脚、焊盘、走线。
- **降低方法**：
    - 选用小封装电容。
    - 使用低电感电容（如反向几何电容）。
    - 多个电容并联。
    - 优化布局（如将两个电容反向放置，抵消磁通量 - 注意专利）。

**2.【ESR (等效串联电阻)】**
- **影响**：决定谐振点阻抗和高频阻抗。越小越好。
- **重要性**：对于数字电路去耦，低ESR比高SRF更重要，因为它能在电容呈感性时仍提供较低的到地阻抗通路。
- **类型差异**：陶瓷电容通常ESR较低。

### 3.1.4. 数量选择

**1.【理想情况】**
- 每个IC电源引脚配置一个0.01μF (或0.1μF) 的陶瓷去耦电容。

**2.【实际考量与依据】**
- **空间限制**：若空间不足，可适当削减数量。
- **引脚分布**：IC设计时常将几个电源引脚放在一起，这些引脚可以共用去耦电容。
- **经验规则**：
    - 每4~10个芯片配置一个1μF~10μF的钽电容（低漏电流，500kHz~20MHz阻抗低）。
    - 每10片左右IC加一个10μF左右的充放电电容（蓄能电容）。
- **实例**：Freescale iMX233 PDK原理图中，SDRAM有15个电源引脚，但配置了10个去耦电容。

### 3.1.5. 电容类型选择

**1.【高频去耦 (靠近IC)**】
- **首选**：陶瓷电容（MLCC - 多层陶瓷电容），因其高频特性好、ESL/ESR低。常用值0.1uF, 0.01uF。
- **备选**：聚碳酸酯电容。

**2.【中低频/储能 (Bulk电容)**】
- **常用**：钽电容（体积小、容量/电压比高、漏电流小、中频特性好）。常用值1μF, 10μF。
- **次选**：电解电容（容量大、成本低），但高频时表现为电感（卷绕结构），ESR较高。通常用于电源入口处（10μF~100μF）。

## 3.2. PCB 布局布线

### 3.2.1. 摆放原则 (Placement Principles)

**1.【靠近原则 (Proximity)】**
- **核心**：去耦电容必须尽可能靠近IC的电源引脚和地引脚。
- **原因**：减小连接路径的电感和电阻，提高去耦效率。
- **顺序**：容值最小（SRF最高，去耦半径最小）的电容放在最靠近芯片的位置；容值稍大的可稍远；容值最大的（Bulk电容）可放在最外层或电源入口处。但所有用于该芯片去耦的电容都应尽量靠近。

**2.【均匀分布 (Uniform Distribution)】**
- 电容（尤其是同一容值等级的）最好均匀分布在芯片的四周。
- **原因**：IC电源/地引脚通常均匀分布，电压扰动也可能发生在芯片各处，需要对整个区域均匀去耦。

**3.【分类放置 (Categorized Placement)】**
- **整体去耦 (Bulk/Bypass)**：又称旁路电容。通常是较大容值（如10μF~100μF电解或钽电容），放置在PCB电源入口处或电源线密度高的地方。工作于低频(<1MHz)，为整个电路板提供电流源，补偿ΔI噪声。
- **局部去耦 (Local Decoupling)**：放置在每个IC的电源和地引脚之间，尽量靠近。主要作用是功能性（稳定局部电压）和EMC（提供高频电流通路，减小辐射环路，抑制阻抗耦合）。常用0.1uF/0.01uF陶瓷电容。
- **板间去耦 (Interplane Capacitance)**：指电源层和地层之间的电容。是高频去耦电流的重要来源。可通过增大层间面积、优化层叠设计来增加。

### 3.2.2. 去耦半径 (Decoupling Radius)

**1.【概念引入】**
- **问题**：为什么电容要就近摆放？仅仅是为了减小电感吗？
- **答案**：除了减小电感，还有一个重要原因是“去耦半径”。超出半径，电容将失效。

**2.【原理：相位关系】**
- 芯片产生电压扰动 -> 信号传播到电容 (有延迟) -> 电容感知并发出补偿电流 -> 补偿电流传播回扰动区 (有延迟)。
- 这导致噪声源与补偿电流之间存在相位差。
- 距离 $R$ 处的补偿电流相位 $\phi \propto R / \lambda$，其中 $\lambda$ 是对应电容自谐振频率 $f$ 的波长 ($\lambda = v/f$, $v$ 是传播速度)。
- 当距离 $R = \lambda/4$ 时，相位差为 $\pi$ (180度)，补偿电流完全反相，去耦失效。

**3.【有效半径估算】**
- 为有效传递能量，相位差应尽可能小（最好同相）。
- 要求距离 $R \ll \lambda/4$。
- **经验数据**：有效去耦半径 $R_{eff} \approx \lambda / 40 \sim \lambda / 50$。

**4.【计算示例与意义】**
- **示例**：0.001uF陶瓷电容，ESL=1.6nH，SRF=125.8MHz。若板上传播速度 $v=166 \text{ ps/inch}$，则 $\lambda = v/f \approx 47.9 \text{ inch}$。去耦半径 $R_{eff} \approx 47.9/50 \approx 0.958 \text{ inch} \approx 2.4 \text{ cm}$。
- **结论**：
    - 小电容（高SRF，短波长）去耦半径小，必须紧靠芯片放置。
    - 大电容（低SRF，长波长）去耦半径大，放置位置相对不敏感。

### 3.2.3. 安装与过孔 (Installation & Vias)

**1.【目标：最小化回路电感】**
- 电容焊盘 -> 引出线 -> 过孔 -> 电源/地平面 -> IC引脚 -> ... 构成的环路面积要最小。

**2.【过孔放置策略 (Via Placement Strategies)】**
- **糟糕**：从焊盘引出长线再接远处过孔（电感大，避免）。
- **可接受**：在焊盘两端紧邻焊盘打孔（回路面积减小）。
- **较好**：在焊盘侧面打孔（回路面积更小）。
- **最佳**：在焊盘两侧各打一个孔（相当于并联过孔，电感最小）。
- **需谨慎**：在焊盘上直接打孔（Via-in-Pad，电感最小，但需考虑焊接工艺）。
- **推荐**：侧面打孔或两侧打孔。
- *(注：原笔记中图16、17、18缺失或链接失效，此处根据文字描述)*

**3.【引线处理 (Trace Handling)】**
- 从焊盘到过孔的引出线应**短而宽**（尽量与焊盘同宽，如20mil宽用于0402封装）。宽线电感小。

**4.【禁止事项 (Don'ts)】**
- **共用过孔**：任何情况下都不要让多个电容使用公共过孔，这会增加电感并可能引入耦合。应优化设计减少电容数量，或为每个电容分配独立过孔。
- **焊盘间打孔 (小尺寸)**：禁止在小尺寸电容（如0402）的两个焊盘之间打孔，容易引起焊接短路。
- **长引线**：避免从焊盘引出很长的引出线再去连接过孔。

**5.【大电容安装 (Large Capacitor Installation)】**
- 对于板级滤波用的大尺寸电容（如钽电容），推荐特定的安装方式（*原笔记图18缺失*）。

# 4. 总结 (Summary)

**1.【核心考量因素】**
- 综上所述，在选择和使用去耦电容时，需要综合考虑以下关键因素：
    - **电容参数**：ESR（等效串联电阻）、ESL（等效串联电感）值及其对阻抗和高频性能的影响，以及电容的自谐振频率（SRF）。
    - **容值与组合**：根据滤波需求、频率范围选择合适的容值，并常常采用不同容值的组合以拓宽有效去耦频带。
    - **数量**：根据IC电源引脚数目、布局空间、引脚分布以及经验规则来确定所需去耦电容的数量。
    - **布局位置**：必须根据去耦半径（尤其是对高频小电容）将电容尽可能靠近IC电源和地引脚放置，并考虑均匀分布。
    - **安装方式**：采用低电感的安装方式，优化焊盘、引出线和过孔的设计，以最小化寄生电感。