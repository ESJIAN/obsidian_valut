# 1. 为什么学习Linux开发
本章主要从Linux的应用场景，程序员的技能学习，职业方向来 讨论为什么需要学习Linux开发并对如何学好Linux开发提出了一些建议。

## 1.1. Linux的应用场景

对于一般用户来说，因为经常接触PC、手机，可能会知道Windows、iOS、Andorid系统， 但对Linux系统却知之甚少，这是因为Linux的应用场景主要是服务器和嵌入式设备， 在直面消费者的桌面系统领域并不占据优势。不过，从某种程度来说， Android系统也属于Linux的一种，毕竟它是基于Linux内核进行开发的， 只是由于它规避了Linux的开源协议，不被Linux社区接纳。

Linux的应用场景主要是由其特点决定的，其特点主要有：开源、安全、稳定、网络功能强大、 支持多种不同平台的处理器。

### 1.1.1. 服务器

服务器是指提供计算服务的设备，如网页服务器、文件服务器、数据库服务器、邮件服务器、 域名服务器和代理服务器等。可以说我们在互联网上的所有操作，背后都是在跟服务器打交道。 例如我们访问网页、网上购物、微信聊天、运行网络游戏、观看在线视频等一切需要联网才能正常进行的应用， 其背后都由服务器作为支撑。

服务器的实体各种各样，小到单板电脑，大至计算机集群，实际上你正在使用的个人电脑， 安装上对应的服务软件，通过网络给其它计算机提供资源，它也就变身成了一个服务器。 服务器的本质也是计算机，只是通常来说它们没有显示器，不需要鼠标键盘。

在商业应用中，在服务器运行的操作系统主要有Linux、Windows和UNIX，其中由于Linux系统开源、 使用成本低而且安全稳定，所以Linux在服务器使用的系统中占据了绝大多数。

感兴趣的读者可以访问Netcraft 网站 [http://www.netcraft.com](http://www.netcraft.com/)， 可以查询到其它网站是运行在什么操作系统上的，具体见下图。

![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/whylea002.png)![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/whylea003.png)

可以查询到绝大部分知名网站都运行在Linux系统之上，包括微软官网：www.microsoft.com。 而国内的一些银行官网则通常使用Windows Server系统。

特别地，超级计算机也是特殊的服务器，目前全球TOP500的计算机运行的操作系统都是Linux。

### 1.1.2. 嵌入式设备

嵌入式设备是Linux系统的另一个主战场，这也是本书主要讲解的Linux应用方向。 嵌入式设备的定义比较模糊，不过基本上把PC、集群服务器、超级计算机排除后， 具有处理器（包括微控制器等）的，按设定程序运行的电子设备大都可以归类为嵌入式设备。

嵌入式设备种类非常丰富，包括日常生活中的手机、智能手表、各种家电、玩具、路由器、车载电子系统， 工业应用中包括电力系统监控、环境监测、工业机器人、智能快递柜、手持POS机、 地铁闸机系统、停车场管理、卫星、月球车等。

从嵌入式设备的种类就可以知道它们的应用场景是碎片化的， 它们内部的电子系统一般会针对设备的功能做专用的控制。部分嵌入式设备不使用操作系统； 部分使用freeRTOS等实时操作系统；而另一些高性能的嵌入式设备使用Linux系统。 使用Linux系统的的嵌入式设备，往往是看中Linux系统的如下特性：

- 嵌入式设备使用的处理器多种多样，而Linux系统支持运行在x86、ARM、PowerPC、 MIPS等不同平台的处理器上。
    
- 由于代码开源，可裁剪，非常适合针对特定场景进行定制，裁剪后的Linux内核加上文件系统可以做到50MB以内， 这能够节省硬件资源和成本。
    
- 对各种编程语言、类库、编程框架支持良好，如python、java、C++等编程语言， Opencv、TensorFlow等类库和框架，使用freeRTOS等实时操作系统往往很难做到直接支持。
    
- 应用程序丰富，如音乐播放器、数据库等现成的应用可以直接使用。
    
- 网络功能强大，使得编写需要联网的应用程序非常方便。
    

## 1.2. Linux职业方向

根据Linux的应用场景，社会对Linux技术人员主要分为服务器运维、应用软件开发及设备驱动开发方向。

### 1.2.1. 服务器运维

服务器运维工程师主要是负责搭建起运行环境，让服务器应用程序更高效、稳定、安全地运行在服务器上。 如安装操作系统、部署代码运行环境、修复漏洞、监控服务器压力、分析日志等。

### 1.2.2. 应用软件开发

Linux应用软件开发就是开发基于Linux系统的应用程序。具体而言，应用程序也分服务器、 桌面和嵌入式方向，服务器方向如网站后台、数据库系统等。 服务器方向的应用程序开发通常跟操作系统的关系并不是很大； 桌面开发就如同开发Windows系统下的QQ、WPS、串口调试助手等应用程序； 嵌入式方向的软件方向主要是针对设备应用场景做针对性的开发，如扫地机器人、路由器的控制程序等。

### 1.2.3. 设备驱动开发

设备驱动，它的本质也是软件程序，不过它介于硬件与操作系统之间的层级，是硬件和操作系统之间的桥梁， 具体见下图。

![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/whylea004.png)

对于不使用操作系统或使用小型实时操作系统（如freeRTOS）的设备来说， 与硬件相关的驱动程序与应用程序往往混合在一起，因此常常不会对驱动与应用进行严格的区分， 这也导致更换硬件平台时，应用程序移植困难。

使用了Linux系统的设备，硬件会由操作系统接管。Linux系统的一个重要设计哲学是一切皆文件。 包括硬件设备，对于系统来说也是一个文件，所以系统向上层应用程序提供open、write、read、close等统一的文件操作接口， 应用程序可以利用这些接口对设备文件进行访问，从而实现对硬件设备的初始化、写入、读取以及关闭等操作。

当系统接收到应用程序的这些访问请求时，它会向下查询对应设备具体的操作函数，然后调用相应的函数处理请求， 而这些针对不同设备具体的操作函数就是设备驱动程序。因此，设备驱动就是这样一种把硬件与操作系统连接在一起的程序， Linux系统会提供统一的格式，设备驱动开发工程师根据具体的设备按照系统格式要求实现相应的设备操作函数。

本书主要针对嵌入式设备驱动开发的讲解，对于志在应用软件开发的工程师， 也可通过本书的内容掌握Linux底层的相关知识，这对应用开发也是大有裨益。

## 1.3. 程序员的宝库

Linux可谓是公开的宝库，它是开源世界的代表作，它的内核源代码是完全公开的， 只要你愿意沉浸其中，必定收获丰富。通过学习Linux开发，会熟悉命令行的使用； 可以了解到操作系统原理；学习常用数据结构，如链表、红黑树、哈希表等；了解开源社区的文化，学习各自优秀的代码实现， 如常用的C语言库libc等；熟悉各种常用开发工具，如Git版本管理系统、GCC编译器。

并不是说从事传统MCU开发或Windows开发时不能学习到这些，只是这些内容往往被包装起来， 要么直接无法追根溯源，要么隐藏起来了。但在进行Linux开发时，相关的内容是直接暴露给用户的， 只要钻得够深，永远有惊喜等待着我们。例如，使用Keil或IAR开发时，我们不知道调用C语言库的printf函数后， 具体究竟执行了什么；点击编译按钮时，集成的工具又为我们处理了一些什么内容，这些我们都很难了解到。

对于长期从事MCU开发的程序员来说，学习Linux开发会让人感叹，原来代码的世界一直在这里等着我！

## 1.4. 推荐书单
- 《只是为了好玩》/《Just For Fun》，Linus的自传，通过它可了解Linux的发展史以及了解Linus其人的生活态度。
    
- 《奔跑吧Linux内核》，分上下两册，建议初学者仅学习上册。
    
- 《鸟哥的Linux私房菜》，该书主要针对Linux服务器运维人员，主要学习上册，了解Linux的日常应用。
    
- 野火 [《STM32库开发实战指南》](https://ebf-stm32f429-tiaozhanzhe-std-tutorial.readthedocs.io/) ，快速上手MCU开发并巩固C语言相关的知识。
    
- 野火 [《i.MX RT库开发实战指南》](https://ebf-imxrt1052-tutorial.readthedocs.io/) ，i.MX 6ULL的外设与i.MX RT系列基本相同，可以通过它学习i.MX系列芯片的裸机开发进行过渡。
    
- 野火 [《RT-Thread内核实现与应用开发实战指南》](https://ebf-rtthread-tutorial-rt1052.readthedocs.io/) 和 [《FreeRTOS内核实现与应用开发实战指南》](https://ebf-freertos-tutorial-rt1052.readthedocs.io/) 针对嵌入式实时操作系统讲解，通过它们可掌握操作系统相关的概念。


# 2. 如何学习linux开发

## 2.1. 嵌入式linux学习路线

我们立足于树莓派的开发方式，借鉴其一系列先进的设计理念和软件架构， 力求为电子爱好者提供强大、好用的DIY平台，方便实现各种天马行空的想法。 与此同时，所有的软件和芯片手册将全部开源， 为有志于从事嵌入式linux行业者后续深入学习各种软件架构和驱动程序扫清障碍。

### 2.1.1. 适合哪些用户群体

嵌入式linux学习者大体可以分为两类，一类是进阶用户，主要指已经有大量mcu工作经验的开发者， 他们希望进阶到更有难度，薪资更高的mpu开发中去。另一类则是学生用户， 主要是刚开始接触嵌入式开发的大学生群体。

对于前者而言，出于工作的压力和升职加薪的需求，通常会比较关注课程学习的深度，关注学习完成后， 能不能顺利地利用学习的知识来跳槽升职加薪。但是对于后者，他们没有行业经验，没有工作压力， 更加注重的是课程的有趣性，功能性，想知道通过这个课程我有能力做出什么东西来。

本教程兼顾两种用户的需求，首先，最大程度上降低入门门槛，这主要指两个方面， 一方面简化开发环境的搭建，尽可能避免各种各样的软件版本问题，以及各种电脑系统的兼容性问题。 另一方面是先学习嵌入式linux的高频技能，所谓高频技能， 就是指在大部分实际开发工作中都较为频繁地使用的技能。其次，是尝试使用这些高频技能去开发一些炫酷、 自己感兴趣的产品，进一步去了解嵌入式linux各式各样的产业，体验嵌入式linux在人类实际生活中的影响。 最后，在对嵌入式linux有整体了解后，根据自己的个人兴趣和实际工作需求， 选择嵌入式linux的某一个方面深入研究。

通常，国内传统的嵌入式linux学习路线大体为:

1. linux基本操作+c语言进阶
    
2. ARM裸机开发
    
3. linux系统移植(u-boot移植、kernel移植、构建根文件系统)
    
4. linux驱动开发
    
5. linux应用编程
    
6. 项目实战
    

按照上面的学习路线走下来，一方面，需要耗费巨大的学习精力，哪怕全天学习，一般也要4个月以上的时间。 这对于还没有确定职业方向的学生用户，想玩嵌入式linux的门槛太高。

另一方面，不贴合进阶用户实际工作需求，因为大部分课程在设计的时候充斥了许多低频技能， 这些技能在大部分嵌入式linux工作中很少用上(比如ARM裸机开发)。 而当工作中真正遇到系统性能问题的时候，往往又没有能力去实际解决问题， 因为你所学习的linux系统移植，不过是用芯片公司团队做好的系统镜像， 自己复制粘贴一些文件，修改一些配置，然后重新编译安装到系统里面去，真正高阶的技能其实没学到多少。

### 2.1.2. 为什么选择树莓派教育理念

树莓派（Raspberry Pi）是尺寸仅有信用卡大小的一个小型电脑， 您可以将树莓派连接电视、显示器、键盘鼠标等设备使用， 它的设计目标是用较为低廉的价格和大量开源软件，为青少年提供一个计算机教育平台， 用于培养计算机程序设计的兴趣和能力。

现在树莓派已经拥有全球100万用户的作品展示社区，这意味着树莓派有海量的应用可以参考和模仿。 下面是它们的一些DIY案例:

![树莓派案例](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/raspi_demo1.png)![树莓派案例](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/raspi_demo2.png)![树莓派案例](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/raspi_demo3.png)![树莓派案例](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/raspi_demo4.png)

树莓派的成功给了国内linux教育一些深刻的启发，那就是编程教育应该是强调探究性、项目式学习， 以此激发探索的好奇心和享受实现自己目标的成就感。从这个角度而言， 掌握一些必备的计算机编程技能只是完成了基本的知识获取过程，重点是站在巨人肩膀上的各种创新。

考虑到开发者技术水平参差不齐，树莓派做了很多软件架构上的优化和开发了很多方便好用工具。 这是树莓派广受好评和便于在社区推广的一大原因，非常值得我们去借鉴学习。

但是树莓派也有它的不足之处，那就是它的底层的bootloader和核心数据手册是闭源的，普通用户无法获取。 所以树莓派往往更被学生群体或者其他一些创客群体所青睐，而不太适合嵌入式linux从业者的进阶学习， 闭源的部分导致它在工程项目中使用也带来诸多不便。







# 3. i.MX系列芯片简介

本章简要介绍一下为什么我们采用i.MX系列应用处理器进行讲解，使用该系列芯片学习Linux开发有什么优势。

## 3.1. i.MX 系列应用处理器

i.MX 应用处理器包括i.MX8、i.MX7、i.MX6及i.MX28系列，被广泛应用于工业控制、 汽车电子领域，久经市场考验。而且它的产品线非常丰富， 用户熟悉其中一款产品后就能非常方便地迁移至不同的平台。它们的前身是Freescale旗下的产品， 目前属于NXP公司，所以在查阅资料和代码时，在看到Freescale的一些标签时不要奇怪。 NXP承诺对这些产品供货周期持续10年以上。学习应用处理器的驱动程序开发时， 芯片原厂的技术支持是非常重要的，NXP官方提供的资料包含uboot、Linux内核的Yocto定制示例工程， 完善的裸机SDK软件库等，相比之下部分芯片厂商甚至连寄存器手册都遮遮掩掩， 个人难以获取，这无疑提高了学习的门槛。

所以应用领域广泛、产品供货稳定、官方支持的资料丰富，这是我们选择它们作为学习平台的原因。

其中i.MX6系列应用处理器包含基于Cortex的单核、双核和四核系列的的产品，其架构有， 主要采用Cortex-A7，Cortex-A9作为内核，部分型号采用Cortex-A9+Cortex-M4的双核心方案。 主频从528MHz~1.2GHz不等。该系列芯片主要应用在车载多媒体系统、数字标牌电子阅读 器、人机界面、物联网网关、智能工业控制系统等轻量、低功耗的领域，在物联网推进的大潮下， 该芯片定有一番作为。

本书讲解主要采用的是i.MX6ULL系列处理器，它包含一个Cortex-A7内核，主频有528MHz、 792MHz和900Mhz，具体芯片的特性可参考图i.MX6的命名规则图说明进行区分。 如型号为MCIMX6Y2CVM08AB的芯片，它属于i.MX6ULL系列，是主频为792MHz、芯片封装为BGA， 尺寸为14x14mm，焊盘间距为0.8pitch的工业级芯片。

![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/imxser002.png)

i.MX6的命名规则图

## 3.2. Cortex A7内核简介

Cortex-A7处理器是ARM开发的一种高能效处理器架构，它的架构和功能集与Cortex-A15 处理器大部分相同， 不过Cortex-A7处理器的结构侧重于功耗与性能的平衡， 因此这两种处理器可在big.LITTLE（大小核伴侣架构）配置中协同工作， 从而提供高性能与超低功耗的组合。单个Cortex-A7处理器的能源效率是ARM Cortex-A8处理器的5倍， 性能提升50%，而尺寸仅为后者的五分之一。

联发科的MT6589手机处理器采用的是4核Cortex-A7架构，它曾被用在红米、中兴U956、华为G520等手机上。 不过目前手机性能要求更高，所以Cortex-A7架构处理器的应用场景已转移至低功耗嵌入式设备上， 如可穿戴设备，IoT节点等。i.MX6系列处理器有Cortex-A9和Cortex-A7的不同型号， 需要根据具体的应用场景进行选择。

## 3.3. i.MX RT系列

NXP针对MCU（微控制器）的应用场景，推出了i.MX RT系列跨界处理器， 该系列下又包括i.MX RT1020、i.MX RT1050及i.MX RT1060等子系列芯片。所谓“跨界”， 是指它自身的定位既非传统的应用处理器也非传统的微控制器。

它在i.MX6的MPU（应用处理器）平台之上把其Cortex-A内核换成Cortex-M内核， 使得它具备了应用处理器的高性能及丰富的功能，又具备传统微控制器的易用、实时及低功耗的特性。

如果大家觉得学习Linux开发太过复杂，可以先学习一下i.MX RT系列微控制器的应用， 因为除了内核，在外设等方面可以说是完全一样，而开发i.MX RT系列微控制器的应用与传统MCU无异， 熟悉了i.MX RT系列芯片之后，基本可以跳过i.MX6裸机程序开发的环节，再学习i.MX6时， 仅专注于Linux相关知识即可。

针对i.MX RT系列芯片应用，野火电子提供了非常详细的教程，覆盖裸机至实时操作系统及LwIP应用的教程：

- [《i.MX RT库开发实战指南》](https://ebf-imxrt1052-tutorial.readthedocs.io/)
    
- [《FreeRTOS内核实现与应用开发实战指南》](https://ebf-freertos-tutorial-rt1052.readthedocs.io/)
    
- [《RT-Thread内核实现与应用开发实战指南》](https://ebf-rtthread-tutorial-rt1052.readthedocs.io/)
    
- [《uCOS-III内核实现与应用开发实战指南》](https://ebf-ucos-tutorial-.readthedocs.io/)
    
- [《LwIP应用开发实战指南》](https://ebf-lwip-tutorial-rt1052.readthedocs.io/)
    

对于学习Linux依然心怀忐忑，希望学习MCU过渡的读者，这些是非常适合的教材。具体资料下载地址请参见链接： [https://ebf-products.readthedocs.io/](https://ebf-products.readthedocs.io/) 。

![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/imxser003.jpg)

（图片来源：周星驰 电影《功夫》）

![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/imxser004.jpg)

（图片来源：周星驰 电影《功夫》）

# 4. Linux系统简介


本章主要讲解Linux系统的基础使用，包括系统的一些基本概念、安装以及日常应用。

## 4.1. Linux系统简介

Linux系统由Linus Torvalds （林纳斯·托瓦兹）于1991年发布在新闻组的内核发展而来， 由于它在发布之初就免费和自由传播，支持多用户、多任务及多线程，且兼容POSIX标准， 使得它支持运行当时主流系统Unix的一些工具软件，吸引了众多的使用者和开发者，逐渐发展壮大至今。

关于Linux系统的发展历史，建议阅读其作者Linus本人的自传《Just For Fun》一书。

## 4.2. Linux内核与发行版

当我们说Linux系统时，其含义往往是指采用Linux内核的操作系统。Linux内核负责控制硬件、 管理文件系统、进程管理、网络通讯等，但它本身并没有给用户提供必要的工具和应用软件。

由于Linux内核本身是开源的，所以一些人和厂商在其规则之下， 基于Linux内核搭配各种各样系统管理软件或应用工具软件，从而组成一套完整可用的操作系统，见下图。 我们称这样的系统为Linux发行版（distribution）。完整的Linux系统就如同汽车， Linux内核构成了最为关键的引擎，不同的发行版就类似使用相同引擎的不同车型。

![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/linuxb002.jpg)

Linux系统的完整构成

人们制作发行版通常用于特定的用途，构建哲学不一，侧重点有所不同，因而Linux发行版可谓百花齐放。 其中以Debian、Suse及Fedora派系的发行版最为常见。对于基础用户来说，常常会困惑于安装某些软件时， 软件的安装帮助会针对不同派系的Linux给出不同的安装指令， 这实际是由于不同Linux派系之间使用不同的包管理软件（可理解为使用不同的软件商店），这无伤大雅。 常见的Linux发行版关系见下图。

![未找到图片](https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/_images/linuxb003.jpg)

常见的Linux发行版关系图

对于初次接触Linux的用户，建议只要了解到这些都是Linux系统，而且目前我们的开发主机要用的是Ubuntu即可。 至于在开发板上运行的Linux系统，也可以理解为这是我们针对特定板子而定制的Linux发行版。

### 4.2.1. Debian派系

Debian派系下主要包含Debian、Ubuntu等发行版。

Debian的特色在于其海量的软件支持和apt-get软件包管理系统，而且其支持的硬件平台非常全面， 包括x86、AMD、MIPS、ARM、POWERPC等。

Ubuntu衍生自Debian，由于其易用性，可以说是最成功的Linux桌面版， 且它的成功已经开始漫延至其服务器版本，目前还推出了Ubuntu Core版本针对物联网等小型设备领域， 非常有发展前景。本书将采用Ubuntu作为开发主机的系统环境。

Debian和Ubuntu官网有非常丰富的使用教程，而且中文支持也很好， 推荐初学者多多浏览其中的内容，尤其是Debian。

Debian官网：[https://www.debian.org](https://www.debian.org/)

Ubuntu官网：[https://ubuntu.com](https://ubuntu.com/)

### 4.2.2. Fedora派系

Fedora派系下包含Fedora、Red Hat Linux、Red Hat Enterprise（RHEL）、CentOS等发行版。

Red Hat Linux是由Red Hat（红帽）发行的个人版本Linux，现已停止开发， 他们转而开发主要应用于服务器领域的Red Hat EnterpriseLinux（RHEL）， 即红帽企业版Linux。使用RHEL的好处是获得安全稳定的技术支持以及企业级的保证， 这正是众多服务器应用场景的核心需求，红帽公司也正是依靠提供这些服务成为了最赚钱的Linux公司。 现红帽公司已被IBM收购。

Fedora发行版是由社区基于RHEL构建的，由Red Hat公司赞助，它大胆采用和验证最新的技术， 部分经验证的技术会被加入至RHEL。因而Fedora与RHEL是被互惠互利关系。 从另一个角度看，Fedora也被认为是RHEL的小白鼠版本。

CentOS全名为Community Enterprise Operation System， 即社区企业操作系统，它由红帽遵循开源协议公开的RHEL源代码构建而成， 它们的区别在于CentOS提供免费的长期升级和更新服务，使用CentOS相当于使用RHEL而不寻求红帽的技术支持， CentOS在我国的小型服务器领域应用非常广泛。

### 4.2.3. Open SUSE派系

SUSE派系下包含SUSE、SUSE Linux Enterprise Server（SLES）、openSUSE等发行版， 它们的关系类似于Fedora， Red Hat Enterprise Linux（RHEL） 和CentOS的关系。 相对RedHat专长x86架构的计算机来说，SUSE在诞生之初就瞄准大型机，所以SUSE在大型服务器领域占有一席之地。

### 4.2.4. 麒麟

由于军政系统对信息安全要求严格，我国基于Linux内核构建了中标麒麟、优麒麟、银河麒麟等发行版， 其特色主要在于自主、风险可控。


https://doc.embedfire.com/linux/imx6/linux_base/zh/latest/linux_basis/installing_linux/installing_linux.html
