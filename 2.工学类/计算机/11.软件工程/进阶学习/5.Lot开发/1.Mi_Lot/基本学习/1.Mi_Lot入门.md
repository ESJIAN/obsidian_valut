

## 01 了解

### 关于平台

#### 平台简介

# 小米 IoT 开发者平台

更新时间：2025/03/28

[小米 IoT 开发者平台](https://iot.mi.com/)是小米面向**消费类智能硬件领域**的开放合作平台，开发者借助小米 IoT 平台开放的资源、能力和服务，能够以极低的成本快速提升产品的智能化水平，满足不同用户对智能产品的使用需求和体验要求。

[立即加入](https://account.xiaomi.com/fe/service/login/password?sid=xiaomiiot&qs=%253Fcallback%253Dhttps%25253A%25252F%25252Fiot.mi.com%25252Fsts%25253Fsign%25253Dw4us47J%2525252BsAfL0I7zeNDoqM%2525252BVXd0%2525253D%252526followup%25253Dhttps%2525253A%2525252F%2525252Fiot.mi.com%2525252Fcgi-op%2525252Fapi%2525252Flogin%2525253Ffollowup%2525253Dhttps%252525253A%252525252F%252525252Fiot.mi.com%252525252F%252525253FappId%252525253D78268c04f55c46dc8b55c9d5394e865f%2526sid%253Dxiaomiiot&callback=https%3A%2F%2Fiot.mi.com%2Fsts%3Fsign%3Dw4us47J%252BsAfL0I7zeNDoqM%252BVXd0%253D%26followup%3Dhttps%253A%252F%252Fiot.mi.com%252Fcgi-op%252Fapi%252Flogin%253Ffollowup%253Dhttps%25253A%25252F%25252Fiot.mi.com%25252F%25253FappId%25253D78268c04f55c46dc8b55c9d5394e865f&_sign=KKJkPxY41AgYIEevVZurr7Jhjz0%3D&serviceParam=%7B%22checkSafePhone%22%3Afalse%2C%22checkSafeAddress%22%3Afalse%2C%22lsrp_score%22%3A0.0%7D&showActiveX=false&theme=&needTheme=false&bizDeviceType=&_locale=zh_CN)小米 IoT 的大家庭，共同打造极致的智能生活体验。

## 平台优势

### 设备量全球领先

连接智能设备数超过 **9.04 亿** 台、5 件及以上 IoT 产品用户数超过 **1830 万** 人、连接的产品服务全球 **10080 万** 个用户；平台支持 200+ 种品类接入，其中数十个品类的产品销量行业领先。

> 以上数据来自于 2024 年 Q4 小米集团财报

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/f254b5c7ed6bf8f49ae3c858618d6bb9_1743143779000.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=+at9xZpQp0ZEDJ6tTFNMPpj2+gc=)

平台接入数据

### 生态开放可持续

已有超过 10000+ 企业选择信任并接入小米 IoT 平台，一起成功谱写了很多优秀案例。同时，为更好地服务开发者，共创小米智能生态，平台也认证并培训了一批优秀的[服务商](https://iot.mi.com/fe-op/ServiceProvider?)。

也持续呼吁更多有能力和梦想的开发者、服务商一同[加入小米 IoT](https://account.xiaomi.com/fe/service/login/password?sid=xiaomiiot&qs=%253Fcallback%253Dhttps%25253A%25252F%25252Fiot.mi.com%25252Fsts%25253Fsign%25253Dw4us47J%2525252BsAfL0I7zeNDoqM%2525252BVXd0%2525253D%252526followup%25253Dhttps%2525253A%2525252F%2525252Fiot.mi.com%2525252Fcgi-op%2525252Fapi%2525252Flogin%2525253Ffollowup%2525253Dhttps%252525253A%252525252F%252525252Fiot.mi.com%252525252F%252525253FappId%252525253D78268c04f55c46dc8b55c9d5394e865f%2526sid%253Dxiaomiiot&callback=https%3A%2F%2Fiot.mi.com%2Fsts%3Fsign%3Dw4us47J%252BsAfL0I7zeNDoqM%252BVXd0%253D%26followup%3Dhttps%253A%252F%252Fiot.mi.com%252Fcgi-op%252Fapi%252Flogin%253Ffollowup%253Dhttps%25253A%25252F%25252Fiot.mi.com%25252F%25253FappId%25253D78268c04f55c46dc8b55c9d5394e865f&_sign=KKJkPxY41AgYIEevVZurr7Jhjz0%3D&serviceParam=%7B%22checkSafePhone%22%3Afalse%2C%22checkSafeAddress%22%3Afalse%2C%22lsrp_score%22%3A0.0%7D&showActiveX=false&theme=&needTheme=false&bizDeviceType=&_locale=zh_CN)，共创小米智能生态，引领智能生活。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/d06f0497db32f781d54cdd40d0338587_1732171152649.jpeg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=0Df+pxtzkLNoiT/6hlu5EXvgLJM=)

平台合作企业

### 能力丰富且完善

小米 IoT 平台已开放了智能硬件产品所需使用的基础功能：

* [米家 App 控制](/v2/new/doc/introduction/openness#%E7%B1%B3%E5%AE%B6%20App%20%E6%8E%A7%E5%88%B6)：通过米家 App 控制接入小米 IoT 平台的智能硬件产品；
* [小爱语控](/v2/new/doc/introduction/openness#%E5%B0%8F%E7%88%B1%E8%AF%AD%E9%9F%B3%E6%8E%A7%E5%88%B6)：通过小爱语音控制接入的智能硬件产品；
* [智能互联](/v2/new/doc/introduction/openness#%E6%99%BA%E8%83%BD%E4%BA%92%E8%81%94)：接入小米 IoT 平台的产品通过一定的自动化指令，可以实现互相作用，搭建智能场景。

此外，小米 IoT 平台在满足用户使用需求的基础上，持续提升 IoT 产品的基础功能和使用体验，并在能力验证后，陆续开放给接入小米 IoT 平台的开发者。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/1d21d32bf4ebdb89f7e425ec17e9629a_1691216279787.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=mQJljm4373ZdNpvDIE3+R7iG7D4=)

设备控制和互联互通

### 接入灵活且高效

小米 IoT 平台在完善基础能力的同时，依靠深厚的技术优势和优质的供应链资源，为开发者提供了以下产品接入支持服务，可根据产品实际的情况及自身开发能力，选择以较低的成本将产品接入小米 IoT 平台。

1. 自主接入，请参考[自主接入流程](/v2/new/doc/introduction/preparation/access_type#%E8%87%AA%E4%B8%BB%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B)；
2. 平台官方认证了一批具有专业资质的[服务商](/v2/new/doc/introduction/preparation/access_type#%E6%9C%8D%E5%8A%A1%E5%95%86%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B)，由他们给开发者提供代接入服务；
3. 成熟品类如灯、开关、窗帘电机可选择经平台认证的[免开发解决方案](/v2/new/doc/introduction/preparation/access_type#%E5%85%8D%E5%BC%80%E5%8F%91%E6%9E%81%E9%80%9F%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B)，7 天 0 代码即可快速实现产品智能化。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/a3e19cb05267605df8ababb553eb0d38_1691216289052.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=xNtTUCno1rjNzMpJ6edJlpyaK5U=)

自主接入流程

### 全流程提供保障

为了帮助开发者使用小米 IoT 平台的能力提升产品的智能化水平，提高产品接入和开发效率，小米 IoT 平台在接入的全流程中，为开发者提供了一系列的工具和服务支持：

| 工具和服务                                                                                                                                                                    | 详细说明                                                                                                                                                                             |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 免开发接入                                                                                                                                                                    | [服务商代接入](/v2/new/doc/introduction/preparation/access_type#%E6%9C%8D%E5%8A%A1%E5%95%86%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B) 专业团队替你高效接入                                   |
| [解决方案中心](/v2/new/doc/introduction/preparation/access_type#%E5%85%8D%E5%BC%80%E5%8F%91%E6%9E%81%E9%80%9F%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B) 7 天 0 代码极速落地产品智能化 |                                                                                                                                                                                      |
| [标准扩展程序](/v2/new/doc/configuration/extension-development/extension-development) 免开发一键生成扩展程序                                                                     |                                                                                                                                                                                      |
| [固件代码生成工具](/v2/new/doc/embedded-dev/module-dev/auto-dev) 支持低代码快速开发固件 说明：登录平台，并创建产品后，在「控制台 - 产品 - 产品详情 - 固件开发 - 工具箱」中获取   |                                                                                                                                                                                      |
| 超高性价比模组                                                                                                                                                                | 全品类覆盖、支持 Vela、低售价、高性能，均已获取了主流的认证测试 智能模组已集成小米 IoT 开放能力，支持产品方便、快捷接入平台[了解更多](/v2/new/doc/introduction/knowledge/select_module) |
| 高效配置可定制                                                                                                                                                                | 支持 9 项能力的标准化配置 标准耗材/标准消息/标准自动化，极大提升用户的配置效率[了解更多](/v2/new/doc/configuration/advance-configure/network-distribution)                              |
| 全技术支持                                                                                                                                                                    | [文档中心](/v2/new/doc/home) 150+ 文档覆盖接入全流程                                                                                                                                    |
| [帮助中心](/v2/new/doc/help-support/help-center) 常见问题自助查询                                                                                                                |                                                                                                                                                                                      |
| [产品设计指导](/v2/new/doc/resources-and-services/design/feature-define/feature-define) 软硬件设计规范和指导                                                                     |                                                                                                                                                                                      |
| [公开课](/v2/new/doc/resources-and-services/open-classes) 观看视频快速入手                                                                                                       |                                                                                                                                                                                      |
| [工单中心](/v2/new/doc/help-support/workorder) 专业技术人员在线解答                                                                                                              |                                                                                                                                                                                      |
| 多维度运营                                                                                                                                                                    | [数据看板](/v2/new/doc/configuration/others/data) 支持 7 种数据看板，及时洞察设备情况                                                                                                   |
| [日志查询](/v2/new/doc/configuration/others/log) 支持 9 类日志查询，实时排查设备问题                                                                                             |                                                                                                                                                                                      |
| [用户运营](/v2/new/doc/configuration/others/operate) 支持 3 种运营工具，助力管理用户反馈                                                                                         |                                                                                                                                                                                      |
| 商业化赋能（敬请期待）开放更多品宣窗口，支持多种销售渠道                                                                                                                      |                                                                                                                                                                                      |

一站式接入服务

## 开放能力

接入小米 IoT 平台的产品，能够借助米家 App 提供的能力，方便用户集中管理和控制；能够被具有小爱同学能力的产品，如手机、电视及音箱等控制；能够和其他接入小米 IoT 平台的智能产品间形成智能联动，在用户的创意下实现真正的智慧化生活。

### 米家 App 控制

米家 App 是一个用于集中控制硬件产品的 App，方便用户控制、查询或管理的接入小米 IoT 平台的硬件产品。开发者使用[“直连接入”](/v2/new/doc/introduction/preparation/access_mode#%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%85%A5)的方式接入平台，即可完整的获取米家 App 开放的能力。

> **说明：**
>
> 特殊类型产品在米家 App 上的功能可能会有差异，具体的实现效果请以具体的控制结果为准。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/5350f109b63abcde0c760bc89634179c_100.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=tTF1PKv7PQ7lnKuZ7Jcj/OTNci4=)

米家 App 控制设备

### 小爱语音控制

使用[直连接入](/v2/new/doc/introduction/preparation/access_mode#%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%85%A5)，以及[云对云接入](/v2/new/doc/introduction/preparation/access_mode#%E4%BA%91%E5%AF%B9%E4%BA%91%E6%8E%A5%E5%85%A5)方式接入小米 IoT 平台的智能设备，在完成产品的[功能定义](/v2/new/doc/configuration/define-features)后，即支持用户使用具有小爱语音控制的终端或设备，实现对设备的语音控制。

更多详情请参考[适配小爱语控](/v2/new/doc/resources-and-services/design/feature-define/language-control)。

> **注意：**
>
> 用户使用米家 App 添加并绑定设备后，才可使用小爱语控功能，或通过小爱语音控制产品。

### 智能互联

小米 IoT 平台为了给用户带来真正的智慧化生活，获得“设备间智能互联”和“随处随时智能互联”的智能产品使用体验，开放了设备间智能互联的能力。

开发者使用[“直连接入”](/v2/new/doc/introduction/preparation/access_mode#%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%85%A5)方式接入的设备可与其他已接入的智能设备联动，用户可根据实际的使用场景和使用需求，设置产品的“智能联动”，实现如“开门即开灯”等智能场景。

与此同时，米家 App 结合已接入设备的功能特性，整理出常用的家庭智能化方案并推荐给使用智能产品的用户，帮助开发者将智能设备应用到用户自定义的智能场景中，提高智能产品的销售机会。

* **小米手机**

小米手机提供了“闪电连接”功能，用户无需进入米家 App 即可快速连接智能设备，此外，还可提供了“快捷控制”功能方便用户通过使用快捷卡片，快捷控制已添加到米家 App 中的智能设备。

* **小米智能终端**

小米智能终端（如小爱音箱和小米电视）已深度集成小米 IoT 的能力，用户通过电视或音箱可直接控制接入小米 IoT 平台的智能设备，接收智能设备推送的消息通知。

* **小米穿戴**

小米可穿戴设备已集成小米 IoT 的能力，用户使用小米穿戴可快速控制设备或收取设备推送的消息通知，让智能设备的控制能力随身而行。

### 宣传与推广

为了帮助开发者在合规的范围内，更好地宣传接入小米 IoT 平台的智能产品，平台为开发者提供了[产品合作宣发渠道](/v2/new/doc/resources-and-services/promotion/promotion)；此外，还提供了产品宣传、推广和用户服务的指导方法，指导开发者更好地宣传并推广接入小米 IoT 平台的产品。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/dc9b177b043f7c1997eebd7ae4c2672a_1731915495937.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=YJl46HDcpI8QzRmPVoEjhdpJsYg=)

微博宣发渠道

## 开放品类

小米 IoT 平台目前已经支持且开放了 200 多种产品品类，供开发者按需选择，请参考[明确产品类型](/v2/new/doc/introduction/preparation/product_type)。

## 面向受众

### 硬件制造类企业

硬件制造类企业可使用小米 IoT 平台开放的资源和能力，高效率低成本地将硬件产品接入小米 IoT 平台，在实现硬件产品智能化的同时，获得“works with mijia”和“支持小爱同学控制”的认证，并与平台已接入的其他企业产品实现智能联动，此外，接入小米 IoT 平台的产品还可同时接入其他 IoT 平台（如 Alexa 等）。

[立即加入](https://account.xiaomi.com/fe/service/login/password?sid=xiaomiiot&qs=%253Fcallback%253Dhttps%25253A%25252F%25252Fiot.mi.com%25252Fsts%25253Fsign%25253Dw4us47J%2525252BsAfL0I7zeNDoqM%2525252BVXd0%2525253D%252526followup%25253Dhttps%2525253A%2525252F%2525252Fiot.mi.com%2525252Fcgi-op%2525252Fapi%2525252Flogin%2525253Ffollowup%2525253Dhttps%252525253A%252525252F%252525252Fiot.mi.com%252525252F%252525253FappId%252525253D78268c04f55c46dc8b55c9d5394e865f%2526sid%253Dxiaomiiot&callback=https%3A%2F%2Fiot.mi.com%2Fsts%3Fsign%3Dw4us47J%252BsAfL0I7zeNDoqM%252BVXd0%253D%26followup%3Dhttps%253A%252F%252Fiot.mi.com%252Fcgi-op%252Fapi%252Flogin%253Ffollowup%253Dhttps%25253A%25252F%25252Fiot.mi.com%25252F%25253FappId%25253D78268c04f55c46dc8b55c9d5394e865f&_sign=KKJkPxY41AgYIEevVZurr7Jhjz0%3D&serviceParam=%7B%22checkSafePhone%22%3Afalse%2C%22checkSafeAddress%22%3Afalse%2C%22lsrp_score%22%3A0.0%7D&showActiveX=false&theme=&needTheme=false&bizDeviceType=&_locale=zh_CN)。

### 服务商

为更快更好地提升接入服务，我们热衷欢迎优秀的服务商同行，加入小米 IoT 平台的大家庭，一起共创开放生态，打造极致的智能生活体验。

[了解更多成为服务商的标准和权益](https://iot.mi.com/fe-op/ServiceProvider?#tab=2)。

#### 接入方式

# 选择接入方式

更新时间：2024/11/06

为满足各种开发场景，小米 IoT 开发者平台提供了以下两类主流接入方式，开发者可以根据产品和自身研发情况选择合适的方式接入：

* **直连接入**：又称"使用小米 IoT 模组/ SDK 接入小米 IoT "，是一种开发者无需自建平台或借助其他平台，即可直接将硬件产品接入小米 IoT 平台的接入方式，是小米 IoT 平台推荐开发者使用的主要接入方式。
* **云对云接入**：是一种开发者将已接入其他平台的产品，通过 OAuth 等协议接入小米 IoT 平台的接入方式。

| **开放能力**                                   | **直连接入** | **云对云接入** |
| ---------------------------------------------------- | ------------------ | -------------------- |
| 米家 App 控制                                        | 支持               | 不支持               |
| 小爱语音控制                                         | 支持               | 支持                 |
| 设备互联互通                                         | 支持               | 不支持               |
| 接入其他类型的控制应用如网页、小程序和其他应用平台等 | 支持               | 不支持               |

不同接入方式支持的开放能力对比

## 直连接入

又称"使用小米 IoT 模组/ SDK 接入小米 IoT "，是一种开发者无需自建平台或借助其他平台，即可直接将硬件产品接入小米 IoT 平台的接入方式，是小米 IoT 平台推荐开发者使用的主要接入方式。

这种接入方式，具有以下优势：

* 该接入方式的成本低，且接入效果稳定；
* 接入后的产品能够直接获得米家 App、小爱语控和智能联动的能力；
* 接入小米 IoT 平台的硬件产品可对接其他 IoT 平台和应用，如 Alexa 和天猫精灵等；
* 可被开发者自己开发的 App 独立控制（开发者只能控制自己的硬件产品，无法控制接入小米 IoT 平台的其他产品）。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/7ff9e5c9f3746e6ff23463cf83014dba_%E6%96%B9%E6%A1%881.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=RwBgQamuwwqxEyhoK/sqRcG29RE=)

直连接入（即“使用小米 IoT 模组/ SDK 接入”）

基于直连接入方式，平台提供了以下 3 种方案，详见下表：

| **接入方式** | **使用场景**                                                                                                                                      |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Wi-Fi 接入方案     | 适用于放置在家庭中、有电源常供电、且用户多以单个产品购买使用的产品，如空调、吸顶灯、加湿器、扫地机、摄像机等                                            |
| BLE 接入方案       | 适用于： - 低功耗的硬件产品，如手环、按摩器等穿戴类产品； - 放置于家庭中、由电池供电的产品，如传感器、智能门锁等； - 部分车载类产品，如车载空气净化器等 |
| BLE Mesh 接入方案  | 适用于低功耗，需大批量部署，且**有数据上报和指令接收** 操作的硬件产品，如灯、开关等                                                               |

直连接入3种接入方案适用场景

### Wi-Fi 接入方案

适用于放置在家庭中、有电源常供电、且用户多以单个产品购买使用的产品，如空调、吸顶灯、加湿器、扫地机、摄像机等。在 Wi-Fi 接入方案下，开发者可根据产品具体使用的操作系统，选择合适的固件开发方式：

* **产品无操作系统或使用 RTOS 系统**
  + [Wi-Fi 通用模组开发](/v2/new/doc/quick-started/standard-module)（适用于集成 MCU 的硬件产品）
  + [Wi-Fi SDK 开发](/v2/new/doc/quick-started/sdk-module)（适用于未集成 MCU 的硬件产品）
  + [Wi-Fi INC SDK 开发](/v2/new/doc/quick-started/inc-module)（适用于未集成 MCU 的硬件产品）
* **产品使用 Linux 系统或 Android 系统**开发者根据硬件产品所使用的系统，
  + [Linux OT SDK 开发](/v2/new/doc/quick-started/linux-ot)

### BLE 接入方案

适用于低功耗的硬件产品，如手环、按摩器等穿戴类产品；放置于家庭中、由电池供电的产品，如传感器、智能门锁等；部分车载类产品，如车载空气净化器等；

更多开发详情，请参考 [BLE SDK 开发](/v2/new/doc/quick-started/ble-sdk)。

> **注意：**
>
> 平台不再推广 Zigbee 的接入方案，传感器品类产品推荐使用 BLE 接入方案。

### BLE Mesh 接入方案

适用于低功耗，需大批量部署，且 **有数据上报和指令接收** 操作的硬件产品，如灯、开关等；

更多开发详情，请参考 [BLE Mesh SDK 开发](/v2/new/doc/quick-started/mesh-module)。

> **说明：**
>
> * 如果相关产品还不支持 BLE Mesh 接入，请联系产品经理进行申请评估；
> * 有关支持 BLE Mesh 能力的网关信息，可在米家 App "发现" - "产品百科全部" - "网关攻略"中查看。

## 云对云接入

“[云对云接入小米 IoT 平台](/v2/new/doc/resources-and-services/cloud-access/overview)”是一种开发者将**已接入其他平台的产品**，通过 OAuth 等协议接入小米 IoT 平台的开发方式。通过"云对云"的方式接入的硬件产品，只能够获取小爱语控的能力，支持被具有小爱同学能力的音箱所控制。

> **说明：**
>
> 通过“云对云”方式接入小米 IoT 平台的硬件产品仅支持获取小爱语控的能力，无法使用小米 IoT 平台开放的其他能力。为了降低硬件产品接入云平台的开发成本和运营成本，提高产品的智能化能力，推荐开发者使用[直连接入](/v2/new/doc/introduction/preparation/access_mode#%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%85%A5)的方式将产品接入小米 IoT 平台。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/67990a49aeb935dcaa1ddf891ca656fc_1730880084716.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Jb4mQo/OcV6dayz3N+42aydI+qM=)

云对云接入小米 IoT 平台

#### 服务商接入

# 服务商解决方案

更新时间：2025/03/17

为了帮助接入经验不足或研发能力有限的开发者，提高接入效率，平台层层筛选、培训了一批专业的[服务商](https://iot.mi.com/fe-op/ServiceProvider?)：

* 他们具备专业的软硬件开发能力、丰富的 IoT 接入经验；
* 能帮助您极大地缩短接入周期，降低自主接入成本。

同时，平台也欢迎更多优秀的服务商同行，[加入](https://iot.mi.com/fe-op/ServiceProvider?#tab=2)小米 IoT 平台的大家庭，一起共创开放生态，打造极致的智能生活体验。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/89f76e48fef773e82fee20246a01e792_1730445340152.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=YixSq+n0TeOV1bGI4DX4XnERXYU=)

服务商页面

## 寻找服务商

通过服务商的方式，将产品接入小米 IoT 平台，需要经过以下流程：

### 第 1 步 - 选择服务商

根据自己的接入诉求，依据“产品品类”、“所在地”、“服务商级别”、“服务商年限”等，挑选合适的服务商。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/b276dda5e8ffdf92a36cf196ada09519_1730445396707.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=s8GyYLShOVJW2TSnShUJB5e04/I=)

选择服务商

### 第 2 步 - 联系服务商

在服务商落地页获取服务商信息，联系服务商并就服务范围和价格达成一致。

> **说明：**
>
> 小米 IoT 平台仅作为认证和提供优质服务商的渠道，过程中不收取任何费用。

### 第 3 步 - 服务商代接入

如果开发者已与服务商达成线下合作意向，可通过小米 IoT 开发者平台完成产品授权。授权后，服务商可指派服务人员访问被授权产品，服务人员将代替开发者将产品接入小米 IoT 开发者平台。

> **说明：**
>
> 只有企业组的**管理员**和**拥有者**可以将产品授权给服务商。

1. 在「控制台 - 管理 - 服务商」页面，点击【添加服务商】。

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/70679dd6cabf904dd9f82f7c8b7ef886_1738725682165.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Ou00P/7egyPXHKptN5z7Is2wo2Q=)

   添加服务商
2. 在弹窗中依次按要求填写**服务商企业名称**和**服务商服务人员 ID**。

   * **服务商企业名称**：指服务商企业组的**企业全称**，在「控制台 - 管理 - 企业信息」中查看。
   * **服务商服务人员 ID**：指服务商提供的服务人员的 ID。

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/ab354fc24fde59254918db9b2ae1d04e_1738734757432.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=iUsG5kXpSQbaNEGpEoXA8/a7Y/g=)

   服务商授权

   > **说明：**
   >
   > 如果之前已经将该服务商人员账号添加为企业成员并授予特定角色权限，本次操作后，该人员账号的权限将变更为**服务商**。
   >
3. 填写完成，点击【确定】，返回服务商页面，我的服务商列表新增一条数据。

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e0ec2ebdd4940604c0bdcd28be03ce53_1738740928590.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Bv+AbVcJ0pzcQHTEmujF2OJB5JU=)

   添加成功
4. 点击操作列的【编辑】，点击授权产品输入框，在下拉列表中选择需要授权的产品或输入产品 model。

   每个产品 model 只能被授权给一个服务商，一个服务商可以被授权多个产品 model。

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/3fe2736830d92ed0889443f15201f623_1738741302432.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=pjsqwqlWWMptbeYj5ZccgOBXIsY=)

   授权产品
5. 点击【确定】，完成产品授权。

   授权后的产品，服务商可通过服务人员来访问并完成产品的代接入服务过程。服务商可以随时调整指派的服务人员，开发者有权随时修改对服务商授权的产品范围。

## 成为服务商

### 第 1 步 - 了解标准和权益

在[成为服务商](https://iot.mi.com/fe-op/ServiceProvider?#tab=2)界面中，可以了解到服务商“准入标准”、“级别认证”和各个级别的“权益详情”。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/458eb591e4b9879239d04bb479cdbc26_1736322429418.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=nFsA9DNe2rqXxYoHQ+J4kYVqm+Y=)

服务商准入标准

### 第 2 步 - 申请加入

在[成为服务商](https://iot.mi.com/fe-op/ServiceProvider?#tab=2)界面底部，有加入服务商的流程，有意向的厂商可以根据流程步骤，申请加入。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/23408189f0bf0bf6ffc9ca649c917a88_1691132242746.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=OiFE2OR+ioSOov7hJiltStJ4tWU=)

申请流程

### 第 3 步 - 了解服务商功能

为了帮助服务商更方便的为客户提供服务，平台对服务商提供以下功能：

* 支持在线查看客户信息和客户授权的产品信息。
* 支持管理服务人员，服务人员可访问客户授权的产品。
* 支持跨企业复制产品到客户的企业组下。

> **说明：**
>
> * 在使用这些功能前，服务商需要向客户申请[产品授权](/v2/new/doc/introduction/solution/service#%E7%AC%AC%203%20%E6%AD%A5%20-%20%E6%9C%8D%E5%8A%A1%E5%95%86%E4%BB%A3%E6%8E%A5%E5%85%A5)。
> * 作为服务商，只有指派给客户的“服务人员”有权限访问客户授权产品，由“服务人员”完成产品的代接入过程。
> * 只有服务商企业组的**管理员**和**拥有者**可以进行查看客户信息/产品信息和管理服务人员的操作。

#### 查看客户信息/产品信息

在「控制台 - 管理 - 服务商」页面，在我的客户页签下，可以查看已经创建授权关系的客户清单。

如果客户没有出现在客户清单，请联系客户参考[第 3 步 - 服务商代接入](/v2/new/doc/introduction/solution/service#%E7%AC%AC%203%20%E6%AD%A5%20-%20%E6%9C%8D%E5%8A%A1%E5%95%86%E4%BB%A3%E6%8E%A5%E5%85%A5)添加服务商。服务商需要提供企业信息：

* 企业全称，在「控制台 - 管理 - 企业信息」中查看。
* 企业组下某个企业成员的小米账号 ID，此企业成员将作为客户的服务人员。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/a14bb0e9f7377370c301bb2cb2894528_1738812027799.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=2JN7wgAz9cXWc8LEtiuAPYy0UHA=)

我的客户

点击操作列的【查看详情】，可以查看对应客户详情和被授权的产品清单。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/b886689a147a56ed49d425e40234c49b_1738812322651.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=9VO9eyprZT4r0HJv9AvzYmNp1B0=)

客户详情和产品清单

#### 管理服务人员

在「控制台 - 管理 - 服务商」页面，在我的客户页签下，点击操作列的【查看详情】，在客户详情页点击【修改】，可以对服务人员进行新增和删除操作。

> **说明：**
>
> * 服务人员必须是企业成员，一个企业成员可以为多个客户服务。服务人员添加成功后，服务人员账号可以切换到客户的企业组，对被授权的产品进行代开发工作。
> * 服务商可以随时修改指派给客户的服务人员。当服务人员账号对应的员工离职，服务商只需要将其账号从企业成员中移除，账号将自动解除和客户的服务人员关系，无需手动操作。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/12d130c7dc3321d784a6b4892ce80862_1738812642880.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=4FTVcR6dk6FDnfMbo3DM6UU+mbE=)

管理服务人员

#### 复制产品

服务人员可以复制自己账号下的成熟产品到客户的企业组。

1. 在「控制台 - 产品 - 产品列表」页面，点击操作列的【复制】，在弹窗中中依次按要求填写产品名称和产品型号，“复制给客户”选项勾选“是”，点击目标客户输入框在下拉框中选择目标客户。

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/db1158aad1365d3593c827d559407337_1738823261430.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=18nw88AwMQ2bJwOG7agG5K7+7nA=)

   复制产品
2. 点击【确定】，产品将被复制到客户的企业组下。

#### 解决方案中心

# 免开发解决方案

更新时间：2024/11/06

小米 IoT 开发平台提供的经认证的[免开发解决方案](https://iot.mi.com/fe-op/solutionCenter/market)，仅需开发者确认方案后申请使用即可快速完成产品接入。无需编程经验，功能定义、App 界面设计、固件代码等自动生成，由方案服务商提供具备完整功能固件的模组, 即插即用，可快速投入成品试量产。

## 支持品类

目前免开发解决方案覆盖的品类有“窗帘电机”、“开关”、“灯”，可前往[方案中心](https://iot.mi.com/fe-op/solutionCenter/market)进行选择；
其他品类方案正在接入中，如不具备开发能力想快速接入，也可选择委托[小米认证服务商](https://iot.mi.com/fe-op/ServiceProvider?)进行产品开发。

## 接入流程

> **说明：**
>
> 使用免开发解决方案前，需要提前在小米 IoT 平台[注册企业](/v2/new/doc/configuration/signin/create-enterprise)且被审核通过，且登录平台。

### 第 1 步 - 进入解决方案中心

[进入解决方案中心](https://iot.mi.com/fe-op/solutionCenter/market)

| **解决方案入口**                                                                                                                         | **图例** |
| ---------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| 入口一：【开发者平台 - 控制台 - 产品】页面右侧方案中心模块，点击进入方案中心                                                                   |                |
| 入口二：新建产品时，选择完「产品类型」、「联网方式」后，对于已有成熟解决方案的产品，「开发方式」会出现"选择成熟方案"选项，选择后可进入方案市场 |                |

解决方案中心入口

### 第 2 步 - 寻找合适方案

点击查看方案，进入详情确认方案是否满足自己需求。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/8557931cc3ef0f64d6648ef109a06365_1730441816089.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fttlPjjOUoB+Kv2f/K6ccx5KbXk=)

解决方案中心

### 第 3 步 - 预约咨询

如需进一步进行深入了解，可填写手机号码预约方案咨询，预约后将获得方案服务商 1V1 专属技术支持，服务商会根据您的需求推荐合适方案。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e260d7da5eeff283ee125a5e1ae702ea_1730441946902.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=dUe6dX6hFxtlxVBYgSs++tcCyow=)

预约咨询

### 第 4 步 - 申请使用方案

确定使用该免开发解决方案，可点击【申请使用方案】按钮进行申请，申请的方案经方案服务商确认后，即会创建一个免开发产品。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/5e6ab79f1d2ecf2f0f300ec96192597d_1730442080112.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=+kaMaQs8bnYFaLOvybpB13N4SOo=)

申请使用方案

### 第 5 步 - 查看申请记录

在【我的申请】页面可查看所有方案申请、预约咨询记录。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/f0b7166293ae462aebe42828467405fe_1730442294327.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=a06dinQqR4b1IGfFlE33kcyPQko=)

查看申请记录

#### 模组选型

# 模组选型基础知识

更新时间：2024/12/31

## 方案选型

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/10818d642aa95e2ac6f375fc799687c5_module_select.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=H1jjWIwvKfTGl+rmCjQxo6LZ3cY=)

方案选型

| **接入方式** | **Wi-Fi**                                                                                                         | **BLE**                                                                                                                                                                                     | **BLE Mesh**                                                                                                              |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| **使用场景** | 有电源常供电、且用户多以**单个产品购买使用的产品**，如空调、吸顶灯、加湿器、扫地机、摄像机，厨房电器              | 低功耗的硬件产品，如手环、按摩器等运动健康类产品；放置于家庭中、由电池供电的产品，如传感器、智能门锁等；部分车载类产品，如车载空气净化器等                                                        | 电工：灯、开关、插座、电风扇和窗帘                                                                                              |
| **优势**     | 上网简单，用户熟悉度高，不需要额外的**网关**，可以和存量路由器直接通信                                            | 低成本、低功耗**近场与手机连接**，**不支持远程下行**，支持上行（依赖网关）                                                                                                            | 低成本、低功耗**支持远程上下行** ( **依赖 Mesh 网关** )，和**近场 BLE GATT 直连**                             |
| **缺点**     | 成本高，功耗高                                                                                                          | **远程上行** 需要依赖 BLE 网关，**远程下行** 不支持                                                                                                                                   | 需要依赖 Mesh 网关，上下行指令长度较小                                                                                          |
| **支持模组** | **MHCWB6(ESP32-C3)**、**ESP-WROOM-32D(ESP32)**、**MHCWB5G(BL602)**，低功耗：**MHCW05(MTK7682)** | **MHCB05P-MHCB06P-MHCB07P(RTL8762C)**、**MHCB09P(EFR32BG22)**   **单芯片 SDK 接入**：请参见 [BLE 模组与芯片](/v2/new/doc/embedded-dev/ble-sdk/quickstart#%E8%8E%B7%E5%8F%96%20SDK) | **MHCB05P**、**MHCB06P**、**MHCB07P(RTL8762C)**、**MHCB09P(EFR32BG22）**、**MHCB12G/S(RTL8762E)** |

接入方式选择

## 基本模组选型网站

小米 IoT 模组是集成了小米 IoT 平台开放能力的智能模组，智能模组均已获取了主流的认证测试，开发者需在选择产品接入方案并确定固件开发方式后，选择使用相应的模组。

> **注意：**
>
> 1. 小米 IoT 模组 datasheet、开发资料及认证资料，都可以在[「模组选型」页面](https://iot.mi.com/moduleBrowser.html)获取；
> 2. 有关获取小米 IoT 样品申请与批量采购，请参见下文[“申请与采购”](/v2/new/doc/introduction/knowledge/select_module#%E7%94%B3%E8%AF%B7%E4%B8%8E%E9%87%87%E8%B4%AD) 中的内容；
> 3. 由于其他平台的模组并没有集成小米 IoT 平台开放的能力，因此，未使用小米 IoT 模组的设备无法接入小米 IoT 平台；
> 4. 在开发产品的固件时，模组的固件版本需使用最新版本。

在[「模组选型」页面](https://iot.mi.com/moduleBrowser.html)中选择所需要使用的模组，在对应的模组列表中即可获取模组的规格书、认证证书、开发资料

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/13655956819ba8e4351f4ed8fb877902_%E6%A8%A1%E7%BB%84%E7%BD%91%E7%AB%99.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=SUZ0rHoD2LHNWv9yu/VHr3rHwFg=)

模组网站

## Wi-Fi 开发方式

**模组简介**

| **模组型号** | **ESP-WROOM-32D/U**               | **MHCWB6G/L/S-B/IB**             | **MHCWB5G/S-B/IB**              |
| ------------------ | --------------------------------------- | -------------------------------------- | ------------------------------------- |
| 芯片平台           | 乐鑫 ESP32                              | 乐鑫 ESP32-C3                          | 博流 BL602                            |
| 价格               | ￥ 12.29                                | ￥ 9.49                                | ￥ 7.99                               |
| 定位               | 高性能模组                              | 高性价比主力模组                       | **超高性价比** 主力模组         |
| **技术参数** |                                         |                                        |                                       |
| 操作系统           | FreeRTOS                                | Xiaomi Vela                            | Xiaomi Vela                           |
| 蓝牙遥控器         | 支持                                    | 支持                                   | 支持                                  |
| 蓝牙网关           | 支持                                    | 不支持                                 | 不支持                                |
| **产品接入** |                                         |                                        |                                       |
| 接入方式           | 通用模组产品接入  MCU OTA Flash: 1.2M   | 通用模组产品接入 MCU OTA Flash: 880K   | 通用模组产品接入  MCU OTA Flash: 880K |
|                    | 模组二次开发接入  RAM 40KB Falsh 1200KB | 独立二次开发接入  RAM 20KB Falsh 420KB | 不支持二次开发接入                    |
| 是否 Pin2Pin       | N/A                                     | Pin2Pin with ESP8266                   | Pin2Pin with ESP8266                  |
| 量产时间           | 已量产                                  | 已量产                                 | 已量产                                |
| 国内认证           | SRRC/BQB                                | SRRC/BQB                               | SRRC/BQB                              |
| 海外认证           | CE/FCC/IC/MIC/NCC                       | CE/FCC/MIC                             | 计划支持                              |

Wi-Fi 模组介绍

> **说明：**
>
> ESP32-C3 模组 INC 可用的 RAM 资源 20K，独立二次开发接入中并非全部(90KB)可预留给客户使用。

### Wi-Fi 各种二次开发对比

| 模组开发方式   | 通用模组接入                                   | 模组二次开发                                                | 独立二次开发                                                                  |
| -------------- | ---------------------------------------------- | ----------------------------------------------------------- | ----------------------------------------------------------------------------- |
| 支持的操作系统 | FreeRTOS，Xiaomi Vela                          | FreeRTOS                                                    | Xiaomi Vela                                                                   |
| 技术特点       | 模组上仅运行米家 IoT 软件客户软件运行于 MCU 上 | 模组上同时运行米家 IoT 软件和客户软件二者运行于同一内存空间 | 模组上同时运行米家 IoT 软件和客户软件客户软件运行于独立的内存空间，由沙箱隔离 |
| 技术优势       | 米家 IoT 软件和客户软件可独立升级              | 客户开发自由度更大，可满足 Homekit 等复杂需求               | 降低开发难度，进一步降低设备成本米家 IoT 软件和客户软件可独立升级             |
| 注意           | 需要多加一个 MCU，注意 MCU OTA 的开发          | 需要 RAM 的开销                                             | 需要 RAM 的开销外设支持有限，灵活有限                                         |
| 常规开发周期   | 1 个月                                         | 2 个月                                                      | 1.5 个月                                                                      |

开发对比

### Wi-Fi 软件功能

| 功能名称（最新版本） | ESP32(2.2.8)  | ESP32-C3(1.1.0) | BL602(1.0.3)  | BL616 常电(1.0.1) | Linux (4.3.8) |
| -------------------- | ------------- | --------------- | ------------- | ----------------- | ------------- |
| **配网绑定**   |               |                 |               |                   |               |
| AP 配网              | 已发布(2.0.0) | 已发布(1.0.0)   | ×            | ×                | 已发布        |
| 蓝牙配网             | 已发布(2.0.0) | 已发布(1.0.0)   | 已发布(1.0.0) | 已发布(1.0.0)     | 已发布(4.0.6) |
| 畅快连/一键配网      | 已发布(2.1.3) | 已发布(1.0.0)   | 已发布(1.0.0) | 已发布(1.0.0)     | 已发布(4.3.2) |
| 畅快连/改密同步      | 已发布(2.1.0) | 已发布(1.0.0)   | 已发布(1.0.0) | 已发布(1.0.0)     | 已发布(4.2.6) |
| 畅快连/无感配网      | 已发布(2.1.3) | 已发布(1.0.0)   | 已发布(1.0.0) | 已发布(1.0.0)     | 已发布(4.3.2) |
| **Spec 消息**  |               |                 |               |                   |               |
| 本地自动化           | 已发布(2.2.1) | 已发布(1.0.7)   | 已发布(1.0.0) | 已发布(1.0.0)     | 已发布(4.3.2) |
| 在线升级             |               |                 |               |                   |               |
| 自动 OTA 升级        | 已发布(2.1.3) | 已发布(1.0.0)   | 已发布(1.0.0) | 已发布(1.0.0)     | 已发布(4.1.3) |
| **其他**       |               |                 |               |                   |               |
| 独立二次开发         | ×            | 已发布(1.0.2)   | ×            | ×                | ×            |
| 节能模式关闭射频     | 已发布(2.2.1) | 已发布(1.0.7)   | --            | ×                | ×            |
| 蓝牙遥控器           | 已发布(2.0.0) | 已发布(1.0.0)   | 已发布(1.0.0) | 已发布(1.0.0)     | ×            |

Wi-Fi 软件功能

> **说明：**
>
> * 上图中‘×’表示不支持，‘--’表示待支持
> * 小米 IoT 模组仅支持 Wi-Fi 2.4GHz，暂不支持 5GHz

## BLE 开发方式

[**MIoT 平台蓝牙介绍**](/v2/new/doc/introduction/knowledge/ble_basic)

### BLE 模组

| 模组型号                                                       | 芯片平台   | 接入方式                       | 资源配置                                                         | 功耗                                   | 其他                                            |
| -------------------------------------------------------------- | ---------- | ------------------------------ | ---------------------------------------------------------------- | -------------------------------------- | ----------------------------------------------- |
| ① MHCB05P（通用）  ② MHCB06P（灯品类）  ③ MHCB07P（小尺寸） | RTL8762CMF | 标准认证、高安全认证、BLE Mesh | Flash：512KB（剩余 140KB）SRAM：160KB（剩余 48KB）-- 资源充足    | RX：7.3mA TX：11.3mA(8dBm) 待机：3.5uA | Mesh:15% 扫描窗口（控制成功率 99%），功耗 1.3ma |
| MHCB08P（高发射功率，20dbm）                                   | EFR32BG21  | 标准认证、高安全认证           | Flash：512KB（剩余约 100KB）SRAM：64KB（剩余约 32KB）-- 资源充足 | RX：9mA TX：33mA(10dBm) 待机：5uA      | /                                               |
| MHCB09P（超低功耗）                                            | EFR32BG22  | 标准认证、高安全认证、BLE Mesh | Flash：512KB（剩余约 100KB）SRAM：32KB（剩余约 4KB）-- 资源不足  | RX：3.6mA TX：8.2mA(8dBm) 待机：3.5uA  | Mesh:15% 扫描窗口（控制成功率 99%），功耗 0.6ma |
| MHCB12G/S (Mesh2.0)                                            | RTL8762EMF | BLE Mesh                       | Flash：512KB（剩余约 65KB）SRAM：104KB（剩余约 10KB）-- 资源充足 | RX：5.5mA TX：12mA(8dBm) 待机：3.5uA   | Mesh:15% 扫描窗口（控制成功率 99%），功耗 1.1ma |

BLE 模组与芯片

> **说明：**
>
> * 单次采购模组 MHCB05P-B(IB)、MHCB06P-B(IB) 或 MHCB07P 达 10k 以上，可免费申请固件烧录，详情请“提交工单”，选择标签“固件开发”-“固件其他”咨询。
> * MHCB05P-B、MHCB06P-B、MHCB08P-B、MHCB09P-B 几款模组，SRRC 认证为“完整性非独立模块”，产品整机需报备无线电委员会审核，审核通过后可继承模组认证。
> * MHCB05P-IB、MHCB06P-IB、MHCB07P、MHCB08P-IB、MHCB09P-IB 几款外接天线模组，SRRC 认证为“限制性非独立模块”，需开发者对整机进行 SRRC 认证测试。

### BLE 单芯片

支持单芯片 SDK 接入的芯片型号：参考 [BLE 模组与芯片](/v2/new/doc/embedded-dev/ble-sdk/quickstart#%E8%8E%B7%E5%8F%96%20SDK)

## 安全芯片

**米家安全定制芯片(MJA1)**：米家安全定制芯片(MJA1)为金融级安全芯片，使用该芯片的硬件产品不仅能够简化生产流程，还能有效提升产品可靠性，避免高价值的产品被复制或伪造，主要适用于门锁或摄像机等高安全级别硬件产品。

**尺寸(mm)**：2 x 3

**通讯接口**：I2C

**批量采购价格（含税）**：1.20 元

**认证证书**：国内 EAL4+

> **说明：** 如需使用安全芯片，请[提交工单](https://iot.mi.com/fe-op/personalCenter/feedback)，选择标签“固件”-“固件其他”咨询。

## 模组采购

### 采购前须知

* **模组性能**
  模组的天线性能容易受模组周围环境影响会与规格数据有所差异，请开发者在设计产品时，参考[小米 IoT 模组硬件设计规范](/v2/new/doc/resources-and-services/design/hardware)，合理地设计天线的位置；由于开发套装中的天线不符合生产标准，仅可用作调试和测试，请勿投入生产使用。
* **申请开发套装**

为了方便开发者在开发产品的固件时模拟接入设备，小米 IoT 平台为开发者提供了开发套装，其中包含小米 IoT 开发板（开发板已嵌有模组）；开发者选择以“开发套装”（内含开发板和天线）的方式采购模组时，小米 IoT 平台将免费为每个企业开发组提供 10 个模组，当企业开发组采购的模组超过 10 个后，需以“批量采购”的方式购买模组。

> **说明：**
>
> * 申请小米模组后，小米 IoT 平台将收到开发者采购模组的信息，并在 3～5 个工作日内为开发者邮寄模组，请开发者在采购模组时，正确地填写模组采购信息；
> * 小米 IoT 平台默认使用顺丰快递寄送模组，请开发者在申请模组后，在**顺丰快递官方平台**（如顺丰公众号）上，通过**收件人的手机号**查看快递信息；
> * 开发者如需批量采购模组，请提前 40 个工作日在小米 IoT 开发者平台上提交批量采购申请；若有特殊需求，请[提交工单](https://iot.mi.com/fe-op/personalCenter/feedback)，选择标签“其他”咨询。

* **申请相关资源**

1. 使用非小米模组的硬件产品或开发者需在小米智能模组的基础上二次开发时，开发者可申请使用小米 IoT SDK，详情请参见[“平台资源申请”](/v2/new/doc/resources-and-services/source)；
2. 联网方式为 BLE 的硬件产品，若使用非小米认证的模组开发待接入硬件产品的固件，需[提交工单](https://iot.mi.com/fe-op/personalCenter/feedback)，选择标签“固件开发”-“蓝牙固件开发”**申请获取米家标准认证库**；
3. 若开发者需整机测试，请参考文档[“认证测试工具及说明”](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/90dd49e03f3fb1b1a017a8877484d2fd_%E6%95%B4%E6%9C%BA%E5%8E%82%E6%B5%8B-%E8%AE%A4%E8%AF%81%E5%B7%A5%E5%85%B7%E5%8F%8A%E8%AF%B4%E6%98%8E.pdf?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=myiiHo5ZMU2A4YE7sb0j6P70RIg=)；如需获取其他证书，请[与我们联系](mailto:miot-openhome@xiaomi.com)。

### 申请与采购

选择所需使用的模组后，开发者可登录小米 IoT 开发者平台，在“控制台”—“管理”—“企业采购”—“[模组/芯片采购](https://iot.mi.com/fe-op/manageCenter/purchase/module)”中，选择以“开发套装”或“批量生产”的方式**获取模组的规格书**或采购所需使用的模组。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/fcedcfe433d47c8c7b3e495066a054c8_1730442623944.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=1VXRIHMXE1cAoHrSZSZB2wOxv7M=)

模组采购

## 常见问题

| 问题                                       | 回答                                                                                               |
| ------------------------------------------ | -------------------------------------------------------------------------------------------------- |
| 能否直接**使用芯片**？               | Wi-Fi/BLE Mesh：不能 BLE :可以使用经过小米认证的芯片                                               |
| 是否可以直接使用**所有的开发方式**？ | 不能，目前考虑到各种接入方式的难易程，只有通用模组是支持全部开放，如需支持可寻找服务商进行开发帮助 |
| 现在主推的模组是那些？                     | **Wi-Fi**：MHCWB5、MHCWB6  **BLE Mesh**：MHCB05、MHCB06、MHCB07、MHCB09                |
| 什么情况需要使用安全芯片？                 | 高安全级别设备需要使用安全芯片，如：锁，摄像机，扫地机等等                                         |
| 硬件规格（尺寸规范）                       | 参考[基本模组选型网站](https://iot.mi.com/moduleBrowser.html)模组 datasheet                           |

常见问题

### 基础知识

#### 平台架构

介绍平台技术框架
米家物联网平台支持与接入设备进行通信，用户可通过米家模组/ SDK 接入米家平台，实现米家 App，小爱音箱，设备联动等功能，打造美好的智能生活体验。本文介绍物联网平台的技术架构。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/dad6ab3502dac450d52cef85a2393f0a_1685612690783.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=SNskma6pOq4DDIXJubFnXor6OxQ=)

平台技术架构

#### 名词解释

# 常见名词解释

更新时间：2024/10/23

## MODEL

Model 是小米 IoT 开发者平台为开发者的产品指定的唯一标识（用户不可见）。主要由“企业开发组”、“产品类型”和“产品型号”构成。产品创建后产品 Model 将无法修改。

如 `xiaomi.lock.demo` 指企业组 `xiaomi` 里面的产品型号为 `demo` 的锁产品(lock)。

## UID

用户 ID(User ID)，标识用户的唯一识别码。在开发者平台中特指登录米家 App 的小米账号 ID。

开发者可以在 `米家 App - 我的 - <个人头像> - 小米ID` 处查询自己的 uid。

## DID

设备 ID(Device ID)是小米 IoT 开发者平台分配的，用于唯一识别某一个具体设备的唯一标识。使用小米智能模组的设备，模组中自带 DID。使用 Linux/Android SDK 开发的产品，DID 包含在申请的三元组中。

## PID

产品 ID(Product ID)由小米 IoT 开发者平台自动分配指定，用于识别产品。该标识用户不可见，产品创建后自动生成且无法修改，主要功能是在配网阶段起到识别作用。

## Spec

又称 MIOT-Spec，为 MIoT Specification 的缩写。Spec 是描述设备功能的协议规范，对设备的功能性进行规范化描述。其主要用于各种方式接入米家平台的设备上。

通过 MIOT-Spec 协议接入米家平台的设备我们通常叫做 Spec 接入。采用统一的 Spec 协议接入，设备除了可实现与云端、插件的通信，还可以轻松获取到平台消息推送、自动化联动、小爱语控（需品类支持）、快捷卡片（需品类支持）等通用能力。

有关 Spec 的详细介绍请参考 [Spec 知识](/v2/new/doc/introduction/knowledge/spec)。

## SIID

服务 ID(service-iid)，MIOT-Spec 协议中某项服务的唯一标识。服务(Service)指某一类互相有联系的功能合集，其内部包含各种属性(Property)、事件(Event)和方法(Action)。

在计算机程序中，同一类属性和方法等往往会放进类(Class)中。Spec 协议中的服务也像 Class 一样，如灯品类的 light 服务中，包含了开关、亮度调节、色温调节等功能。

## PIID

属性 ID(property-iid)，MIOT-Spec 协议中某项服务中属性的唯一标识。单一的功能操作可以定义为属性，属性支持被查询、控制、订阅。例如灯的开关、亮度调节、色温调节。

## AIID

方法 ID(action-iid)，MIOT-Spec 协议中方法的唯一标识，主要用于向设备下发控制指令。方法可支持同时下发多个属性（以属性作为输入、输出参数），如电饭煲开始煮饭。

## EIID

事件 ID(event-iid)，MIOT-Spec 协议中事件的唯一标识，主要用于设备向云端上报组合数据。事件可支持上报多个属性（以属性作为输出参数），如门锁被打开。

## OT

一般指 OT 通道。OT 通道是 SDK 提供的核心功能之一，它在 IoT 设备和米家服务器之间建立了一个长连接，供业务 RPC 传输使用。开发者无需关心与云端的链路管理，只需要负责业务 RPC 处理即可。

OT 通道工作在 IP 层之上，传输层支持 UDP/TCP/TLS 三种方式，默认使用 TLS 的安全链路。OT 通道的核心作用是在 IoT 设备与云端之间提供业务 RPC 透传，即 SDK 对 OT 通道内的业务 RPC 仅做上下行转发，无其他额外处理。

## OT Client

实现 OT 通道功能的设备端程序。如标准模组固件，SDK 二次开发的模组固件等，就称之为 OT Client。

## RPC

RPC 是远程过程调用(Remote Procedure Call)的缩写形式。接入米家的设备，其远程云端控制以及小爱语控，自动化场景等功能的实现，依赖云与设备之间的数据通信，也属于一种 RPC，数据传输协议使用的是 MIOT-SPEC。

例如下面的示例就是一条完整的符合 MIOT-SPEC 协议的 RPC 指令。

json

```
{  
  "from": "4",  
  "id": 39950136,  
  "method": "set_properties",  
  "params": [  
    {  
      "did": "462033xxx",  
      "piid": 1,  
      "siid": 2,  
      "value": true  
    }  
  ]  
}  

```

## 三元组

三元组，指从小米 IoT 平台申请的一段包含 DID、KEY、MAC 信息的文本。使用 Linux/Android SDK 开发的设备接入米家，需要上述 DID、KEY、MAC 三个信息才能入网，因此简称为三元组。

## 设备配网

指智能设备获得连接互联网能力的过程，如通过米家 App 获取路由器 SSID 及密码，连接路由器访问网络。

## 设备绑定

指设备和米家 App 连接后，将其绑定到小米帐号下。一般而言设备配网流程会包含设备绑定操作，故设备配网成功即代表设备绑定成功。设备绑定后，通常需要在米家 App 上解除绑定或设备重置后才能再次进行绑定。

## 畅快连

指米家 SDK 提供的畅快连功能，包含靠近配网、一键配网、改密同步三个功能。

## 自动升级

即设备自动进行 OTA 更新固件。开启了此功能的产品，会在凌晨 2:00～凌晨 6:00 时间段进行静默升级，不打扰用户。更新记录和通知会在第二天早上 10 点后统一推送。

## 扩展程序

米家扩展程序，又称米家 App 插件，是由各接入厂商开发的，在米家 App 中用于查看硬件产品实时信息和控制硬件产品的子程序。

在米家 App 设备页面，点击设备宫格进入到的设备控制界面即是扩展程序界面。

有关扩展程序开发的详细介绍参考[扩展程序快速入门](/v2/new/doc/plugin/quickstart/quick-start)。

## 快捷卡片

指米家 App 提供的一种无需进入产品扩展程序，就能在设备宫格页面快速控制产品的功能。

如需使用快捷卡片功能，可前往 `米家 App - 我的 - 设置 - 快捷卡片 - 打开快捷操作` 进行开启。

## 消息推送

指米家 App 或者小爱语控完成某类操作后，设备耗材信息和报警信息会推送到用户手机上告知用户。

## 智能场景

又称自动化，是一个用于控制厂商自己的设备与其他已接入 MIoT 平台的设备间进行联动的功能。

例如：用户可以控制门锁和入户灯之间的联动，配置好相关的智能场景后，实现用户开锁后，入户灯自动打开的效果。

有关智能场景的开发介绍文档参考[平台配置](/v2/new/doc/configuration/advance-configure/automation)或[扩展程序配置](/v2/new/doc/plugin/other/automation-develop)。

## INC 独立二次开发

也称为独立二次开发、基于小米 SDK 标准接口的独立模块开发、Wasm SDK 开发。它与 SDK 二次开发主要区别是引入了 Wasm 虚拟机隔离，延续了二次开发成本低的优势，且降低了开发难度，集合了传统二次开发与 MCU + 通用模组两种开发方式的优点。

#### Spec 基础

# MIoT Spec 知识

更新时间：2023/12/19

## MIoT Spec 介绍

MIoT Spec 即 MIoT Specification 的缩写，是对于 IoT 设备规范化的功能性描述，是米家平台制订的物联网协议，其中包含功能定义（其他 IoT 平台称之为物模型）、交互模型、消息格式及编码，可用于各种方式接入米家平台的设备。通过 MIoT Spec 协议接入米家平台的设备我们通常叫做 Spec 接入设备。

## MIoT Spec 的作用

采用统一的 Spec 协议接入，设备除了可实现与云端、插件的通信，还可轻松获取到平台消息推送、自动化联动、小爱语控（品类需先支持）、快捷卡片（品类需先支持）等通用能力。

## MIoT-Spec 功能定义规范介绍

Spec 功能定义把物理设备抽象成了属性、方法、事件、服务和设备的结构体系。

### 名词解释

| **概念**  | **解释**                                                                                                                                                                                                                                                                                                                                                           |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 属性 (Property) | 最小单位之一，表示设备的某一个持续的性质或状态，通过权限(access)来表示该属性可交互的操作，包括“读、写、上报”。如灯的开/关状态定义成一个 on 属性，通过对 on 属性“写”**true/false** 来操作灯的**开/关**。                                                                                                                                                  |
| 方法 (Action)   | 基本单位之一，表达“瞬时的执行操作”，包含输入、输出参数，且参数都可以带多个属性，是一个比属性更复杂的交互元素。如空气炸锅在启动某个菜单时需要下发控制多个属性参数**输入参数**：需要下发的属性参数 **输出参数**：下发方法后需要回复的属性参数                                                                                                                |
| 事件 (Event)    | 基本单位之一，类似于属性的“上报”，但侧重于表示一个状态变化时的瞬时信号，由设备单向往云端上报，主要用来触发告警、推送，包含输出参数，也可以带多个属性。如门锁打开需要同时上报开锁方式、动作、开锁时间等信息，这就可通过锁事件组合上报                                                                                                                                   |
| 服务 (Service)  | 代表一类有互相联系的功能单元合集，也称功能组，通过属性、方法、事件的集合来描述服务中包含的具体功能。如 light 服务包含了开关、亮度调节、色温调节等功能                                                                                                                                                                                                                    |
| 设备 (Device)   | 即产品本身，设备由多个服务（功能组）聚合而成。如支持充电的风扇有 fan 服务、battery 服务等                                                                                                                                                                                                                                                                                |
| 实例 ID (iid)   | 即实例 ID，为了区分不同的实例，引入一个概念：**iid（Instance ID，实例 ID）**  iid 用整型表示，一个 iid 在同一级是唯一的，如： 1. 在一个 Device 中，每个 Service 的 iid 是唯一的。 2. 在一个 Service 的 properties 中，Property 的 iid 是唯一的。 3. 在一个 Service 的 actions 中，Action 的 iid 是唯一的。 4. 在一个 Service 的 events 中，Event 的 iid 是唯一的。 |

### 开关 Spec 实例

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/bc130109e8529904da71d7b811f37538_spec.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=c5zTRUS5YJZ5KniPeOKNQRt0xGQ=)

实例示意

### RPC 命令与 Spec 关系

设备通信 RPC 命令中 method "get\_properties"、"set\_properties" 和 "properties\_changed" 均为对属性操作，对应设备基于 miot-spec 的功能定义中属性的 access。而 "action" 和 "event\_occured" 对应设备实例中方法和事件的定义。

| **RPC** **method** | **设备 miot-spec 功能定义** |
| ------------------------------ | --------------------------------- |
| get\_properties                | 可读属性，access:[read]           |
| set\_properties                | 可写属性，access:[write]          |
| properties\_changed            | 上报属性，access:[notify]         |
| action                         | 方法定义 (action)                 |
| event\_occured                 | 事件定义 (event)                  |

### 规范详细设计

#### 实例定义规范

为了明确标识开发者接入小米 IoT 平台的设备，小米 IoT 设备协议规范使用设备实例(Device Instance)标识设备：

* 一个设备可包含多个“服务”、“属性”、“方法”和“事件”，但都唯一且确定，小米 IoT 设备协议规范使用 **实例 ID（Instance ID，iid，整型）** 作为唯一的标识；
* 为了方便开发者快速定义产品的功能，小米 IoT 开发者平台提供了“[产品复用](/v2/new/doc/configuration/create)”功能，开发者可复用已创建的产品并根据产品的实际情况调整，快速完成产品的功能定义；
* 为了帮助开发者定义出功能完整的产品，使用户在使用产品时能够获得良好的使用体验，小米 IoT 设备协议规范定义了“必选功能(required)”，开发者必须定义并实现字段标识为“required”的“必选功能”；
* 开发者在小米 IoT 开发者平台上创建产品后，产品中的“服务”、“属性”、“方法”和“事件”会根据当前的状态显示相应的内容：

  + 产品开发调试阶段：debug
  + 产品提交上线申请阶段：preview
  + 产品通过审核正式上线：released
* 为了保证开发者获取良好的产品使用体验，产品上线后，开发者需保持向后兼容性的升级，即只可新增功能定义，并可按需单独迭代产品固件、扩展程序、使用帮助和隐私条款。

> **说明：**
>
> 1. 保持向后兼容性的升级指开发者可新增服务、属性（可增加属性单位）、事件（可新增事件参数）或方法，修改描述；
> 2. 产品升级迭代时，urn 中的版本号将会按序递增。

#### 描述字段

SpecificationType，**规范定义类型**，即 type，主要用于描述不同的定义，该字段使用 URN 格式（遵循 URN 语法规范 RFC2141，最后一个字段可选）。

JSON

```
    urn:miot-spec-v2:service:device-information:00007801  
    <URN> ::= "urn:"<namespace>":"<type>":"<name>":"<value>  [":"<vendor-product>":"<version>]  

```

* urn：第一个字段必须为 urn，否则视为非法 urn
* namespace：miot-spec-v2 为小米定义的规范，bluetooth-spec 为蓝牙联盟定义的规范
* type：只能是 template、property、action、event、service、device
* name：有意义的单词或单词组合（小写字母），多个单词用"-"间隔，如 temperature、current-temperature、device-name、battery-level
* value：16 进制字符串，使用 UUID 前 8 个字符，如 00002A06、00002A00
* vendor-product：厂商+产品代号，有意义的单词或单词组合（小写字母），用"-"间隔，如 philips-moonlight、yeelink-c300、zhimi-vv、benz-c63
* version：产品功能的版本号，只能是数字且按序递增

> **说明：** 小米 IoT 开发者平台将会根据开发者的配置信息，自动生成 **vendor-product** 和 **version** 两个字段，该字段只在设备实例定义里出现。

#### 设备定义规范

设备是一个独立的有意义的设备，如灯泡、插座及风扇等；为了准确描述一个设备，小米 IoT 设备协议规范使用如下字段描述设备的信息：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec-v2:device:fan:0000A005`
* **description**：描述，纯文本字段，对此 Device 做一个简单的描述，如 `Lightbulb`
* **required-services（必选服务）**
* **optional-services（可选服务）**

JSON

```
// 设备示例  
{    
    // 标识风扇设备  
    "type": "urn:miot-spec-v2:device:fan:0000A005",  
    "description": "Fan",  
    // 风扇设备必须有的服务  
    "required-services": [  
        "urn:miot-spec-v2:service:device-information:00007801",  
        "urn:miot-spec-v2:service:fan:00007808"  
    ],  
    // 风扇设备可选择的服务  
    "optional-services": [  
        "urn:miot-spec-v2:service:physical-controls-locked:00007807",  
        "urn:miot-spec-v2:service:battery:00007805"  
    ]  
}  

```

#### 服务定义规范

小米 IoT 设备协议规范使用“服务”描述设备独立的有意义的功能组，功能组包含可操作的方法、可发生的事件和必备的属性；为了准确描述设备的服务，小米 IoT 设备协议规范使用如下字段描述设备的服务：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec-v2:service:fan:00007808`
* **description**：纯文本字段，描述 Service，如 `Fan Service`
* **required-actions（必选方法列表）**

JSON

```
"required-actions": [  
    "urn:miot-spec-v2:action:get-stream-configuration:00000001",  
    "urn:miot-spec-v2:action:start-stream:00000101",  
    "urn:miot-spec-v2:action:stop-stream:00000201"  
]  

```

* **optional-actions（可选方法列表）**

JSON

```
"optional-actions": [  
    "urn:miot-spec-v2:action:identify:00002801"  
]  

```

* **required-events（必选事件列表）**

JSON

```
"required-events": [  
    "urn:miot-spec-v2:event:alert1:00000007"  
]  

```

* **optional-events（可选事件列表）**

JSON

```
"optional-events": [  
    "urn:miot-spec-v2:event:alert2:00000008"  
]  

```

* **required-properties（必选属性列表）**

JSON

```
"required-properties": [  
    "urn:miot-spec-v2:property:on:00000006",  
    "urn:miot-spec-v2:property:fan-level:00000016"  
]  

```

* **optional-properties（可选属性列表）**

JSON

```
"optional-properties": [  
    "urn:miot-spec-v2:property:horizontal-swing:00000017",  
    "urn:miot-spec-v2:property:vertical-swing:00000018",  
    "urn:miot-spec-v2:property:horizontal-angle:00000019",  
    "urn:miot-spec-v2:property:vertical-angle:0000001A",  
    "urn:miot-spec-v2:property:mode:00000008",  
    "urn:miot-spec-v2:property:status:00000007",  
    "urn:miot-spec-v2:property:fault:00000009"  
]  
  
// 服务示例  
{  
    "type": "urn:miot-spec-v2:service:fan:00007808",  
    "description": "Fan",  
    "required-properties": [  
        "urn:miot-spec-v2:property:on:00000006",  
        "urn:miot-spec-v2:property:fan-level:00000016"  
    ],  
    "optional-properties": [  
        "urn:miot-spec-v2:property:horizontal-swing:00000017",  
        "urn:miot-spec-v2:property:vertical-swing:00000018",  
        "urn:miot-spec-v2:property:horizontal-angle:00000019",  
        "urn:miot-spec-v2:property:vertical-angle:0000001A",  
        "urn:miot-spec-v2:property:mode:00000008",  
        "urn:miot-spec-v2:property:status:00000007",  
        "urn:miot-spec-v2:property:fault:00000009"  
    ]  
}  

```

#### 方法定义规范

设备执行操作时可能会读写多个属性并有相应的输入输出值，小米 IoT 设备协议规范使用“方法”读写多个属性。为了准确描述设备的方法，小米 IoT 设备协议规范使用如下字段描述设备的“方法”：

* **type**：类型，必须 URN 表达式，`urn:miot-spec-v2:action:play:0000280B`
* **description（描述）**：纯文本字段，对此 Action 做简单的描述，如 `Get Streaming Configuration Of Camera`
* **in（输入参数列表）**：可以是 0 到 N 个，每个参数都由属性组成
* **out（输出参数列表）**：可以是 0 到 N 个，每个参数都由属性组成

JSON

```
// 方法示例  
{  
    // 开启摄像头视频流（需要设置SRTP相关的N个属性，返回SRTP相关的N个属性）  
    "type": "urn:miot-spec-v2:action:start-stream:00000101",  
    "description": "Start Camera Streaming",  
    "in": [  
        "urn:miot-spec-v2:property:session-id:00000102",  
        "urn:miot-spec-v2:property:conroller-ip-version:00000103",  
        "urn:miot-spec-v2:property:conroller-ip-address:00000104",  
        "urn:miot-spec-v2:property:conroller-video-rtp-port:00000105",  
        "urn:miot-spec-v2:property:conroller-audio-rtp-port:00000106",  
        "urn:miot-spec-v2:property:selected-video-parameters:00000107",  
        "urn:miot-spec-v2:property:selected-audio-parameters:00000108"  
    ],  
    "out": [  
        "urn:miot-spec-v2:property:device-status:00000109",  
        "urn:miot-spec-v2:property:device-ip-version:00000110",  
        "urn:miot-spec-v2:property:device-ip-address:00000111",  
        "urn:miot-spec-v2:property:synchronization-source-for-video:00000112",  
        "urn:miot-spec-v2:property:synchronization-source-for-audio:00000113",  
        "urn:miot-spec-v2:property:session-control:00000119"  
    ]  
}  

```

> **说明：** 方法中的输入数据和输出数据只可引用当前服务中的属性。

#### 事件定义规范

为了及时告知用户设备的状态，小米 IoT 设备协议规范使用“事件”上报设备多个属性的变化状态，告知用户设备当前的状态；为了准确描述设备的“事件”，小米 IoT 设备协议规范使用如下字段描述设备的“事件”：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec:spec:event:alert:00000007`
* **description**：纯文本字段，对事件做简单的描述，如 `Get Streaming Configuration Of Camera`
* **arguments（参数列表）**：事件包含的属性参数，整型数组，数组内的数字代表当前服务(Service)内的属性 ID(piid)。如 [2, 4] 代表上报事件时同时会包含 piid = 2 和 piid = 4 的属性

JSON

```
// 事件示例  
{  
    "type": "urn:miot-spec-v2:event:alert:00000007",  
    "description": "Alert Alert Alert",  
    "arguments": [2, 4]  
}  

```

#### 属性定义规范

产品的功能属性多用于表示产品的状态，产品的功能属性支持被查询、控制和订阅；为了准确描述设备的属性，小米 IoT 设备协议规范使用如下字段描述设备的“属性”：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec-v2:property:color-temperature:0000000F`
* **description**：纯文本字段，对属性做简单的描述，如 Name、Temperature、Battery Level 等
* **format**：属性的数据格式

| 数据格式     | 描述                                                | 备注             |
| ------------ | --------------------------------------------------- | ---------------- |
| bool         | 布尔值: true/false                                  |                  |
| uint8        | 无符号 8 位整型                                     | 建议约束取值范围 |
| uint16       | 无符号 16 位整型                                    |                  |
| uint32       | 无符号 32 位整型                                    |                  |
| int8         | 有符号 8 位整型                                     |                  |
| int16        | 有符号 16 位整型                                    |                  |
| int32        | 有符号 32 位整型                                    |                  |
| int64        | 有符号 64 位整型                                    |                  |
| float        | 浮点数                                              |                  |
| string       | 字符串                                              | 建议约束最大长度 |
| hex          | 16 进制，（使用字符串表示，如"FF0011", “EE00”等） | 建议约束取值范围 |
| 数据格式描述 |                                                     |                  |

* **access**：访问方式，包含 read（读）、write（写）和 notify（通知）
* **value-range**：约束取值范围，仅当 format 为整型或浮点数时，可定义 value-range，如最大值为 32，最小值为 16，步长为 0.5
* **value-list**：约束取值范围，当 format 为整型，可定义"value-list"，每个元素都包含 value 和 description
* **unit**：单位，当 format 为整型或浮点型，可定义 unit 的值

| 值         | 描述           | 值      | 描述                 |
| ---------- | -------------- | ------- | -------------------- |
| percentage | 百分比         | celsius | 摄氏度               |
| seconds    | 秒             | minutes | 分                   |
| hours      | 小时           | days    | 天                   |
| kelvin     | 开氏温标       | pascal  | 帕斯卡(大气压强单位) |
| arcdegrees | 弧度(角度单位) | rgb     | RGB(颜色)            |
| watt       | 瓦特(功率)     | litre   | 升                   |
| ppm        | ppm 浓度       | lux     | 勒克斯(照度)         |
| mg/m3      | 毫克每立方米   | -       | -                    |
| 值描述     |                |         |                      |

* **max-length**：字符串最大长度，仅当 format 为字符串时可选。

JSON

```
// 属性示例  
{  
    "type": "urn:miot-spec-v2:property:current-temperature:00000002",  
    "description": "Current temperature",  
    "format": "float",  
    "access": ["read", "write", "notify"],  
    "value-range": [16, 32, 0.5],  
    "unit": "celsius"  
}  
  
// 使用value-list   
{  
    "type": "urn:miot-spec-v2:property:day-of-the-week:00000003",  
    "description": "Day Of The Week",  
    "format": "uint8",  
    "access": ["read", "write", "notify"],  
    "value-list": [  
       {"value": 1, "description": "Monday"},  
       {"value": 2, "description": "Tuesday"},  
       {"value": 3, "description": "Wednesday"},  
       {"value": 4, "description": "Thursday"},  
       {"value": 5, "description": "Friday"},  
       {"value": 6, "description": "Saturday"},  
       {"value": 7, "description": "Sunday"}  
    ]  
}  

```

#### BLE 基础

## 米家 BLE 支持的功能

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/ff49b8b5cd954fae47fa9714923488e2_1.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=jIEGd0LBUcjSxtK5dyedVRBCt4s=)

功能示意

1. 米家 BLE 提供了标准的基于 GATT 直连配网、模组统一 OTA 功能（**模组升级功能，SDK 已集成开发者无需开发**），同时支持手机与设备间直连控制，通过直连控制可实现设备局域网内的控制和状态回传；
2. 米家 BLE 也提供了通过网关上报数据的功能与接口。

## 米家 BLE 网络拓扑

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/8736fc09335cac46e1945161622921c8_2.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=1DZ5TzB685JVOAj3FZBpT+gL+Z8=)

网络拓扑

> **说明：**
>
> 米家 BLE 设备通过网关只能上报数据，在没有网关时也可根据需要开发蓝牙直连功能控制设备。

1. BLE 设备通过网关**只能上报**消息，因此也**不支持**小爱下行控制（部分品类可查询）；
2. 为了避免 BLE 设备相同数据未更新时重复上报给服务器，减轻服务器压力，网关设置了设备具备上报权限属性/事件的上报规则 interval（间隔）和 delta（变化量/差值），interval 和 delta 满足任意条件即可上报（如温度传感器每秒持续发送温度为 10℃，若此时 interval==10min，则网关会每间隔 10min 的时候才会上报一次温度到云端）：默认规则不满足产品需求时，可通过[线上申请](https://iot.mi.com/fe-op/manageCenter/projectApply/index)修改。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/20ee166739e09a297fb285f57b8c6e9f_1730442967657.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ZZaseuRbi3dH9fWwPgSBybTjdIc=)

规则申请

## 米家 BLE 设备在/离线原理

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/28f15b26ef56d45ed33dee3903f22e6f_4.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=8wZjcGGQ+YmHcoy4VCbJrg7gcd8=)

在/离线原理

> **说明：** BLE 设备在线需要靠网关上报设备保活消息来保活。

1. BLE 设备**最长间隔 50min** 要广播一次，即上报一次属性/事件，让网关扫描到以此保持在线；
2. 蓝牙 BLE 网关连续 **2** **小时**都没有为 BLE 子设备上报保活消息，此时 BLE 子设备离线。

## 注意事项

* 最多只支持 **7** 个具有上报权限的属性/事件，具备上报权限的属性/事件的 ID 有个明显特征 **IID > 1000**；
* 只有标准属性/事件才支持上报，如缺少相关标准属性/事件，需要提交“[Spec 新功能或新描述词申请](https://iot.mi.com/fe-op/manageCenter/projectApply/index)”新增；
* 自定义属性/事件只能用于 GATT 直连通信；
* 定义支持上报的属性/事件后，设备会默认加入蓝牙网关，无需再申请加入网关；
* 设备没有通过网关上报的需求只有直连要求时，就不要加载和定义支持上报的功能定义，这样就不会显示在某个网关下且不会显示设备离线。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/16b62ff3875ad0382cf4e90d1739d542_1730443301233.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=u2SBvGLW/PBbtysNvbGbyoZB+Rg=)

属性编辑

#### BLE Mesh 基础

## 米家 BLE Mesh 支持的功能

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/a49ece76a666ca8d8d12f8d97037bfe5_1.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=AyAIDOH2I797mMgAdDj7bdyI1aY=)

功能示意

1. 米家 BLE Mesh 提供了标准且基于 GATT 的直连配网、模组统一 OTA 功能（**模组升级功能，SDK 已集成开发者无需开发**），同时提供了手机与设备间直连控制接口（**标准扩展程序不支持**），通过直连控制接口，可实现设备局域网内控制和状态回传；
2. BLE Mesh 设备可实现消息上下行，同时**非低功耗设备**默认支持消息中继功能（低功耗功能设备端由 **MI\_MESH\_LOW\_POWER\_NODE** 宏控制）。

## 米家 BLE Mesh 网络拓扑

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/164bb64044776e314ac35cd0fb8bd45e_2.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=awnQqHC6lPJs90YFohzUpJ2GlAo=)

网络拓扑

> **说明：**
>
> 米家 BLE Mesh 设备实现远程控制需要有 Mesh 网关，在没有网关时也可根据需要开发蓝牙直连功能控制设备。

1. BLE Mesh 设备通过网关能够**上、下行**消息，因此也**支持**小爱语控（查询与控制）；
2. 非低功耗设备间可以中继 Mesh 消息，扩展消息传送距离，但是设备间不能相互控制；
3. 为了避免 BLE Mesh 设备状态数据未更新时重复上报给服务器，减轻服务器压力，网关设置了 BLE Mesh 设备属性数据上报过滤规则，属性默认规则：interval（间隔）==86400 ,delta（变化量）== 1，interval 和 delta 满足任意条件即可上报：若默认规则不满足产品需求，可通过[线上申请](https://iot.mi.com/fe-op/manageCenter/projectApply/index)修改。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/20ee166739e09a297fb285f57b8c6e9f_1730442967657.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ZZaseuRbi3dH9fWwPgSBybTjdIc=)

规则申请

## 设备在离线原理

| 类型     | 说明                                   | 判断阈值       | 离线时间 |
| -------- | -------------------------------------- | -------------- | -------- |
| 近场设备 | 设备离网关较近的设备，可直接跟网关通信 | > -90db        | 1.5min   |
| 远场设备 | 设备离网关较远，通过中继方式与网关通信 | -90db ~ -120db | 42min    |

## 通信消息流

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/812ed6120f7bad92795683f4f2beae6f_5.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=zH4a69dar6sN1uGtMzcuNs1dKlo=)

Spec 与 Mesh 的转换关系

插件或小爱音箱语控下发的基于 Spec 的命令，经过云端后由米家 BLE Mesh 网关转换成 Mesh 消息发送给设备。设备主动发送的 Mesh 消息也会由米家 BLE Mesh 网关转换成 Spec 命令后发送给云端。

> **说明：**
>
> 服务器 - 网关 - BLE Mesh 设备之间的通信，是一个异步的操作！服务器下发的控制指令，网关会立即回复。

### 消息下行 -get\_properties

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/5772e44eecf059c20eb28adeffaf63b9_6.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=eW3/YRgH5tQvmYZB70CCANogVTk=)

get\_properties 消息流

BLE Mesh 设备刚绑定时，由于网关没有缓存设备的属性值，此时 App 去获取设备属性值时会报错 **-4004**。因此，建议设备绑定完成后，主动上报属性值或者 App 重复去获取（一般来说，第一次获取失败后，间隔 1-2s 后再次去获取时可以成功）。

### 消息下行 -set\_properties

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/2f3bda4817413db77b2a726dff1dfe53_7.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=0Yv68Ek7mYTcMcwXXPT65NJrYm4=)

set\_properties 消息流

### 消息下行 -action

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/b03ab877062efc1808382d023e7705c5_8.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=bb8XkdIr3+kVwsfkZX6t4PHtjTI=)

action 消息流

受包长度限制，BLE Mesh 设备的 action 不能带输出 out 参数，最多只能带 **1** 个输入 in 参数。

### 消息上行 -properties\_changed

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/3b386371ff8290ee839c9e6dff06d78f_9.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=YSwjAzaSFQrCQ3VoSebM4H6MuXk=)

properties\_changed 消息流

属性上报网关会缓存，满足 interval 或者 delta 之后网关才会上报到云端。

### 消息上行 -event\_occurred

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/7de6428304c8eedd7293993c02ded592_10.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=9gdBlGEst3C5jE2cknKuY/v1ZnE=)

event\_occurred 消息流

网关不对事件缓存，收到 BLE Mesh 设备上报事件后会立即上报到云端。

## 注意事项

* 功能定义时需要选择“**功能定义模板**”（固件侧也需要选择开启对应的宏），否则配网时会报 **-40** 错误。如果模板里面只有“自定义”选项，则证明该品类还不支持 BLE Mesh 接入。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/ef621841b68e26c785ffa7dc70df0654_1730880294626.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=B/BVL9uM+bwFxg58Me6oK/+eYwQ=)

功能定义模板

### 动手操作

#### 快速入门

# Wi-Fi 通用模组快速入门

更新时间：2024/11/06

> **目的：10-20 min 快速搭建 demo，熟悉平台及模组基本用法**
>
> **效果：以 MHCWB5 系列模组为例，用串口工具+标准模组，实现点击米家 App 命令下及模组应答的简单双向通讯。**

## 前提条件

* 注册企业：在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[注册企业](/v2/new/doc/configuration/signin/create-enterprise#%E5%88%9B%E5%BB%BA%E6%96%B0%E4%BC%81%E4%B8%9A%E7%BB%84)。
* 成为开发者：在企业开发组下添加开发者，参考[企业成员管理](/v2/new/doc/configuration/signin/manage-member)。
* 模组和工具：准备一个 MHCWB5 系列[模组](https://iot.mi.com/moduleBrowser.html)，USB 转串口工具。

## 开发流程

### 登录企业组

进入开发者平台，进入登录/注册

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/67a3f2e451bf0fe5d09d68deb7e195f2_1730445707000.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=DlSS5DoEVmr6hBgcy9WQUY8EnPE=)

平台

使用小米账号登录

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/f4b10cb3950ff700cf14a2c56a1d9946_1702262419054.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fl2T3X3sFmoY63dkP1wxpwQYHv8=)

登录

### 新建产品

点击控制台 - 产品

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/1300d82f23eb6a26dd0bec0e97b971e0_1730445942789.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=sKj90hwjKSf10o1vHeHEvlnuE3w=)

控制台-产品

平台新建产品，注意"产品类型"、"联网方式"

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/52c6f6937c48c9324d6986721023093f_1730446150127.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=wDhOfgBuQFjeNA4kidoRHhLB0FE=)

新建产品

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/a648892424acbb7d4a05678167e66b80_1730446341599.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Wltsp4yQZq9pXd94XKtzhtHYfy8=)

产品参数

搜索刚才创建的产品，点击它，进入产品界面：

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/a648892424acbb7d4a05678167e66b80_1730446341599.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Wltsp4yQZq9pXd94XKtzhtHYfy8=)

点击产品

在基础配置界面，配置产品信息：

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/0bfb63046102f6c3bc8f690a220d36ba_1730446563218.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=QGXwVsjW+Gg75rq/7ZUdgYW5Cb4=)

产品界面

### 功能定义

选择模板

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/a5d32155311871bb41ea829c637e60fa_1730446673376.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ItMKf1aUdyb3haD48557UsJcAuA=)

选择模板

查看增加服务，也可以点击服务查看具体的定义属性，方法，事件。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/d002f0a1016907023d61a76441912e74_1730446759642.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ftbLT3nkCDtJxm3sn69UZrwNePU=)

功能定义

### 扩展程序

此 demo 中使用的 Spec 功能定义是标准灯定义，直接使用标准插件

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e016b766037f9e054a96ba34aa43c1e2_1730446847928.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ah13Uh8lUs68qfpnmrCJG2emSyM=)

灯标准插件

### 固件开发

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/4057d4a3a13ed04fdfd78fe10d0342b9_%E5%9B%BA%E4%BB%B6%E6%B5%81%E7%A8%8B.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=SOQ4wEm1f7B/CplWEuRdJi281Js=)

固件流程

#### 固件平台设置

**1. 固件设置（开发模式、OTA 方式、操作系统、模组型号）和资源申请**

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/9266c60b21b545f85d9d9b3cc90dd10f_1730446970422.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=R3JSpijw5INeXxZtX8LL78M6k9w=)

固件设置

**2. 资源申请**

点击“新建模组采购”，进入资源申请页面

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/f8740388e68c168e4220cd47ee36e466_1730447107768.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=eZP/0yO8UUBmQUkOiVZ1U9nKFXY=)

样品申请

#### 开发环境搭建

**一. 硬件连接**

模组资料下载：[模组页面](https://iot.mi.com/moduleBrowser.html)

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/c47cd40864050526ff98a592063700f6_1685093246116.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=6RzqOP/RAxI9RWEWBcfRy8gBr8s=)

B5G 模组管脚

| 引脚                 | 功能描述                                                                                                |
| -------------------- | ------------------------------------------------------------------------------------------------------- |
| VDD                  | 3.3V 供电 (VDD)                                                                                         |
| CHIP-EN              | 芯片使能端，正常工作外部需拉高                                                                          |
| **IO20/U1RXD** | **与 MCU 主控通讯串口 RX**                                                                        |
| **IO21/U1TXD** | **与 MCU 主控通讯串口 TX**                                                                        |
| IO8                  | BOOT：外部拉低，用于 Flash 启动模式； 外部拉高，用于 Download，此时 IO7 和 IO16 上电默认功能为烧录 UART |
| **log\_TX**    | **即 U0TXD，用于模组 log 输出和固件烧录 UART**                                                    |
| **log\_RX**    | **即 U0RXD，用于固件烧录 UART**                                                                   |

B5G 模组管脚说明

**二. 工具准备**

1. 安装 secureCRT 或者 Putty 等串口调试工具。
2. CP2102 串口转 USB 板，以下简称串口板。
3. 安装 CP2102 串口驱动，插上串口板，在设备驱动里面可以看到 COM 口，如果设备驱动出现感叹号，需要重新安装串口驱动程序

**三. 调试 log 打印**

1. 硬件接线方法：

   ![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/edc0ff1e037ba6251dabfa05eb1b8694_PC%E7%A1%AC%E4%BB%B6%E6%8E%A5%E7%BA%BF2.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=LDpiGWJJ1Vru220Cmb/yalUphkw=)

   硬件接线
2. 查看 COM 口编号：打开设备管理器，查看是第几个 COM 口。
3. 设置串口参数

> 波特率: 115200 数据位: 8 奇偶校验: None 停止位: 1，注意：RTS/CTS 不要选。

4. 查看打印信息

log

```
miio_client [6:100]  
[  INFO] [08:00:00.198 ] miio_instance: skip auto_recovery...  
[  INFO] [08:00:00.203 ] miio_client_func: OT agent listen fd: 4  
[  INFO] [08:00:00.209 ] miio_client_func: BT conn listen fd: 5  
[  INFO] [08:00:00.217 ] miio_client_func: netlink listen fd: 6  
[  INFO] [08:00:00.224 ] miio_client: pollfds[0]: 4  
[  INFO] [08:00:00.230 ] miio_client: pollfds[1]: 5  
[  INFO] [08:00:00.236 ] miio_client: pollfds[2]: 6  
[ DEBUG] [08:00:00.242 ] miio_client: miio_common init  
mible_mesh_common_bt [14:100]  
NSH auto exit.  
[net_config_debug]:wifi scan finished, 4 25c829b1922d3123_miwifi found.  
[net_config_debug]:bingo ssid=25c829b1922d3123_miwifi, bssid=56:D2:F5:EA:4B:8D, pri=1, rssi=-22  
[net_config_debug]:wlan0 link up  

```

> **注意：**
>
> 如果选择的是 ESP32-WROOM-32D(32U) 系列或者 MHCWB6 系列通用模组，且固件版本分别在 2.2.6 及以上、1.0.7 及以上，模组会默认关闭日志输出，启动后会打印少量日志后再无任何输出，如果需要查看模组运行日志，请使用 set\_log\_level log\_level 指令进行打开，log\_level 范围为 0 ~ 5, 0 表示开启 debug 日志，5 表示关闭日志打印。

**四. MCU 通信**

1. **硬件接线：模组的 IO20, IO21 和 GND 接到串口板，串口板接到 PC 的 USB 口，这两个引脚是模组与 MCU 的通信串口**

   ![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/8c2c8b7bff6a2093e485bd259ee071cd_PC%E7%A1%AC%E4%BB%B6%E6%8E%A5%E7%BA%BF3.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=+qOEfZ8M1VJ0ZPYaVSZoZPquj7c=)

   串口接线
2. **Wi-Fi log 串口日志输出（左图），MCU 命令串口输出（右图）**

   ![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/0d536a35245679c29cb9e5e708c9d47f_log_cmd.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=H5cUudsCCKiqT0kzoW4NKKmHbmY=)

   串口 log
3. **获取产品的 model 与 pid**

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/8bba23af5ea8aa0f551ffd98151a378c_1730447202661.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=UzrjRKKP1E9cH53glb44yBM9W+o=)

   产品 model 和 pid

|                            | **MCU 发送**            | **模组回复** |                                                |
| -------------------------- | ----------------------------- | ------------------ | ---------------------------------------------- |
| **测试命令**         | `get_down`                  | `down_none`      | 有回复正确的字符及命令口连接正确               |
| **设置 log 打印**    | `set_log_level 0`           | `ok`             | 0:代表 log 打印等级为 debug                    |
| **设置 model**       | `model miot.light.demo22`   | `ok`             | miot.light.demo22 :设备 model（产品/基本信息） |
| **设置 PID**         | `ble_config set 14896 0001` | `ok`             | 14896 :设备 PID（产品/基本信息）               |
| **设置 mcu version** | `mcu_version 0001`          | `ok`             | 0001 为 MCU 版本                               |

重要串口命令说明

具体命令格式参考：[**《串口通讯协议》**](/v2/new/doc/embedded-dev/module-dev/function-dev/serial-communication)

4. **重启设备** 串口工具输出下面信息：

log

```
[  INFO] _|      _|  _|_|_|  _|_|_|    _|_|  
[  INFO] _|_|  _|_|    _|      _|    _|    _|  
[  INFO] _|  _|  _|    _|      _|    _|    _|  
[  INFO] _|      _|    _|      _|    _|    _|  
[  INFO] _|      _|  _|_|_|  _|_|_|    _|_|  
[  INFO] JENKINS BUILD NUMBER: N/A  
[  INFO] BUILD TIME: Feb 21 2023,15:04:02  
[  INFO] BUILT BY: N/A.  
[  INFO] MIIO APP VER: 1.0.1          // WI-FI Version  
[  INFO] MIIO MCU VER: 0001           // MCU Version  
[  INFO] MIIO DID: 462033xxx          // DID：device ID  
[  INFO] MIIO WIFI MAC: b460edbd133d  // MAC  
[  INFO] MIIO MODEL:miot.light.demo22 // model  
[  INFO] ARCH TYPE: BL602,0x00000000  // 芯片平台  
[  INFO] ARCH VER      : 9.1.0-RC1-962120873c  
[  INFO] FLASH INFO: manufacturer(0x16), memory type(0x40), capacity(0xc8)  

```

> 说明：
>
> 1. MIIO App VER: **1.0.1** 代表模组固件版本是 1.0.1
> 2. MIIO MODEL: **miot.light.demo22** 代表产品的 model
> 3. MIIO DID: **462033xxx** 是 DID(Device ID)，由小米平台发放

## 设备配网

使用[具有开发者权限的账号](/v2/new/doc/configuration/signin#%E5%8A%A0%E5%85%A5%E5%B7%B2%E6%9C%89%E4%BC%81%E4%B8%9A%E7%BB%84)登录 **米家 App**，并通过添加设备连接该模组，将该模组连上云端。([发现不了设备？](/v2/new/doc/embedded-dev/module-dev/mcu-faq#%E7%B1%B3%E5%AE%B6%20App%20%E6%97%A0%E6%B3%95%E6%89%BE%E5%88%B0%E8%AE%BE%E5%A4%87))

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/6c386b329f260b5d0d47feff64a04faa_1702349964770.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=vGOoODzK4IvuPr1Z6GCQVgkalfE=)

设备配网

## 设备控制

### 进入插件控制

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/28f45c59c56334d80b4f86b54821adf1_rn_contorl.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=tN174Tqc3m2cbTt2r6E5JdiNgOY=)

插件控制

**插件控制开关**

log

```
TX: get_down  
RX: down set_properties 2 1 false  
TX: result 2 1 0  
  
// properties_changed 更新云端状态  
TX: properties_changed 2 1 false  
RX: ok  

```

**模组 log**

log

```
 // 插件控制开关  
 ots: {"from":"4","id":39950136,"method":"set_properties","params":[{"did":"462033xxx","piid":1,"siid":2,"value":true}]}.  
 ot: set_properties[id=39950136] is a ext methodmiio_ot: ext rpc recvd  
 miio_instance: miio_ext_rpc_hook_default called  
 tou: recv=get_down  
 mcmd: ext rpc[id=39950136]  
 mcmd: set_properties found  
 tou: send=down set_properties 2 1 true  
 miio_monitor: work time = 1566s, memory left = 42624  
 tou: recv=result 2 1 0  
 mcmd: state=1, timeout=3723, ts=1566145, now=1566196  
 ot: ot_down_rpc_delegate_ack_handle(), 510, malloc_len: 145, pload_len: 73  
 ot: ot_down_rpc_delegate_finish(), 423, id: 39950136, timestamp: 0, tick: 0, pload_len: 73  
 ots: ots_down_rpc_delegate_ack(), 243, ack: {"id":39950136,"result":[{"did":"462033xxx","siid":2,"piid":1,"code":0}],"exe_time":363}, len: 88  
 ots: rpc_cnt = 100[100], rpcack_cnt = 31[31], costtime = 18373[544,542]  
  
 // properties_changed 更新云端状态  
 tou: recv=properties_changed 2 1 false  
 tou: send=ok  
 miio_monitor: work time = 1896s, memory left = 42880  
 mcmd: 1 properties flushed  
 ots: ots_up_rpc_delegate_out_cb(), 348, {"id":967312993,"method":"properties_changed","params"[{"did":"462033xxx","siid":2,"piid":1,"value":false}]}  
 ots: recvd 39Bytes  
 ots: req or ack recvd.ots: {"id":967312993,"result":"ok"}.  

```

### 小爱同学控制

语料: **“打开灯”**

**命令串口**

log

```
 TX: get_down  
 RX: down set_properties 2 1 true  
 TX: result 2 1 0  
  
 // properties_changed 更新云端状态  
 TX: properties_changed 2 1 true  
 RX: ok  

```

## 02 准备工作

### 平台接入准备

#### 明确产品类型

# 明确产品类型

更新时间：2024/11/06

开发者选择将硬件产品接入小米 IoT 平台前，需要首先明确平台支持开放的产品类型。

## 开放接入产品类型

小米 IoT 平台目前已经支持且开放了 200 多种产品品类，供开发者按需选择，详情参见下表开放支持的产品品类。同时，更多品类也在持续开放中，恭请期待。

> **说明：**
>
> * 请开发者正确选择产品的类型，一旦产品类型选择错误，产品将无法正常上线；
> * 若开发者对待接入产品所属的产品类型有疑问，请[&#34;提交工单&#34;](https://iot.mi.com/fe-op/personalCenter/feedback)，选择标签"产品方案与流程咨询"-"新品开发"咨询。

| **产品类型** | **包含产品**                                                                                                                                                                                                                                                                                                                 |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 照明               | 灯、夜灯、调光控制器、拾音灯                                                                                                                                                                                                                                                                                                       |
| 卫浴               | 马桶（盖）、热水器、浴霸、毛巾架                                                                                                                                                                                                                                                                                                   |
| 传感器             | 温湿度传感器、人体传感器、烟雾传感器、燃气传感器、窗磁/门磁、水浸传感器、光照度传感器、存在传感器、动静传感器、气象传感器                                                                                                                                                                                                          |
| 插座开关           | 插座/插排、开关、插卡取电器、继电器控制模块、无线开关、控制面板                                                                                                                                                                                                                                                                    |
| 家居安防           | 摄像机、可视门铃、门铃、门锁、防丢器、智能电表、报警器、智能门、保险箱、电梯、对讲机                                                                                                                                                                                                                                               |
| 厨房电器           | 电烧烤炉、米机、电解水生成器、集成灶、恒温酒柜、炒菜机、凉霸、果蔬净化机、水杯、软水机、电饼铛、暖奶器、饮水机、空气炸锅、储酒罐、多功能料理锅、冰箱、微波炉、电热水壶、净水机、咖啡机、冲奶器、电饭煲、抽油烟机、电磁炉、压力锅、洗碗机、榨汁机、蒸烤箱、电蒸锅、消毒柜、米箱、养生壶、厨房秤、垃圾处理器、计时器、制冰机、智能灶 |
| 娱乐影音           | 音箱、投影仪、智能手机、分体电视、IPTV 机顶盒、DVD/CD、故事机、收音机、机器人、耳机、时钟、雕刻机、飞镖靶、电视、摄影摄像、电视柜、电视盒子、麦克风                                                                                                                                                                                |
| 出行车载           | 储能电源、车载音箱、平衡车、随身 Wi-Fi、旅行箱、自行车、汽车、机械键盘、车载空气净化器、行车记录仪、滑板车、胎压监测器、智能后视镜、车载充电器、平视显示器、码表、手机支架、车载冰箱、汽车氛围灯                                                                                                                                   |
| 运动健康           | 血压计、摇表器、手表、体重/体脂秤、体温计、睡眠监测仪、智能口罩、智能鞋、按摩器、按摩椅、手环、医药箱、智能水杯、轮滑鞋、走步机、睡眠仪、健身车、跑步机、艾灸器、心电仪、足浴器、甩脂机、制氧机、身姿矫正器、暖宫带、跳绳、划船机、水推进器                                                                                        |
| 环境电器           | 新风机、加湿器、空调插座、电暖器、香薰机、空调、风扇、温控器、空气检测仪、空气净化器、除湿机、降噪器                                                                                                                                                                                                                               |
| 办公学习           | 手写板、点读笔、打印机、智能桌、办公椅、日历                                                                                                                                                                                                                                                                                       |
| 清洁电器           | 扫地机器人、洗衣机、擦地机、烘干机、吸尘器                                                                                                                                                                                                                                                                                         |
| 路由网关           | 路由器、Wi-Fi 信号放大器、网关                                                                                                                                                                                                                                                                                                     |
| 个护与起居         | 驱蚊器、蒸汽眼罩、剃须刀、吹风机、冲牙器、咬奶器、电子阀门、智能镜、垃圾桶、牙刷、电机控制器、电热毯、开窗器、智能床、窗帘电机、卷帘电机、干衣/鞋机、沙发、美容仪、智能枕头、洁面仪、智能床垫、洗手机                                                                                                                              |
| 宠物与植物         | 猫砂盆、宠物饮水机、宠物投食器、宠物玩具、植物监测仪、智能种植器、浇花器、智能鱼缸、杀菌灯、生态箱、宠物项圈                                                                                                                                                                                                                       |
| 其他               | 家具工具、智能硬盘、泵、模组/开发板、米键、协议转接器、UWB 遥控、红外遥控器、干手机、配件                                                                                                                                                                                                                                          |

支持开放的产品品类

## 申请新增产品类型

若目前支持开放的产品品类不能满足开发者的产品开发需要，可根据以下步骤申请新增产品类型：

> **说明：**
>
> 由于申请新增产品品类需经小米 IoT 平台审核，并在审核通过后配置相关参数，因此创建新品类的时间较长，请开发者在提交创建新产品品类后耐心等待。

### 前提条件

1.在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[成为开发者](/v2/new/doc/configuration/signin/create-enterprise)；

2.[登录平台](https://iot.mi.com/fe-op/productCenter)。

### 操作步骤

#### 第 1 步 - 填写申请需求书

请开发者参考[&#34;功能列表示例（灯）&#34;](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_doc_e6e5a414f11ddb78aed00bc6d1e6a803.doc)填写[&#34;新品类开放申请需求书（模板）&#34;](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_doc_73c043e221051975d38fa79979253e51.doc)。

#### 第 2 步 - 提交新品类申请

在小米 IoT 开发者平台中，【控制台 - 管理 - 平台资源申请 - Spec 新品类申请】，[申请](https://iot.mi.com/fe-op/manageCenter/projectApply/index)创建新的产品品类，并等待审核通过。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e84d4b7158fdbcc9b5626b3b817d3796_1730440264799.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=4DP6n+/LCw0hVOmiOB+DcI+V2C4=)

新增资源申请

#### 第 3 步 - 使用新品类创建产品

审核通过后，即可使用新品类[创建产品](/v2/new/doc/configuration/create)。

#### 选择接入方式

# 选择接入方式

更新时间：2024/11/06

为满足各种开发场景，小米 IoT 开发者平台提供了以下两类主流接入方式，开发者可以根据产品和自身研发情况选择合适的方式接入：

* **直连接入**：又称"使用小米 IoT 模组/ SDK 接入小米 IoT "，是一种开发者无需自建平台或借助其他平台，即可直接将硬件产品接入小米 IoT 平台的接入方式，是小米 IoT 平台推荐开发者使用的主要接入方式。
* **云对云接入**：是一种开发者将已接入其他平台的产品，通过 OAuth 等协议接入小米 IoT 平台的接入方式。

| **开放能力**                                   | **直连接入** | **云对云接入** |
| ---------------------------------------------------- | ------------------ | -------------------- |
| 米家 App 控制                                        | 支持               | 不支持               |
| 小爱语音控制                                         | 支持               | 支持                 |
| 设备互联互通                                         | 支持               | 不支持               |
| 接入其他类型的控制应用如网页、小程序和其他应用平台等 | 支持               | 不支持               |

不同接入方式支持的开放能力对比

## 直连接入

又称"使用小米 IoT 模组/ SDK 接入小米 IoT "，是一种开发者无需自建平台或借助其他平台，即可直接将硬件产品接入小米 IoT 平台的接入方式，是小米 IoT 平台推荐开发者使用的主要接入方式。

这种接入方式，具有以下优势：

* 该接入方式的成本低，且接入效果稳定；
* 接入后的产品能够直接获得米家 App、小爱语控和智能联动的能力；
* 接入小米 IoT 平台的硬件产品可对接其他 IoT 平台和应用，如 Alexa 和天猫精灵等；
* 可被开发者自己开发的 App 独立控制（开发者只能控制自己的硬件产品，无法控制接入小米 IoT 平台的其他产品）。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/7ff9e5c9f3746e6ff23463cf83014dba_%E6%96%B9%E6%A1%881.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=RwBgQamuwwqxEyhoK/sqRcG29RE=)

直连接入（即“使用小米 IoT 模组/ SDK 接入”）

基于直连接入方式，平台提供了以下 3 种方案，详见下表：

| **接入方式** | **使用场景**                                                                                                                                      |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Wi-Fi 接入方案     | 适用于放置在家庭中、有电源常供电、且用户多以单个产品购买使用的产品，如空调、吸顶灯、加湿器、扫地机、摄像机等                                            |
| BLE 接入方案       | 适用于： - 低功耗的硬件产品，如手环、按摩器等穿戴类产品； - 放置于家庭中、由电池供电的产品，如传感器、智能门锁等； - 部分车载类产品，如车载空气净化器等 |
| BLE Mesh 接入方案  | 适用于低功耗，需大批量部署，且**有数据上报和指令接收** 操作的硬件产品，如灯、开关等                                                               |

直连接入3种接入方案适用场景

### Wi-Fi 接入方案

适用于放置在家庭中、有电源常供电、且用户多以单个产品购买使用的产品，如空调、吸顶灯、加湿器、扫地机、摄像机等。在 Wi-Fi 接入方案下，开发者可根据产品具体使用的操作系统，选择合适的固件开发方式：

* **产品无操作系统或使用 RTOS 系统**
  + [Wi-Fi 通用模组开发](/v2/new/doc/quick-started/standard-module)（适用于集成 MCU 的硬件产品）
  + [Wi-Fi SDK 开发](/v2/new/doc/quick-started/sdk-module)（适用于未集成 MCU 的硬件产品）
  + [Wi-Fi INC SDK 开发](/v2/new/doc/quick-started/inc-module)（适用于未集成 MCU 的硬件产品）
* **产品使用 Linux 系统或 Android 系统**开发者根据硬件产品所使用的系统，
  + [Linux OT SDK 开发](/v2/new/doc/quick-started/linux-ot)

### BLE 接入方案

适用于低功耗的硬件产品，如手环、按摩器等穿戴类产品；放置于家庭中、由电池供电的产品，如传感器、智能门锁等；部分车载类产品，如车载空气净化器等；

更多开发详情，请参考 [BLE SDK 开发](/v2/new/doc/quick-started/ble-sdk)。

> **注意：**
>
> 平台不再推广 Zigbee 的接入方案，传感器品类产品推荐使用 BLE 接入方案。

### BLE Mesh 接入方案

适用于低功耗，需大批量部署，且 **有数据上报和指令接收** 操作的硬件产品，如灯、开关等；

更多开发详情，请参考 [BLE Mesh SDK 开发](/v2/new/doc/quick-started/mesh-module)。

> **说明：**
>
> * 如果相关产品还不支持 BLE Mesh 接入，请联系产品经理进行申请评估；
> * 有关支持 BLE Mesh 能力的网关信息，可在米家 App "发现" - "产品百科全部" - "网关攻略"中查看。

## 云对云接入

“[云对云接入小米 IoT 平台](/v2/new/doc/resources-and-services/cloud-access/overview)”是一种开发者将**已接入其他平台的产品**，通过 OAuth 等协议接入小米 IoT 平台的开发方式。通过"云对云"的方式接入的硬件产品，只能够获取小爱语控的能力，支持被具有小爱同学能力的音箱所控制。

> **说明：**
>
> 通过“云对云”方式接入小米 IoT 平台的硬件产品仅支持获取小爱语控的能力，无法使用小米 IoT 平台开放的其他能力。为了降低硬件产品接入云平台的开发成本和运营成本，提高产品的智能化能力，推荐开发者使用[直连接入](/v2/new/doc/introduction/preparation/access_mode#%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%85%A5)的方式将产品接入小米 IoT 平台。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/67990a49aeb935dcaa1ddf891ca656fc_1730880084716.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Jb4mQo/OcV6dayz3N+42aydI+qM=)

云对云接入小米 IoT 平台

#### 确认接入方案

# 确认接入方案

更新时间：2024/11/06

确认过产品类型和接入方案后，需要根据团队的研发实际确定接入小米 IoT 平台的方式。

为满足各类开发者的接入诉求，平台提供了以下接入方式以供选择：

| **接入方式**                                                                                                                                | **适用场景**                                                                                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [自主接入](/v2/new/doc/introduction/preparation/access_type#%E8%87%AA%E4%B8%BB%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B)                                  | 开发者具备完整的软硬件开发能力，能通过小米 IoT 平台提供的资源和工具，自主将产品接入到平台                                                                                                                                                                                                                                                 |
| [服务商接入](/v2/new/doc/introduction/preparation/access_type#%E6%9C%8D%E5%8A%A1%E5%95%86%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B)                       | 如开发者接入经验不足或研发能力有限，又希望快速高效接入小米 IoT 平台。可以通过平台官方认证，具有专业资质的服务商，替您：- 全程托管，代为高效将产品接入平台 - 开发软/硬件产品功能，等 更多服务商详情信息，请参考[小米 IoT 服务商](https://iot.mi.com/fe-op/ServiceProvider?)                                                                   |
| [免开发极速接入](/v2/new/doc/introduction/preparation/access_type#%E5%85%8D%E5%BC%80%E5%8F%91%E6%9E%81%E9%80%9F%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B) | 如开发者接入经验不足或研发能力有限，又希望快速高效接入小米 IoT 平台。可以选择平台官方认证的[免开发解决方案](https://iot.mi.com/fe-op/solutionCenter/market)，无需编程经验，功能定义、App 界面设计、固件代码等自动生成，由方案服务商提供具备完整功能固件的模组, 即插即用, 可快速投入成品试量产 说明：目前仅支持窗帘电机、开关、灯三种产品类型 |

平台接入方式对比

## 自主接入流程

开发者具备完整的软硬件开发能力，能通过小米 IoT 平台提供的资源和工具，自主将产品接入到平台。

通过自主接入的方式，将产品接入小米 IoT 平台，需要经过以下流程：

| **开发方案** | **接入流程**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 直连接入           | [1、成为开发者](/v2/new/doc/configuration/signin/create-enterprise) [2、创建产品](/v2/new/doc/configuration/create) [3、基础配置](/v2/new/doc/configuration/configuration) [4、功能定义](/v2/new/doc/configuration/define-features) [5、扩展程序配置](/v2/new/doc/configuration/extension-development/extension-development) [6、固件配置](/v2/new/doc/configuration/firmware/firmware) [7、高阶配置](/v2/new/doc/configuration/advance-configure/network-distribution) [8、自测与预约](/v2/new/doc/configuration/test-reservation) [9、产品申请上线](/v2/new/doc/configuration/publish-product)                                               |
| 云对云接入         | [1、成为开发者](/v2/new/doc/configuration/signin/create-enterprise) [2、基础服务器](/v2/new/doc/resources-and-services/cloud-access/config-params) [3、创建产品](/v2/new/doc/resources-and-services/cloud-access/create-product) [4、定义产品功能](/v2/new/doc/resources-and-services/cloud-access/define-instance) [5、适配平台协议](/v2/new/doc/resources-and-services/cloud-access/adapt-protocol) [6、功能调试](/v2/new/doc/resources-and-services/cloud-access/debug) [7、自测与预约](/v2/new/doc/resources-and-services/cloud-access/test-reservation) [8、产品上线](/v2/new/doc/resources-and-services/cloud-access/publish-product) |

接入方式

## 服务商接入流程

如开发者接入经验不足或研发能力有限，又希望快速高效接入小米 IoT 平台。可以通过平台官方认证，具有专业资质的[服务商](https://iot.mi.com/fe-op/ServiceProvider?)，代为将产品接入平台。

通过服务商的方式，将产品接入小米 IoT 平台，需要经过以下流程：

1. [按需选择合适的服务商](https://iot.mi.com/fe-op/ServiceProvider?)；
2. **联系服务商**：通过服务商落地页，获取服务商信息。然后，和服务商就服务范围和价格达成一致；

> **说明：**
>
> 小米 IoT 平台仅作为认证和提供优质服务商的渠道，过程中不收取任何费用。

3. **服务商代为接入**：服务商按照方案合同，代替开发者将产品接入到小米 IoT 平台。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/1b654ef29a15273177d9abc7b5fee4fc_1730440785181.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=84wVRn1dLDwhGwD4iDFA6t1V38s=)

服务商接入

## 免开发极速接入流程

小米 IoT 开发平台提供的经认证的[免开发解决方案](https://iot.mi.com/fe-op/solutionCenter/market)，仅需开发者确认方案后申请使用即可快速完成产品接入。无需编程经验，功能定义、App 界面设计、固件代码等自动生成，由方案服务商提供具备完整功能固件的模组, 即插即用, 可快速投入成品试量产。

> **说明：**
>
> * 目前仅支持窗帘电机、开关、灯三种产品类型，其他类型持续更新中，恭请期待；
> * 使用免开发方式前，需要提前在小米 IoT 平台[注册企业](/v2/new/doc/configuration/signin/create-enterprise)且被审核通过，且登录平台。

通过免开发的方式，将产品接入小米 IoT 平台，需要经过以下流程：

1. [进入解决方案中心](https://iot.mi.com/fe-op/solutionCenter/market)

| **解决方案入口**                                                                                                                         | **图例** |
| ---------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| 入口一：【开发者平台 - 控制台 - 产品】页面右侧方案中心模块，点击进入方案中心                                                                   |                |
| 入口二：新建产品时，选择完「产品类型」、「联网方式」后，对于已有成熟解决方案的产品，「开发方式」会出现"选择成熟方案"选项，选择后可进入方案市场 |                |

解决方案中心入口

2. **寻找合适方案**：点击查看方案，进入详情确认方案是否满足自己需求；

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/8557931cc3ef0f64d6648ef109a06365_1730441816089.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fttlPjjOUoB+Kv2f/K6ccx5KbXk=)

解决方案中心

3. **预约咨询：** 如需进一步进行深入了解，可填写手机号码预约方案咨询，预约后将获得方案服务商 1V1 专属技术支持，服务商会根据您的需求推荐合适方案;

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e260d7da5eeff283ee125a5e1ae702ea_1730441946902.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=dUe6dX6hFxtlxVBYgSs++tcCyow=)

预约咨询

4. **申请使用方案：** 确定使用该免开发解决方案，可点击【申请使用方案】按钮进行申请，申请的方案经方案服务商确认后，即会创建一个免开发产品；

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/5e6ab79f1d2ecf2f0f300ec96192597d_1730442080112.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=+kaMaQs8bnYFaLOvybpB13N4SOo=)

申请使用方案

5. **查看申请记录：** 在【我的申请】页面可查看所有方案申请、预约咨询记录。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/f0b7166293ae462aebe42828467405fe_1730442294327.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=a06dinQqR4b1IGfFlE33kcyPQko=)

查看申请记录

### 产品开发准备

#### 成为开发者

# 注册企业开发者

更新时间：2024/11/06

有 2 种途径可以注册成为企业开发者：

1. 如果企业信息未在小米 IoT 平台注册过，请参考本文【注册企业开发组】进行注册。
2. 如果企业已注册过企业组，请联系企业组内的相关同事参考本文【加入已有企业组】成为企业开发者。

> **说明：**
>
> * 如果开发者已加入企业组，可以跳过这一节，直接阅读[创建产品](/v2/new/doc/configuration/create)；
> * 目前小米 IoT 平台仅面向中国大陆地区注册成立的公司开放；
> * 每个企业仅支持创建一个企业开发组，但每个企业组中可创建多个品牌；企业组中，可以添加多个开发者，且每个开发者可以加入多个企业组。

## 概念说明

* **企业开发组：** 又称“企业组”，开发者通过（创建/加入）企业组，来使用小米 IoT 平台开放的资源和能力，每个开发者可以加入多个企业组。
* **企业名称：** 是企业组的全称，作为在平台登录后展示使用，注册时一经提交后不可更改。
* **企业简称：** 平台支持每个企业组设定自己的企业简称，一般“企业简称”不可和“企业名称”重复，注册时一经提交后不可更改。
* **企业标识：** 是企业开发组在平台的唯一标识，由企业自行设定，限 3-6 位小写字母或数字；同时，它也是企业在创建产品时，产品 model 的重要组成部分之一。

## 前提条件

1. [提前注册小米账号](https://cn.account.xiaomi.com/fe/service/register?bizDeviceType=&theme=&_uRegion=CN&needTheme=false&showActiveX=false&serviceParam=%7B%22checkSafePhone%22%3Afalse%2C%22checkSafeAddress%22%3Afalse%2C%22lsrp_score%22%3A0.0%7D&_locale=zh_CN&_sign=ZGoZscMwrmloqgDqH2KkxMqVwAs%3D&source=&region=CN&sid=xiaomiiot&qs=%253Fcallback%253Dhttps%25253A%25252F%25252Fiot.mi.com%25252Fsts%25253Fsign%25253D9KcOCKVOL4cwCaIPE%2525252Beaxpqmhek%2525253D%252526followup%25253Dhttps%2525253A%2525252F%2525252Fiot.mi.com%2525252Fcgi-op%2525252Fapi%2525252Flogin%2526sid%253Dxiaomiiot&callback=https%3A%2F%2Fiot.mi.com%2Fsts%3Fsign%3D9KcOCKVOL4cwCaIPE%252Beaxpqmhek%253D%26followup%3Dhttps%253A%252F%252Fiot.mi.com%252Fcgi-op%252Fapi%252Flogin)；
2. 通过小米账号，[登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)。

## 操作步骤

以下介绍如何创建新企业组和如何加入企业组。

### 创建新企业组

如果企业信息尚未在小米 IoT 平台注册过，请先注册企业开发组。

#### 第 1 步 - 注册企业开发组

注册入口如下：

| 入口                                                                                                                                                                                    | 图例 |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---- |
| 【入口一】 登录小米 IoT 平台后，若开发者尚未创建或加入任一企业开发组，可在以下入口申请加入：- 点击**控制台**,点击【注册成为开发者】。 - 在小米 IoT 开发者首页，点击【立即加入】。 |      |
| 【入口二】 登录小米 IoT 平台后，若开发者已有企业组，点击右上角**个人中心**，点击左侧**所属企业组**进入所属企业组页面，点击【注册企业开发组】。                              |      |

注册企业组入口

#### 第 2 步 - 填写企业组信息

按要求依次填写企业基本信息、联系人信息和合作意向，勾选“我已阅读并同意《小米 IoT 开发者平台合作协议》和《小米 IoT 开发者平台隐私规则》”。

| 页面           | 填写项                                                                                                                                      | 说明                                                                    |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| 企业基本信息   | 企业全称                                                                                                                                    | 必填。 指企业名称，作为在平台登录后展示使用，注册时一经提交后不可更改。 |
| 企业简称       | 必填。 平台支持每个企业组设置自己的企业简称，一般“企业简称”不可和“企业名称”重复，注册时一经提交后不可更改。                             |                                                                         |
| 企业标识       | 必填。 指企业开发组在平台的唯一标识，由企业自行设定，限 3-6 位小写字母或数字；同时，它也是企业在创建产品时，产品 model 的重要组成部分之一。 |                                                                         |
| 企业法人       | 必填。 企业法人与营业执照上的一致。                                                                                                         |                                                                         |
| 企业地址       | 必填。 企业的地址。                                                                                                                         |                                                                         |
| 官网           | 选填。 企业的官方网站地址。                                                                                                                 |                                                                         |
| 营业执照       | 必填。 jpg/jepg 格式，4MB 以内。                                                                                                            |                                                                         |
| 企业简介       | 必填。 企业的简介。可以上传附件。                                                                                                           |                                                                         |
| 联系人信息     | 姓名                                                                                                                                        | 注册人的姓名。                                                          |
| 职务           | 注册人的职务。                                                                                                                              |                                                                         |
| 联系电话       | 注册人的联系电话。                                                                                                                          |                                                                         |
| 邮箱           | 注册人的邮箱。                                                                                                                              |                                                                         |
| 名片           | jpg/jepg 格式，4MB 以内。                                                                                                                   |                                                                         |
| 合作意向       | 拟合作产品介绍                                                                                                                              | 选填。                                                                  |
| 拟申请平台服务 |                                                                                                                                             |                                                                         |
| 合作来源选项   |                                                                                                                                             |                                                                         |
| 注册企业       |                                                                                                                                             |                                                                         |

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/a4aa429e231b5b864f9a3aa871687977_1720429530818.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=u2Hbsm5YdExzIp7Kl2973b4PPNE=)

填写企业基本信息

#### 第 3 步 - 提交申请

点击“提交”按钮进入审核状态。提交企业注册信息后，小米 IoT 平台将在 3 个工作日内，完成开发者企业信息的审核。审核期间，开发者可以在「个人中心 - 所属企业组」中，查看企业组审核状态。

> **说明：**
>
> * 企业组审核通过前，开发者无法使用小米 IoT 开发者平台上的功能；
> * 审核通过后，申请注册企业组的小米账号将作为企业组的“拥有者”，拥有企业组中的所有的功能权限；企业“拥有者”和“管理员”可通过“移交企业开发组”或“变更企业组管理员”功能，移交企业开发组或变更企业组管理员。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/722855f33c3e3e5ed01de80c083fe8c4_1720436385268.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=JnVkBvTQuqeChjWTiVcL+VP+NEA=)

提交企业组信息

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/164aed5f70d1aabc833918eed26cf202_1730776900297.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fDgkGa9WWaGd0S7zp15HMFHcnmo=)

企业组审核状态

### 加入企业组

如果开发者所在的团队已有企业组，请联系企业组“拥有者”或“管理员”，企业组“拥有者”或“管理员”在「控制台 - 管理 - 成员管理 - 企业成员」中，点击“添加成员”将开发者添加为企业成员，添加成功后开发者即可通过该企业组，使用平台的资源和功能。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/6db8b94a5b20c8ea4677edf1a47e8ad0_1730777195583.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Zw62C/BdjU8CF4EcbQdqeITpuwY=)

添加企业成员

## 后续操作

其他关于企业组管理的功能介绍，请参考[管理企业组](/v2/new/doc/configuration/signin/manage-enterprise)、[企业成员管理](/v2/new/doc/configuration/signin/manage-member)。

#### 创建产品

# 创建产品

更新时间：2024/12/31

需要根据硬件设备和研发团队的实际情况确定设备接入小米 IoT 平台的方式，以下介绍[自主接入](/v2/new/doc/introduction/preparation/access_type)时如何创建产品。

> **注意：**
>
> 1. 创建产品后，为避免影响产品开发上市周期，产品能顺利通过审核上线，建议在开发初期，就在「控制台 - 产品 - 产品详情页 - 自测与预约」中，下载最新的自测资料，明确认证审核标准，详情请参考[自测与预约](/v2/new/doc/configuration/test-reservation)。
> 2. 若开发者的产品需要在指定的时间发布上线，请开发者在创建产品时，先[提交工单](https://iot.mi.com/fe-op/personalCenter/feedback)报备产品上线的时间和产品类型，工单标签选择"产品方案与流程咨询 - 新品开发"。
> 3. 请开发者至少提前 3 个月创建产品并开始研发产品功能，否则小米 IoT 平台有权拒绝验收开发者的产品。

## 前提条件

1. 通过小米账号，[登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)。
2. [已成功创建企业组](/v2/new/doc/configuration/signin/create-enterprise)或已加入团队所在的企业组。
3. 确保待创建品类平台已开放支持，详情请参考[明确产品类型](/v2/new/doc/introduction/preparation/product_type)。

## 操作步骤

以下介绍通过[自主接入方式](/v2/new/doc/introduction/preparation/access_type)接入的 2 种创建产品的方式。其他接入方式请参考[确认接入方案](/v2/new/doc/introduction/preparation/access_type)。

* 新建产品：适用于需要开发新产品的场景。
* 复制产品：适用于产品与已有产品的功能、配置相同或相似的场景，可通过点击"复制产品"来新建产品。

> **说明：**
>
> * 从未上线过产品的企业，创建产品的数量上限为 40 个，开发者可以删除无用产品后继续创建；只要企业上线过 1 个产品则无数量限制。
> * 若产品的软件功能与已有产品完全相同，但是硬件结构、硬件的 PCBA 和产品外观等硬件特征不同，则需要新建产品。
> * 若产品的软件和硬件功能与已有产品完全一样，仅有颜色差异，则无需**新建产品**或**复制产品**，选择一种颜色作为主色，在「控制台 - 产品 - 产品详情页 - 基础配置」的**产品拟物图**上传主色产品图片即可。

### 新建产品

#### 第 1 步 - 新建产品

进入「控制台 - 产品」页面，点击"新建产品"。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/3f489ba08beddc8ea71e891c8de4382d_1730777619365.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=OxEjS1w4r+1qFHljWadrhTl6x2M=)

新建产品

#### 第 2 步 - 填写产品信息

在弹窗中填写**产品类型**和**联网方式**。部分特定产品类型和联网方式的组合，会触发"自主开发"和"成熟解决方案"可供选择，具体设置请参考表**产品类型和联网方式的组合**。

**产品类型**：目前平台支持的产品类型请参考[平台已开放品类](/v2/new/doc/introduction/preparation/product_type#%E5%BC%80%E6%94%BE%E6%8E%A5%E5%85%A5%E4%BA%A7%E5%93%81%E7%B1%BB%E5%9E%8B)。

**联网方式**：指产品接入互联网的方式，用于设备与小米 IoT 平台进行通信，目前支持的联网方式有：WiFi、WiFi+BLE、BLE、Zigbee、BLE-Mesh、本地 AP、蜂窝网、PLC、仅网线。产品创建成功后不可更改。

| 产品类型            | 联网方式           |
| ------------------- | ------------------ |
| 个护与起居/窗帘电机 | BLE-Mesh           |
| 照明/灯             | BLE-Mesh、WiFi+BLE |
| 插座开关/开关       | BLE-Mesh           |

产品类型和联网方式的组合

* 如果开发者选择"自主开发"，则需要填写配网方式、产品名称和产品型号等信息，请参考表**创建产品信息**。

  ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/2a93ed12f469729fd24d6942faa913b2_1721216732489.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Um4blccrileT5uP/uZERnVy5/C0=)

  自主开发

  | 产品信息 | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
  | -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | 配网方式 | 指在米家 App 添加设备时帮助设备配网以接入小米 IoT 平台的方式。 不同的联网方式对应不同的配网方式，详情请参考[表不同联网方式和配网方式对应关系](/v2/new/doc/configuration/configuration#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4)。                                                                                                                                                                                                                                                                                                                               |
  | 产品名称 | 指显示在米家 App 上的简体中文产品名称。产品创建成功后可在[文案多语言配置](/v2/new/doc/configuration/advance-configure/multi-language)中修改产品名称。 **说明：*** 产品名称需与产品销售渠道、产品说明书上的产品名称一致。 * 为了避免出现产品名称重复的情况，请按 "品牌+品类+产品亮点" 的形式命名,品类需和平台产品类型保持一致。 * 未经允许，禁止在产品名称中包含小米旗下品牌关键字，例如小米、MI、xiaomi、米家、mijia、MIUI、Redmi、红米、小爱、米兔、MJ 和铁蛋等，更多要求请参考[认证商标使用规范](/v2/new/doc/resources-and-services/design/material)。 |
  | 产品型号 | 仅支持小写字母或数字，限制 6 字符以内，不能与本企业组同品类下的其他产品型号重复，产品创建成功后不可更改。**说明：**  产品创建后，产品型号作为产品 Model 的第 3 段。由于 Model 长度上限为 23 位，因此产品型号长度限制会因为不同企业的不同品类而有所不同。                                                                                                                                                                                                                                                                                           |
  | 品牌名称 | 在下拉框中选择该企业组下的品牌。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
  | 备注     | 选填。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

  创建产品信息
* 如果开发者选择"成熟解决方案"，请参考[免开发极速接入流程](/v2/new/doc/introduction/solution/development-free)。

  ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/f7ccc4ee16419ba1a2395f4edab39c43_1721216732465.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=JUKf+znBfqYwTDsyN1XtaraFTt4=)

  成熟解决方案

#### 第 3 步 - 提交信息

如果开发者选择"自主开发"，点击**确定**提交产品信息，完成产品创建。创建的产品会出现在产品列表中（见下图）。

平台会自动生成 Model 和产品 ID 这 2 个唯一标识信息，这 2 个标识信息无法更改。点击产品所在行进入配置页面，在左侧下方点击【基本信息】可查看 Model 和产品 ID。

* **Model**：创建产品后平台自动生成的产品唯一标识。由 3 段字母组合而成，第 1 段为**企业标识**（注册企业时填写的），第 2 段为**品类标识**（米家为品类定义的），第 3 段为创建产品时的**产品型号**。
* **产品 ID(Pid)**：创建产品后平台自动生成的产品唯一数字标识。它是一个整数数值。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/81a38ec4bd4bf04ff51c45ce7a9872b2_1730777685699.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=OmqhC4x6qTSZVHSweB314sWClXE=)

产品列表

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/1be70721799c4bb70cb6660f0cd79e41_1730777715340.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=+1AF/MyNtyDjd58itHZjsNNjMzk=)

基本信息

### 复制产品

**复制产品**功能方便开发者快速创建和已有产品功能相同、相似的产品。**复制产品**功能只支持对使用 Spec 标准协议的产品进行复制，仅可复制源产品在大陆的数据

1. 进入「控制台 - 产品 - 产品列表」，在对应的产品后点击【复制】，在弹窗中按需勾选"功能定义"、"扩展程序"、"使用帮助"、"产品百科"、"设备配网引导"、"隐私条款"、"消息推送"和"自动化"进行复制，源产品对文案多语言会自动复制。
2. 如需勾选“消息推送”、“自动化”，需先选择复制最新版本的“功能定义”。
3. 如需勾选“隐私条款”，需先选择扩展程序版本；如果隐私条款中的描述不适合本产品，请不要勾选隐私条款。
4. 点击【确定】，产品复制完成。

   复制后的各项配置可单独修改并申请上线，不影响源产品的配置情况。

> **说明：**
>
> 请在复制成功后确认各项配置是否有误，按需修改并发起上线流程。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/1fae3885518b8806c5dacbc202831e60_1730777752367.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ie5R2jvQfZXTQXh9IwWGYVnLpec=)

复制产品

## 后续操作

从未上线过产品的企业创建产品的数量上限为 40 个，开发者可以删除无用产品后继续创建。以下介绍如何删除产品。

在「控制台 - 产品」中，点击产品所在行的【删除按钮】，在弹窗中点击【确定】，产品删除成功。

> **说明：**
>
> * 仅企业组的"管理员"和"拥有者"角色，可删除未上线的产品。删除产品后，该产品的所有信息将无法恢复。
> * 删除产品后无法恢复，且无法再在该品类下创建相同型号的产品。
> * 重新创建的产品 ID 会不一样，如果产品 ID 已烧进较多设备，不建议删除。
> * 状态为**审核中**、**已上线**和**审核通过未上线**的产品无法删除。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/71fcb17e98d751d1f335ff66eb6a9a5f_1730777783662.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=+7lQ4nXVDfXFtMCPrntUulvaI8w=)

删除产品

#### 定义功能

# 定义产品功能

更新时间：2023/09/21

随着 IoT 产品品类的骤增，开发者定义 IoT 产品功能的方法各有不同且控制指令各异，产品间无法交互（智能联动）；为了统一接入小米 IoT 平台硬件产品的控制指令，使接入小米 IoT 平台的产品间智能联动；此外，也为了降低开发者使用小爱语音控制和快捷卡片等开放能力的成本，小米 IoT 平台根据硬件产品的联网方式、产品功能的特点、用户使用场景的特征和用户对硬件产品使用体验的要求，设计了描述硬件产品功能定义的标准规范（其他 IoT 平台称之为物模型）：小米 IoT 设备协议规范，MIoT Specification，即 MIoT-Spec，开发者在设计产品的智能化功能时，应参考本文档的内容了解小米 IoT 设备协议规范，并在此基础上设计产品的智能化功能。

**公开课**
借助公开课[《小米 IoT 产品功能定义指导》](/v2/new/doc/resources-and-services/open-classes)，开发者可高效并准确地定义产品的功能。

## 如何定义产品功能

为了方便开发者理解小米 IoT 设备协议规范中的内容，高效定义产品的功能，开发者可参考如下步骤，逐步分析并定义待接入产品的功能。

> **说明：**
>
> * MIoT-Spec 所定义的产品功能，覆盖了超过近百个设备品类，且定义内容持续丰富和更新，建议开发者关注小米 IoT 平台的最新动态；
> * 若产品类型表中缺失开发者产品所属的品类和标准功能，请参考“[申请平台资源](/v2/new/doc/resources-and-services/source)”中的内容申请新增产品品类、标准功能定义或描述词；
> * 由于申请新增产品品类、标准功能定义和描述词需经小米 IoT 平台审核，并在审核测试通过后配置相关参数，可能时间较长，请开发者在提交创建新产品品类后耐心等待。

### 步骤 1：明确设备功能

为了方便开发者快速定义产品的功能，开发者在定义产品功能前，首先需要明确产品的功能。

| 设备         | 风扇           | 霾表             | 灯泡         | 空气净化器       |
| ------------ | -------------- | ---------------- | ------------ | ---------------- |
| 功能1        | 可开关         | 可以查询空气质量 | 可开关       | 可开关           |
| 功能2        | 可调节风速     | 可充电           | 可调节亮度   | 可调节风速       |
| 功能3        | 可充电         | 可查询电量       | 可调节颜色   | 可查询滤芯生命值 |
| 功能 4       | 可查询电量     | 可查询充电状态   | 可度调节色温 | 可查询空气质量   |
| 功能 5       | 可查询充电状态 | -                | -            | -                |
| 设备功能举例 |                |                  |              |                  |

### 步骤 2：功能分组

将待接入设备性质相同的功能分为一组，功能分组后，每个设备可能会有多个功能组，小米 IoT 平台将功能组称为“服务”，有关小米 IoT 设备协议规范定义“服务”的详细内容，请参见下文“[服务规范定义](/v2/new/doc/resources-and-services/design/feature-define/feature-define#%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83)”。

* 电池类的功能：如充电、查询电量和查询充电状态等
* 空气质量传感器类的功能：如查询空气质量等
* 风扇类的功能：如调节风速等

| 设备         | 电风扇 | 霾表           | 灯泡 | 空气净化器     |
| ------------ | ------ | -------------- | ---- | -------------- |
| 功能组1      | 风扇   | 空气质量传感器 | 灯泡 | 风扇           |
| 功能组2      | 电池   | 电池           | -    | 空气质量传感器 |
| 功能分组举例 |        |                |      |                |

### 步骤 3：细化功能组中的功能

小米 IoT 平台将功能称为“属性”，有关小米 IoT 设备协议规范定义“属性”的详细内容，请参见下文“[属性规范定义](/v2/new/doc/resources-and-services/design/feature-define/feature-define#%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83)”。

| 功能组   | 风扇            | 电池           | 灯泡            |
| -------- | --------------- | -------------- | --------------- |
| 功能 1   | 可开关          | 可充电         | 可开关          |
| 功能 2   | 可调节/查询风速 | 可查询充电状态 | 可调节/查询亮度 |
| 功能 3   | -               | 可查询当前电量 | 可调节/查询色温 |
| 功能4    | -               | -              | 可调节/查询颜色 |
| 功能细化 |                 |                |                 |

### 步骤 4：设计方法

为了满足用户在不同场景中使用产品的需求，开发者可设计控制产品的“方法”，即通过向硬件产品下发多个控制指令，控制多个功能属性实现某一特殊的功能，如对“开关”、“电机”和“时间”属性下发“打开开关”、“调至中等风速”和“设置为傍晚 8~9 点”的控制指令，实现“在傍晚开启风扇并将调整风速为中等风速”的功能；此外，如果对某些属性的操作很耗时，也可使用方法，并可在操作完成后使用事件通知用户当前的状态，如开启摄像头视频流等；有关小米 IoT 设备协议规范定义“方法”的详细内容，请参见下文“[方法规范定义](/v2/new/doc/resources-and-services/design/feature-define/feature-define#%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83)”。

### 步骤 5：设计事件

为了方便用户及时了解产品的状态，开发者可创建事件，向云端上报硬件产品完成多个功能操作后的数据（多个属性的参数），告知用户产品当前的状态，多用于描述瞬间发生的动作，如饭已煮熟、门锁已开或洗衣机完成洗衣等；有关小米 IoT 设备协议规范定义“事件”的详细内容，请参见下文“[事件规范定义](/v2/new/doc/resources-and-services/design/feature-define/feature-define#%E4%BA%8B%E4%BB%B6%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83)”。

## 规范定义

为了帮助开发者快速定义产品的功能，小米 IoT 平台设计了“IoT 设备协议规范”，该规范定义了设备、服务、方法、事件和属性的具体内容。

### 实例定义规范

为了明确标识开发者接入小米 IoT 平台的设备，小米 IoT 设备协议规范使用设备实例 (Device Instance) 标识设备：

* 一个设备可包含多个“服务”、“属性”、“方法”和“事件”，但都唯一且确定，小米 IoT 设备协议规范使用 **实例 ID（Instance ID，iid，整型）** 作为唯一的标识；
* 为了方便开发者快速定义产品的功能，小米 IoT 开发者平台提供了“[产品复用](/v2/new/doc/configuration/create#%E5%A4%8D%E5%88%B6%E4%BA%A7%E5%93%81)”功能，开发者可复用已创建的产品并根据产品的实际情况调整，快速完成产品的功能定义；
* 为了帮助开发者定义出功能完整的产品，使用户在使用产品时能够获得良好的使用体验，小米 IoT 设备协议规范定义了“必选功能(required)”，开发者必须定义并实现字段标识为“required”的“必选功能”；
* 开发者在小米 IoT 开发者平台上创建产品后，产品中的“服务”、“属性”、“方法”和“事件”会根据当前的状态显示相应的内容：

  + 产品开发调试阶段：debug
  + 产品提交上线申请阶段：preview
  + 产品通过审核正式上线：released
* 为了保证开发者获取良好的产品使用体验，产品上线后，开发者需保持向后兼容性的升级，即只可新增功能定义，并可按需单独迭代产品固件、扩展程序、使用帮助和隐私条款；

> **说明：**
>
> * 保持向后兼容性的升级指开发者可新增服务、属性（可增加属性单位）、事件（可新增事件参数）或方法，修改描述；
> * 产品升级迭代时，urn 中的版本号将会按序递增。

### 描述字段

SpecificationType，**规范定义类型**，即 type，主要用于描述不同的定义，该字段使用 URN 格式（遵循 URN 语法规范 RFC2141，最后一个字段可选）。

json

```
  urn:miot-spec-v2:service:device-information:00007801  
  <URN> ::= "urn:"<namespace>":"<type>":"<name>":"<value>  [":"<vendor-product>":"<version>]  

```

* urn：第一个字段必须为 urn，否则视为非法 urn
* namespace：miot-spec-v2 为小米定义的规范为，bluetooth-spec 为蓝牙联盟定义的规范
* type：只能是 template、property、action、event、service、device
* name：有意义的单词或单词组合（小写字母），多个单词用"-"间隔，如 temperature、current-temperature、device-name、battery-level
* value：16 进制字符串，使用 UUID 前 8 个字符，如 00002A06、00002A00
* vendor-product：厂商+产品代号，有意义的单词或单词组合（小写字母），用"-"间隔，如 philips-moonlight、yeelink-c300、zhimi-vv、benz-c63
* version：产品功能的版本号，只能是数字且按序递增

> **说明：** 小米 IoT 开发者平台将会根据开发者的配置信息，自动生成 **vendor-product** 和 **version** 两个字段，该字段只在设备实例定义里出现。

### 设备定义规范

设备是一个独立的有意义的设备，如灯泡、插座及风扇等；为了准确描述一个设备，小米 IoT 设备协议规范使用如下字段描述设备的信息：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec-v2:device:fan:0000A005`
* **description**：描述，纯文本字段，对此 Device 做一个简单的描述，如 `Lightbulb`
* **required-services（必选服务）**
* **optional-services（可选服务）**

json

```
设备示例  
  
    {  
        // 标识风扇设备  
        "type": "urn:miot-spec-v2:device:fan:0000A005",  
        "description": "Fan",  
        // 风扇设备必须有的服务  
        "required-services": [  
            "urn:miot-spec-v2:service:device-information:00007801",  
            "urn:miot-spec-v2:service:fan:00007808"  
        ],  
        // 风扇设备可选择的服务  
        "optional-services": [  
            "urn:miot-spec-v2:service:physical-controls-locked:00007807",  
            "urn:miot-spec-v2:service:battery:00007805"  
        ]  
    }  

```

### 服务定义规范

小米 IoT 设备协议规范使用“服务”描述设备独立的有意义的功能组，功能组包含可操作的方法、可发生的事件和必备的属性；为了准确描述设备的服务，小米 IoT 设备协议规范使用如下字段描述设备的服务：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec-v2:service:fan:00007808`
* **description**：纯文本字段，描述 Service，如 `Fan Service`
* **required-actions（必选方法列表）**

  json

  ```
   "required-actions": [  
   	"urn:miot-spec-v2:action:get-stream-configuration:00000001",  
   	"urn:miot-spec-v2:action:start-stream:00000101",  
   	"urn:miot-spec-v2:action:stop-stream:00000201"  
   ]  

  ```
* **optional-actions（可选方法列表）**

  json

  ```
  "optional-actions": [  
   "urn:miot-spec-v2:action:identify:00002801"  
  ]  

  ```
* **required-events（必选事件列表）**

  json

  ```
  "required-events": [  
      "urn:miot-spec-v2:event:alert1:00000007"  
  ]  

  ```
* **optional-events（可选事件列表）**

  json

  ```
  "optional-events": [  
      "urn:miot-spec-v2:event:alert2:00000008"  
  ]  

  ```
* **required-properties（必选属性列表）**

  json

  ```
  "required-properties": [  
  "urn:miot-spec-v2:property:on:00000006",  
  "urn:miot-spec-v2:property:fan-level:00000016"  
  ]  

  ```
* **optional-properties（可选属性列表）**

  json

  ```
      "optional-properties": [  
          "urn:miot-spec-v2:property:horizontal-swing:00000017",  
          "urn:miot-spec-v2:property:vertical-swing:00000018",  
          "urn:miot-spec-v2:property:horizontal-angle:00000019",  
          "urn:miot-spec-v2:property:vertical-angle:0000001A",  
          "urn:miot-spec-v2:property:mode:00000008",  
          "urn:miot-spec-v2:property:status:00000007",  
          "urn:miot-spec-v2:property:fault:00000009"  
      ]  

  ```

json

```
服务示例  
  
{  
    "type": "urn:miot-spec-v2:service:fan:00007808",  
    "description": "Fan",  
    "required-properties": [  
        "urn:miot-spec-v2:property:on:00000006",  
        "urn:miot-spec-v2:property:fan-level:00000016"  
    ],  
    "optional-properties": [  
        "urn:miot-spec-v2:property:horizontal-swing:00000017",  
        "urn:miot-spec-v2:property:vertical-swing:00000018",  
        "urn:miot-spec-v2:property:horizontal-angle:00000019",  
        "urn:miot-spec-v2:property:vertical-angle:0000001A",  
        "urn:miot-spec-v2:property:mode:00000008",  
        "urn:miot-spec-v2:property:status:00000007",  
        "urn:miot-spec-v2:property:fault:00000009"  
    ]  
}  

```

### 方法定义规范

设备执行操作时可能会读写多个属性并有相应的输入输出值，小米 IoT 设备协议规范使用“方法”读写多个属性。为了准确描述设备的方法，小米 IoT 设备协议规范使用如下字段描述设备的“方法”：

* **type**：类型，必须 URN 表达式，`urn:miot-spec-v2:action:play:0000280B`
* **description（描述）**：纯文本字段，对此 Action 做简单的描述，如 `Get Streaming Configuration Of Camera`
* **in（输入参数列表）**：可以是 0 到 N 个，每个参数都由属性组成
* **out（输出参数列表）**：可以是 0 到 N 个，每个参数都由属性组成

json

```
方法示例  
  
{  
    // 开启摄像头视频流（需要设置SRTP相关的N个属性，返回SRTP相关的N个属性）  
    "type": "urn:miot-spec-v2:action:start-stream:00000101",  
    "description": "Start Camera Streaming",  
    "in": [  
        "urn:miot-spec-v2:property:session-id:00000102",  
        "urn:miot-spec-v2:property:conroller-ip-version:00000103",  
        "urn:miot-spec-v2:property:conroller-ip-address:00000104",  
        "urn:miot-spec-v2:property:conroller-video-rtp-port:00000105",  
        "urn:miot-spec-v2:property:conroller-audio-rtp-port:00000106",  
        "urn:miot-spec-v2:property:selected-video-parameters:00000107",  
        "urn:miot-spec-v2:property:selected-audio-parameters:00000108"  
    ],  
    "out": [  
        "urn:miot-spec-v2:property:device-status:00000109",  
        "urn:miot-spec-v2:property:device-ip-version:00000110",  
        "urn:miot-spec-v2:property:device-ip-address:00000111",  
        "urn:miot-spec-v2:property:synchronization-source-for-video:00000112",  
        "urn:miot-spec-v2:property:synchronization-source-for-audio:00000113",  
        "urn:miot-spec-v2:property:session-control:00000119"  
    ]  
}  

```

> **说明：** 方法中的输入数据和输出数据只可引用当前服务中的属性。

### 事件定义规范

为了及时告知用户设备的状态，小米 IoT 设备协议规范使用“事件”上报设备多个属性的变化状态，告知用户设备当前的状态；为了准确描述设备的“事件”，小米 IoT 设备协议规范使用如下字段描述设备的“事件”：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec:spec:event:alert:00000007`
* **description**：纯文本字段，对事件做简单的描述，如 `Get Streaming Configuration Of Camera`
* **arguments（参数列表）**：事件包含的属性参数，整型数组，数组内的数字代表当前服务(Service)内的属性 ID(piid)。如 [2, 4] 代表上报事件时同时会包含 piid = 2 和 piid = 4 的属性

JSON

```
// 事件示例  
{  
    "type": "urn:miot-spec-v2:event:alert:00000007",  
    "description": "Alert Alert Alert",  
    "arguments": [2, 4]  
}  

```

### 属性定义规范

产品的功能属性多用于表示产品的状态，产品的功能属性支持被查询、控制和订阅；为了准确描述设备的属性，小米 IoT 设备协议规范使用如下字段描述设备的“属性”：

* **type**：类型，必须是 URN 表达式，如 `urn:miot-spec-v2:property:color-temperature:0000000F`
* **description**：纯文本字段，对属性做简单的描述，如 Name、Temperature、Battery Level 等
* **format**：属性的数据格式

| 数据格式     | 描述                                                | 备注             |
| ------------ | --------------------------------------------------- | ---------------- |
| bool         | 布尔值: true/false                                  |                  |
| uint8        | 无符号 8 位整型                                     | 建议约束取值范围 |
| uint16       | 无符号 16 位整型                                    |                  |
| uint32       | 无符号 32 位整型                                    |                  |
| int8         | 有符号 8 位整型                                     |                  |
| int16        | 有符号 16 位整型                                    |                  |
| int32        | 有符号 32 位整型                                    |                  |
| int64        | 有符号 64 位整型                                    |                  |
| float        | 浮点数                                              |                  |
| string       | 字符串                                              | 建议约束最大长度 |
| hex          | 16 进制，（使用字符串表示，如"FF0011", “EE00”等） | 建议约束取值范围 |
| 数据格式描述 |                                                     |                  |

* **access**：访问方式，包含 read（读）、write（写）和 notify（通知）
* **value-range**：约束取值范围，仅当 format 为整型、浮点数或 hex 时，可定义 value-range，最大值为 32，最小值为为 16，步长为 0.5
* **value-list**：约束取值范围，当 format 为整型，可定义"value-list"，每个元素都包含 value 和 description
* **unit**：单位，当 format 为整型或浮点型，可定义 unit 的值

| 值         | 描述           | 值      | 描述                 |
| ---------- | -------------- | ------- | -------------------- |
| percentage | 百分比         | celsius | 摄氏度               |
| seconds    | 秒             | minutes | 分                   |
| hours      | 小时           | days    | 天                   |
| kelvin     | 开氏温标       | pascal  | 帕斯卡(大气压强单位) |
| arcdegrees | 弧度(角度单位) | rgb     | RGB(颜色)            |
| watt       | 瓦特(功率)     | litre   | 升                   |
| ppm        | ppm 浓度       | lux     | 勒克斯(照度)         |
| mg/m3      | 毫克每立方米   | -       | -                    |
| 值描述     |                |         |                      |

* **max-length**：字符串最大长度，仅当 format 为字符串时可选。

json

```
属性示例  
  
{  
    "type": "urn:miot-spec-v2:property:current-temperature:00000002",  
    "description": "Current temperature",  
    "format": "float",  
    "access": ["read", "write", "notify"],  
    "value-range": [16, 32, 0.5],  
    "unit": "celsius"  
}  
  
// 使用value-list  
{  
    "type": "urn:miot-spec-v2:property:day-of-the-week:00000003",  
    "description": "Day Of The Week",  
    "format": "uint8",  
    "access": ["read", "write", "notify"],  
    "value-list": [  
       {"value": 1, "description": "Monday"},  
       {"value": 2, "description": "Tuesday"},  
       {"value": 3, "description": "Wednesday"},  
       {"value": 4, "description": "Thursday"},  
       {"value": 5, "description": "Friday"},  
       {"value": 6, "description": "Saturday"},  
       {"value": 7, "description": "Sunday"}  
    ]  
}  

```

## 读取标准定义

小米 IoT 设备协议规范定义了标准的设备、属性、方法、事件和服务，为了帮助开发者快速定义产品的功能，开发者可从下方链接中获取和使用标准 HTTP/GET 请求读取并参考规范定义的标准内容，定义待接入产品的功能定义。

### 读取 Type 列表

* 读取所有的 DeviceType：[http://miot-spec.org/miot-spec-v2/spec/devices](http://miot-spec.org/miot-spec-v2/spec/devices)
* 读取所有的 ServiceType：[http://miot-spec.org/miot-spec-v2/spec/services](http://miot-spec.org/miot-spec-v2/spec/services)
* 读取所有的 PropertyType：[http://miot-spec.org/miot-spec-v2/spec/properties](http://miot-spec.org/miot-spec-v2/spec/properties)
* 读取所有的 ActionType：[http://miot-spec.org/miot-spec-v2/spec/actions](http://miot-spec.org/miot-spec-v2/spec/actions)
* 读取所有的 EventType：[http://miot-spec.org/miot-spec-v2/spec/events](http://miot-spec.org/miot-spec-v2/spec/events)

### 读取具体 Type 定义

* 读取一个 DeviceType 的具体定义（如灯）：[http://miot-spec.org/miot-spec-v2/spec/device?type=urn:miot-spec-v2:device:light:0000A001](http://miot-spec.org/miot-spec-v2/spec/device?type=urn:miot-spec-v2:device:light:0000A001)
* 读取一个 ServiceType 的具体定义（如风扇）：[http://miot-spec.org/miot-spec-v2/spec/service?type=urn:miot-spec-v2:service:fan:00007808](http://miot-spec.org/miot-spec-v2/spec/service?type=urn:miot-spec-v2:service:fan:00007808)
* 读取一个 PropertyType 的具体定义（如开关）：[http://miot-spec.org/miot-spec-v2/spec/property?type=urn:miot-spec-v2:property:on:00000006](http://miot-spec.org/miot-spec-v2/spec/property?type=urn:miot-spec-v2:property:on:00000006)
* 读取一个 ActionType 的具体定义（如运行）：[http://miot-spec.org/miot-spec-v2/spec/action?type=urn:miot-spec-v2:action:play:0000280B](http://miot-spec.org/miot-spec-v2/spec/action?type=urn:miot-spec-v2:action:play:0000280B)

### 读取实例定义

设备实例是开发者遵循小米 IoT 设备协议规范所定义和创建的设备实例，开发者可从 [www.miot-spec.org](http://www.miot-spec.org) 上使用标准 HTTP/GET 读取实例定义，为了方便开发者快速读取待接入产品的功能定义，开发者可在功能定义界面使用“查看 Json”功能。

* 读取所有设备实例列表：[http://miot-spec.org/miot-spec-v2/instances](http://miot-spec.org/miot-spec-v2/instances)
* 读取某个实例的详细定义：[http://miot-spec.org/miot-spec-v2/instance?type=urn:miot-spec-v2:device:outlet:0000A002:xxxxx](http://miot-spec.org/miot-spec-v2/instance?type=urn:miot-spec-v2:device:outlet:0000A002:xxxxx)
  （xxxx 为 vendor-product）

#### 其他产品设计规范

# 设计产品 UED

更新时间：2023/09/21

为了使用户在使用产品时能够获得一致的体验效果，小米 IoT 平台根据产品的特征和用户的使用体验，统一了设备和用户的交互方式，小米 IoT 平台强烈建议开发者在设计产品时，参考本文档的内容，合理地设计产品的 UED。

> **说明：**
>
> 已出海的产品为了符合海外用户的使用需求和出海地区的政策要求，避免出现违规等事项，请参考[设备 UED 适配](/v2/new/doc/configuration/globalization#%E7%AC%AC%204%20%E6%AD%A5%20-%20%E8%AE%BE%E5%A4%87%20UED%20%E9%80%82%E9%85%8D) 中的要求调整产品 UED。

## 设备待连接状态

* 该规范为**强制规范**，开发者必须按照该内容设计产品的待连接状态。

为保证用户初次使用设备、重置设备 Wi-Fi 后能快速配网绑定，同时为避免连接中的设备被误连，开发者需根据如下内容，设置设备的待连接状态和连接状态持续的窗口时间。

| 触发方式               | 详细描述                                                                                                                |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| 设备上电               | - 长供电设备：设备未配网时，设备每次上电后（如拔插电），需进入待连接状态 - 电池设备：初次出厂上电时，设备进入待连接状态 |
| 重置设备               | 有配网重置按键的设备，重置后需要进入待连接状态                                                                          |
| 设备待连接状态触发方式 |                                                                                                                         |

> **说明：**
>
> * 对于不绑定也可以正常使用的设备，用户操作设备按键开关机且没有重新拔插电时，设备无需再次进入待连接窗口期；
> * 对于有强绑定需求的部分 BLE 设备，允许在设备退出窗口期后，通过用户操作任意键重新触发待连接窗口期，以提高绑定率。

| 设备类型                   | 待连接形式             | 待连接状态窗口时间       |
| -------------------------- | ---------------------- | ------------------------ |
| Wi-Fi设备                  | 发射AP热点             | 30mins                   |
| Wi-Fi+BLE 设备             | 发射 AP 热点 &BLE 广播 | 30mins                   |
| BLE 设备                   | BLE 广播               | 30mins                   |
| BLE Mesh 设备              | BLE 广播               | 30mins                   |
| 2G/3G/4G/5G 设备可绑定状态 | 用户主动触发绑定       | 无限制（无配网重置按键） |
| 设备待连接状态窗口时间表   |                        |                          |

> **说明：** 对于支持扫码绑定的设备，其二维码的建议边长为 18mm-22mm。

## 指示灯/屏幕状态

### 指示灯状态

为了在配网和添加时给予用户及时准确的反馈，开发者需按照如下规范，设计设备的指示灯。

> **说明：** 带有屏幕的产品，屏幕上需要同时兼备显示连接状态、工作状态和电量指示的能力。

| 指示灯类型                           | 设备状态                                                         | 指示灯颜色    | 备注                                                                                                                                                                                                                                                                                                                                                                 |
| ------------------------------------ | ---------------------------------------------------------------- | ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 网络状态/连接状态                    | 设备待连接                                                       | 橙色闪烁      | 1. 闪烁时间为：亮 0.1s，灭 0.4s； 2. 因硬件限制无法显示橙色灯时，建议使用红色代替橙色显示； 3. 无指示灯的设备可以通过其他方式做配网提示，如：    * 儿童手表等带屏设备通过声音代替灯光进行指示；    * 灯泡，吸顶灯，筒灯等灯类设备，当设备配网后会闪烁一次提示用户配网成功                                                                                            |
| 联网态（正在联网）                   | 蓝色闪烁                                                         |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 在线                                 | 蓝色常亮                                                         |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 故障态（设备连接失败/联网失败/断网） | 橙色常亮                                                         |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 断网重连态                           | 蓝色闪烁                                                         |               |                                                                                                                                                                                                                                                                                                                                                                      |
| OTA 升级态                           | 蓝色闪烁                                                         |               |                                                                                                                                                                                                                                                                                                                                                                      |
| Wi-Fi 连接灯配网功能关闭态           | 灯灭（为避免光污染，WiFi 及蓝牙指示灯可在连续点亮 3mins 后熄灭） |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 设备工作状态                         | 设备正常工作中                                                   | 白色常亮      | 1. 闪烁：提醒、报警闪烁时间为：亮 0.1s，灭 0.4s 2. 灯灭：低功耗产品工作中可以灯不亮或无工作灯以节省功耗 3. 部分品类，可用灯环、异形指示灯展示工作状态                                                                                                                                                                                                                |
| 工作异常/高危报警                    | 红色闪烁/常亮                                                    |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 环境状态优良                         | 绿色（空气检测类设备）/蓝色（水质检测类设备）                    |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 环境状态为中度污染/呼唤行为          | 橙/黄色                                                          |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 环境状态为重度污染/设备异常故障      | 红色                                                             |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 设备设置中                           | 白色                                                             |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 电量指示灯                           | 低电量                                                           | 橙色/红色常亮 | 1. 无法做呼吸效果的设备在表示“充电中”状态时，可用闪烁代替 2. 呼吸：充电中，或其他“蓄能”状态，如：电熨斗的加热；呼吸效果建议为 4s 内完成“灭-亮-灭”的循环 3. 不建议使用红色灯表示电量档位，除非强电量需求设备，如：充气宝、剃须刀设备等 4. 对于特殊产品，无工作反馈/异常提醒指示灯时，可通过声音代替 5. 低功耗产品电量灯可以不常亮，只在低电和充满电时给用户提示 |
| 充电中                               | 白色灯呼吸（强电量关联设备以当前电量阈值指示灯色进行呼吸)        |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 充满电                               | 灯灭（满电充电时，呼吸 20S 后熄灭）                              |               |                                                                                                                                                                                                                                                                                                                                                                      |
| 指示灯交互规范                       |                                                                  |               |                                                                                                                                                                                                                                                                                                                                                                      |

### 屏幕

开发者可使用蓝牙图标或 Wi-Fi 图标表示设备的连接状态。

| 设备状态     | 蓝牙状态                              | 蓝牙图标 | Wi-Fi 状态                                                             | Wi-Fi 图标 |
| ------------ | ------------------------------------- | -------- | ---------------------------------------------------------------------- | ---------- |
| 待连接窗口期 | 闪烁亮 0.4s，灭 0.2s                  |          | 闪烁 亮0.4s，灭0.2s                                                    |            |
| 正在配网     | 闪烁 亮0.4s，灭0.2s                   |          | 闪烁：第一层0.12s、第二层0.12s、第三层0.4s、灭0.2s                     |            |
| 在线         | 熄灭                                  |          | 常亮                                                                   |            |
| OTA升级态    | 闪烁（直到升级完成） 亮 0.4s，灭 0.2s |          | 闪烁（直到升级完成）、第一层 0.12s、第二层 0.12s、第三层 0.4s、灭 0.2s |            |
| GATT 直连态  | 常亮                                  |          | /                                                                      | /          |
| 指示屏规范   |                                       |          |                                                                        |            |

### 设备免打扰

* 该规范为**强制规范**，开发者必须按照该内容设计产品的待连接状态。

对于放置在卧室、书房或老人房等位置，且可能造成光污染的设备，必须要提供防止指示灯打扰的能力。

* 在硬件上提供关闭或者调整灯光和屏幕的开关，关闭后，除高危报警外，其余情况下指示灯关闭。
* 在扩展程序内提供关闭或者调整灯光和屏幕的开关，仅保留高危报警。
* 在扩展程序内提供夜间勿扰模式开关，允许用户在自定义时间段内关闭或调整指示灯和屏幕（如有声音应同时关闭），仅保留高危报警。

> **说明：**
>
> * 若开发者在硬件上提供相关开关功能，扩展程序也必须同步提供相应的功能；
> * 对于支持自动 OTA 固件更新的设备，必须要符合自动 OTA 更新的规范，否则产品可能无法通过验收测试。

## 音效交互规范

### 音效反馈

设备的声音主要分为正向反馈和负面反馈。

| 正向反馈                                                                                        | 反向反馈                                                                                                                                                                    |
| ----------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 有效操作- 定义：通过按键⾳效反馈提⽰⽤⼾当下操作有效 - 适⽤场景：启动成功、设置成功和安装成功等 | ⽆效操作- 定义：通过⾳效的反馈提⽰⽤⼾当下的操作⽆效或失败 - 适⽤场景：旋钮菜单到底、洗⾐过程中不可添⾐或冰箱温度设置达到极值等                                             |
| 操作成功- 定义：通过⾳效的反馈提⽰⽤⼾当下的操作成功 - 适⽤场景：预约成功、重置滤芯/WI-FI成功   | 报错警告- 定义：通过⾳效提醒⽤⼾当前出现异常状态，正常运⾏已受到影响，需要⽴刻处理 - 适⽤场景： 洗⾐机⻔未关闭、破壁机未盖盖⼦、压⼒锅未上锁、机械故障（屏幕显⽰维修电话） |
| 任务启动- 定义：通过⾳效提醒⽤⼾机器开始执⾏任务 - 适⽤场景：当前烹饪、洗涤或是料理任务开始     | -                                                                                                                                                                           |
| 任务完成- 通过⾳效提醒⽤⼾任务已完成 - 适⽤场景：当前烹饪、洗涤或是料理任务完成                 | -                                                                                                                                                                           |
| 音效反馈                                                                                        |                                                                                                                                                                             |

> **说明：** 由于和炫音受版权影响较大，因此，请开发者自行选用合适的音效。

### 蜂鸣器

设备配网成功或重置配网按键成功后，开发者可参考如下规范，设置设备的蜂鸣器。

| 蜂鸣器声音      | 时长                      | 使用场景                   |
| --------------- | ------------------------- | -------------------------- |
| “滴-”（短音） | 100ms                     | 开机，正向操作，有效操作等 |
| “滴~”（长音） | 500ms                     | 关机，任务完成，重新上电等 |
| “滴-滴-”      | 声音单次 100ms/间隔 200ms | 无效操作，无法执行等       |
| “滴-滴-滴-”   | 声音单次 100ms/间隔 200ms | 建议：报错                 |
| 蜂鸣器          |                           |                            |

### 设备免打扰

* 该规范为**强制规范**，开发者必须按照该内容设计产品的待连接状态。

对于放置在卧室、书房或老人房等位置，且可能造成噪声污染的设备，必须要提供防止蜂鸣器打扰的能力。

* 在硬件上提供关闭声音的开关，关闭后，除高危报警外，其余情况下蜂鸣器声音关闭。
* 在扩展程序内提供夜间勿扰模式开关，允许用户在自定义时间段内关闭蜂鸣器（如有灯光应同时关闭），仅保留高危报警。

> **说明：**
>
> * 若开发者在硬件上提供相关开关功能，扩展程序也必须同步提供相应的功能。
> * 对于支持自动 OTA 固件更新的设备，必须要符合自动 OTA 更新的规范，否则产品可能无法通过验收测试。

## 按键

### 开关机按键

建议设备提供独立的开关机按键，交互上通过短按，操作设备开关机，但以下情况，设备可通过长按 3s 开关机：

1. 短按误触可能会有安全风险等，如滑板车关机；
2. 无独立开关机按键、或因按键数量不足导致短按操作被更重要的功能占用，如扫地机短按是开始清扫，长按为开关机。

### 配对按键确认

针对门锁等配对时需要手动确认的 BLE 设备，可通过短按按键确认的方式进行配对。

### 配网按键

建议开发者为设备配置单独的配网按键。

**1. 按键确认**

针对门锁等配对时需要手动确认的 BLE 设备，可通过短按按键确认的方式进行配对。

**2. 配网按键重置**

* 针对 Wi-Fi/Zigbee/BLE 等方式接入的产品，按照重置连接的形式制定统一的按键交互规范。
* 单键重置、双键重置、单独重置键 /Reset 孔重置和开关重置统一规范为长按 7s；如灯类等产品可在 7s 内，快速使用物理开关使灯亮灭 5 次实现设备重置。

> **注意：**
>
> 1. 按键分为功能按键和重置按键，建议设定专门的单独重置按键，若硬件限制，可将功能按键与重置按键合二为一；
> 2. 根据电路板不同，实际长按的时间可以有 ±500ms 误差，以实际效果为准；
> 3. 如下列举不同品类设备配网按键重置的方式（持续扩展中）；

| 品类                       | 重置方式                                                                                                                                                                                                                                         |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 开关类                     | 长按按键，待橙灯（待连接状态）闪烁 2 次后松手，接着再次长按，待橙灯一直闪烁即重置成功。  说明： 长按时间：5 秒 两次长按中间间隔：0～4 秒 多键开关长按任意按键。即：长按任意按键，待橙灯闪烁 2 次后松手，接着再次长按，待橙灯一直闪烁即重置成功。 |
| 灯泡，灯泡，吸顶灯，筒灯等 | **7秒内**快速使用物理开关使灯亮灭 5 次后灯闪烁一次，表示重置成功。                                                                                                                                                                         |
| 重置方式                   |                                                                                                                                                                                                                                                  |

### 恢复出厂设置按键

建议开发者为设备配置单独的恢复出厂设置按键。

1. 恢复出厂设置按键，若按键与重置按键相同，则使用长按 7s 的规范；若恢复出厂设置为单独使用，开发者可行自定义，但不建议使用 7s 以外的长按方式实现；
2. 如无特殊情况，恢复出厂设置按键为必须。

## 状态记忆

为使用 Wi-Fi 的设备配网后，模组会记忆 Wi-Fi 路由的信息，在路由器正常的情况下，设备断电断网后重连后 5mins 内需要自动连接网络，设备断网重连、断电重连和 OTA 升级后，需重新回到最近一次的工作状态，包括之前的工作模式、功率、用户设置等。

> **说明：** 配有额外物理开关的灯类设备有单独的判断逻辑，一般以物理通断电为准。

### 灯类产品

* 墙壁开关打开，灯通电则开灯；墙壁开关关闭，灯断电则关灯；
* 墙壁开关为开时，家中断电后再上电，应默认开启并恢复断电前的灯光；断网重连、OTA 升级后，应保持之前开关状态与灯光效果；
* 为避免用户始终开启墙壁开关，仅使用 App/语音/自动化控制灯，如果家中意外断电后，灯会突然亮起的问题，可在扩展程序中增加“默认状态”设置。

![](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_png_61e63a8c4b60122eccbd954dc43c7b88.png)

扩展程序（灯）

### 开关类产品

单火墙壁开关 OTA 时需要自动开灯并提醒用户（因为 OTA 时功耗较高，为防止鬼火所以将点亮灯）用户点击“固件升级”后，扩展程序需提示“自动开灯”，用户在点击“确定”后，设备可开始升级。

![](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_png_3d7090ec7324e546f8c360bc252a313a.png)

扩展程序（单火墙壁开关）

> **说明：** 开关和插座类设备默认支持断电记忆功能（断电之前为开，则断电后再上电默认为开；断电之前为关，则断电后再上电默认为关）。

#### 隐私协议

# 隐私规则

更新时间：2023/09/21

**尊敬的各位开发者：**

十三届全国人大常委会第三十次会议 20 日表决通过《中华人民共和国个人信息保护法》（以下简称“《个保法》”），自 2021 年 11 月 1 日起施行。这是中国第一部专门规范个人信息保护的法律，对我国公民的个人信息权益保护以及各组织的数据隐私合规实践都将产生直接和深远的影响。《个保法》共计八章七十四条，构建了完整的个人信息保护框架。其规定涵盖了个人信息的范围以及个人信息从收集、存储到使用、加工、传输、提供、公开、删除等所有处理过程；明确赋予了个人对其信息控制的相关权利，并确认与个人权利相对应的个人信息处理者的义务及法律责任；对个人信息出境问题、个人信息保护的部门职责、相关法律责任进行了规定。

为了落实《个保法》要求的互联网平台服务的“守门人”义务，规范小米 IoT 开发者平台（以下简称“平台”）的开发者的个人信息处理活动，促进开发者合理利用个人信息，平台从以下三个维度制定了隐私管理规则：

### 一、验收

1. 开发者应保证其完成接入的开发者硬件或应用平台接入部分已经达到《个保法》所要求的数据保护水平，并通过提交承诺函的方式，向小米承诺开发者旗下的各产品已通过第三方律所的合规认证。
2. 开发者完成接入的开发者硬件或应用平台接入部分应通过平台的隐私合规性检测验收。

### 二、技术

为切实加强用户个人信息保护，小米会紧跟隐私保护法律以及监管合规的动向，不断探索新的隐私保护技术，并为我们的开发者提供符合法律以及监管要求的最新技术解决方案。请开发者们配合平台及时接入最新的隐私合规技术方案，同小米一起共筑隐私合规的长城。

### 三、问责

平台会严格践行上述验收规则，对未按时递交承诺函或未达到隐私合规性测试标准的开发者进行处理，限制其进行新品接入。对于情形严重的开发者，可能会做停服处理。除此之外，平台会公开发布本规则的年度运行情况，例如停止服务的数量和原因等，以履行平台保护个人信息的社会责任。

## 03 开发产品

### 平台配置

#### 基础配置

# 基础配置

更新时间：2024/09/25

为了方便用户在米家 App 查找、连接并管理产品，需开发者提前在平台完成产品基础信息的配置，如**产品名称**、**产品拟物图**和**靠近配网弹窗**等基础功能。

## 前提条件

1. 通过小米账号，[登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)。
2. [已成功创建企业组](/v2/new/doc/configuration/signin/create-enterprise)或已加入团队所在的企业组。
3. 确保待创建品类平台已开放支持，详情请参考[明确产品类型](/v2/new/doc/introduction/preparation/product_type)。
4. 已成功[创建产品](/v2/new/doc/configuration/create#%E5%88%9B%E5%BB%BA%E4%BA%A7%E5%93%81)。

## 操作步骤

1. 进入「控制台 - 产品」，点击产品所在行，在左侧主流程中点击"基础配置"。在基础功能配置页面底部点击【编辑】。
2. 依次按配置要求填写信息。详情请参考表**基础配置**。

   并不是每个产品中都会出现全部选项，请根据产品类型按需配置。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/520ab2c7b27ab3ce06ec118150e1f9d0_1727168445876.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=YHsul6fg2Eoi8mf10///DDP57XY=)

基础配置

| 产品信息             | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 产品名称             | 指显示在米家 App 上的简体中文产品名称。产品创建成功后可在[文案多语言配置](/v2/new/doc/configuration/advance-configure/multi-language)中修改产品名称。 **说明：** 产品名称需与产品销售渠道、产品说明书上的产品名称一致。 为了避免出现产品名称重复的情况，请按 "品牌+品类+产品亮点" 的形式命名。 未经允许，禁止在产品名称中包含小米旗下品牌关键字，例如小米、MI、xiaomi、米家、mijia、MIUI、Redmi、红米、小爱、米兔、MJ 和铁蛋等，更多要求请参考[产品宣传物料制作规范](/v2/new/doc/resources-and-services/design/material)。 |
| 品牌名称             | 在下拉框中选择该企业组下的品牌。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 展示分类             | 目前平台支持的产品类型请参考[平台已开放品类](/v2/new/doc/introduction/preparation/product_type#%E5%BC%80%E6%94%BE%E6%8E%A5%E5%85%A5%E4%BA%A7%E5%93%81%E7%B1%BB%E5%9E%8B)。                                                                                                                                                                                                                                                                                                                                                    |
| 产品配网方式         | 指在米家 App 添加设备时帮助设备配网以接入小米 IoT 平台的方式。 不同的联网方式对应不同的配网方式，详情请参考表**不同联网方式和配网方式对应关系**。                                                                                                                                                                                                                                                                                                                                                                    |
| Spec 蓝牙直连        | -**支持**：设备在未连接蓝牙 / 蓝牙 Mesh 网关时，能够进入扩展程序借助手机蓝牙连接设备。 - **不支持**：设备在未连接蓝牙 / 蓝牙 Mesh 网关时，不能进入扩展程序借助手机蓝牙连接设备。                                                                                                                                                                                                                                                                                                                               |
| 更多网络类型         | - 支持网线配网引导的米家 App 最低版本为：安卓 6.15，iOS 6.15。 - 支持 SIM 卡安装引导的米家 App 最低版本为：安卓 8.5，iOS 8.5。 - 支持中继器的米家 App 最低版本为：安卓 8.8，iOS 8.8。                                                                                                                                                                                                                                                                                                                                      |
| 产品离线提示         | - 有**提示弹窗，扩展程序可操作**：产品离线后，用户在米家 App 进入扩展程序，有产品离线的提示弹窗，但用户可操作扩展程序的界面，如查看产品最近一次上报的数据、进入设置页等，但不能控制设备。 - **有提示弹窗，扩展程序不可操作**：产品离线后，用户在米家 App 进入扩展程序，有产品离线的提示弹窗，但用户无法操作扩展程序的界面。                                                                                                                                                                                    |
| 产品共享             | 用于用户共享产品使用权限，用户在米家 App 上添加设备共享人后，被添加的用户会拥有使用产品的权限，建议开发者根据产品的安全级别设置产品共享功能。 -**支持（用户不可选共享权限）**：该产品支持被用户共享，当用户共享该产品后，被共享用户可查看并操作产品。 - **支持（用户可选共享权限）**：该产品支持被用户共享，且用户共享该产品时，可设置被共享用户的操作权限（查询或操作）。 - **不支持**：该产品不支持被用户共享，用户无法共享该产品。                                                                    |
| 强弱绑定             | -**弱绑定**：产品可被任意用户绑定。 - **强绑定**：仅在当前用户解绑后，产品才可被其他新用户重新绑定。                                                                                                                                                                                                                                                                                                                                                                                                           |
| 蓝牙配对方式         | -**App 确认即配对**：不需要设备确认。 - **设备确认即配对**：需要设备确认。 - **RSSI 符合即配对**：不需要设备确认，但要求设备靠近才能配对（选择此方式需要填写 RSSI 阈值，信号高于该阈值则可配对成功）。                                                                                                                                                                                                                                                                                                   |
| 扩展程序退出保持连接 | 用于设置是否支持"在米家 App 中退出扩展程序时，米家 App 与设备保持连接"。                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 产品拟物图           | 用于产品在米家 App 设备列表展示的图标。 168\*168 像素，PNG 格式，透明底，100KB 以内，详情请参考[米家 App 素材设计规范](/v2/new/doc/resources-and-services/design/elements)。                                                                                                                                                                                                                                                                                                                                                  |
| 靠近配网弹窗         | 用于 Xiaomi HyperOS 或米家 App 识别到附近设备时自动弹出添加提示。 480\*480 像素，PNG 格式，透明底，100KB 以内，详情请参考[米家 App 素材设计规范](/v2/new/doc/resources-and-services/design/elements)。                                                                                                                                                                                                                                                                                                                        |
| 备注                 | 选填。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

基础配置

| **联网方式**               | **配置项**                                                                                                                                                                  | **配置选项**                                                                                                                                                                                                                       | **备注**                                                                                                                        |
| -------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| Wi-Fi                            | 配网方式                                                                                                                                                                          | 单 Wi-Fi 模组设备配网（AP 配网）                                                                                                                                                                                                         | 用户通过 Wi-Fi 连接硬件产品并传输配网信息，硬件产品再通过 Wi-Fi 连接至互联网。                                                        |
| 设备扫码配网（摄像头）           | 仅支持带摄像头的产品。                                                                                                                                                            |                                                                                                                                                                                                                                          |                                                                                                                                       |
| 设备无需 App 协助配网            | - 通过蜂窝网（即移动网络，包含 2G/3G/4G/5G）联网，有控制屏幕且可自行操作配网的产品。 - 通过自有 App 配网的产品。                                                                  |                                                                                                                                                                                                                                          |                                                                                                                                       |
| 设备播报码配网（摄像头）         | 仅支持带麦克风的产品。                                                                                                                                                            |                                                                                                                                                                                                                                          |                                                                                                                                       |
| 非 bindkey 绑定（小米路由器）    | 暂未开放。                                                                                                                                                                        |                                                                                                                                                                                                                                          |                                                                                                                                       |
| Wi-Fi+BLE                        | 配网方式                                                                                                                                                                          | Combo 配网方式                                                                                                                                                                                                                           | 用户使用蓝牙连接硬件产品并传输配网信息，硬件产品再通过 Wi-Fi 连接至互联网。 使用 Wi-Fi+BLE 双模模组开发的硬件产品默认选择该配网方式。 |
| 单 Wi-Fi 模组设备配网（AP 配网） | 用户通过 Wi-Fi 连接硬件产品并传输配网信息，硬件产品再通过 Wi-Fi 连接至互联网。                                                                                                    |                                                                                                                                                                                                                                          |                                                                                                                                       |
| 设备扫码配网（摄像头）           | 仅支持带摄像头的产品。                                                                                                                                                            |                                                                                                                                                                                                                                          |                                                                                                                                       |
| 设备无需 App 协助配网            | - 通过蜂窝网（即移动网络，包含 2G/3G/4G/5G）联网，有控制屏幕且可自行操作配网的产品。 - 通过自有 App 配网的产品。                                                                  |                                                                                                                                                                                                                                          |                                                                                                                                       |
| 设备播报码配网（摄像头）         | 仅支持带麦克风的产品。                                                                                                                                                            |                                                                                                                                                                                                                                          |                                                                                                                                       |
| 非 bindkey 绑定（小米路由器）    | 暂未开放。                                                                                                                                                                        |                                                                                                                                                                                                                                          |                                                                                                                                       |
| BLE                              | 强弱绑定                                                                                                                                                                          | **低**：产品可被任意用户绑定。 **高**：仅在当前用户解绑后，产品才可被其他新用户重新绑定。                                                                                                                                    | 门锁或保险箱等高安全级别蓝牙接入的硬件产品，需选择"高"。 标准安全级别蓝牙接入的硬件产品，可选择"低"。                                 |
| 蓝牙配对方式                     | **App 确认即配对**：App 与产品配对时，无需产品确认。 **设备确认即配对**：App 与产品配对时，需要产品确认。 **RSSI 符合即配对**：App 与产品配对时，无需产品确认。 | 当选择"设备确认即配对"的配对方式时，支持开发者设置[&#34;配网引导&#34;](/v2/new/doc/configuration/advance-configure/network-distribution)。 选择" RSSI 符合即配对"的配对方式时，配对阈值需为负数，当配对信号高于指定的阈值时，即可配对成功。 |                                                                                                                                       |
| 扩展程序退出保持连接             | **支持**：用户在米家 App 中退出扩展程序时，**设备仍与米家 App 保持连接**。 **不支持**：用户在米家 App 中退出扩展程序时，**设备将与米家 App 断开连接**。   | -                                                                                                                                                                                                                                        |                                                                                                                                       |
| BLE-Mesh                         | 是否为低功耗设备                                                                                                                                                                  | **是**：低功耗设备。 **否**：非低功耗设备。                                                                                                                                                                                  | 仅单火线墙壁开关及电池供电类产品（推荐使用 MHCB09P-B(IB)）可选择"是"。 灯类有电源常供电的设备可选择"否"。                             |
| 蓝牙配对方式                     | **App 确认即配对**：App 与产品配对时，无需产品确认。 **设备确认即配对**：App 与产品配对时，需要产品确认。 **RSSI 符合即配对**：App 与产品配对时，无需产品确认。 | 为方便用户使用 BLE Mesh 设备，建议开发者选择" App 确认即配对"的配对方式。                                                                                                                                                                |                                                                                                                                       |
| 扩展程序退出保持连接             | **支持**：用户在米家 App 中退出扩展程序时，**设备仍与米家 App 保持连接**。 **不支持**：用户在米家 App 中退出扩展程序时，**设备将与米家 App 断开连接**。   | -                                                                                                                                                                                                                                        |                                                                                                                                       |

不同联网方式和配网方式对应关系

3. 点击保存，配置完成。

## 后续操作

更新基础配置和操作步骤一致。

* 产品状态为“测试中”和“已拒绝”时，该页面所有字段信息都可以修改。
* 产品状态为“已上线”、“上线审核中”和“审核通过未上线”时，该页面只能修改**备注**。可以在「控制台 - 产品 - 产品详情页 - 高阶配置 - 文案多语言配置」页面修改**产品名称**。

#### 功能定义

# 功能定义

更新时间：2024/11/19

本篇文章主要讲述了如何在平台操作配置"功能定义"模块，关于如何设计产品的功能定义，请参考[定义产品功能](/v2/new/doc/resources-and-services/design/feature-define/feature-define)。

> **注意：**
>
> 产品功能定义会直接影响后续的扩展程序和固件开发，请在开发之前务必参考[定义产品功能](/v2/new/doc/resources-and-services/design/feature-define/feature-define)完成产品功能定义的设计。

## 概念说明

为帮助开发者快速定义产品的功能，米家为 IoT 产品定义的两种数据协议格式，作为 "米家 App - 小米 IoT 云服务 - 设备" 之间的交流语言。设备开发和应用开发都需按照产品功能定义来实现相关功能。

1. **Spec 标准协议（推荐）**：

结构为「服务 - 属性/方法/事件」，适用于绝大多数品类。基于该协议开发产品，可从米家海量标准 Spec 功能库中选取服务。

* **服务**：代表了一类互相有联系的功能合集，如环境检测服务、电池管理服务，通过属性、方法、事件可以描述该服务中包含的具体功能。
  + **标准服务（推荐）：**是米家对一系列设备的功能进行提取、分组、定义、抽象而成的功能，开发者可直接取用，平台已为 190+ 品类预置了标准服务，品类之间可互相借鉴标准功能，例如给 "灯" 添加 "风扇" 功能便可让 "灯" 变成 "风扇灯"。
  + **自定义服务：**如果在标准 Spec 功能中没有找到所需功能，还可以按 Spec 标准协议格式自定义功能。
* **属性**：单一的功能操作可以定义为属性，属性支持被查询、控制、订阅，例如灯的开关。
* **方法**：主要用于向设备下发组合控制指令，方法可支持同时下发多个属性（以属性作为输入、输出参数），如电饭煲的开始煮饭。
* **事件**：主要用于设备向云端上报组合数据，事件可支持上报多个属性（以属性作为输出参数），如门锁被打开。

2. **Profile 透传协议（已下线，仅部分老品适用）**：结构为「属性/方法/事件」，完全由开发者自行定义功能。

## 前提条件

1.在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[注册企业](/v2/new/doc/configuration/signin/create-enterprise)；

2.[登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)；

3.在平台成功[创建产品](/v2/new/doc/configuration/create)；

4.明确产品[功能定义设计](/v2/new/doc/resources-and-services/design/feature-define/feature-define)。

## 操作步骤

### 第 1 步 - 选择产品方案/协议

平台支持"标准产品方案" 和"产品协议自定义开发"两种开发方案，目前标准产品方案仅针对部分品类进行开放，若产品品类支持标准方案，则创建产品后进入标准产品方案流程；否则进入自定义开发方案流程：

> **注意：**
>
> 在选择协议处，联网方式为 BLE-Mesh 的产品必须使用「功能定义模板」，其他联网方式无强制要求
>
> * 选择模板后会对当前已配置的功能进行覆盖；
> * 如选择模板后又不想使用模板了，可再点击【修改模板】切换到自定义模式。

| **方案类型**   | **说明**                                                                                                                                                          |
| -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 标准产品方案（推荐） | 平台为部分品类提供相对成熟的标准化成套产品方案，使用此类方案可以提升开发效率、缩短产品认证时间，请参考[标准模板介绍](/v2/new/doc/introduction/solution/standard/what/what) |
| 自定义开发方案       | 采用自定义开发方案，实现更灵活的配置。需注意，选择协议后不可修改                                                                                                        |

功能定义类型

### 第 2 步 - 编辑功能定义

#### 2.1 - 查看默认功能

选择协议或方案后，系统会推荐相应的标准功能，区分必选和可选服务，必选不可删除，请先确认是否符合当前产品需求

| **方案类型**   | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                      |
| -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 标准产品方案（推荐） |                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 自定义开发方案       | **针对自定义开发方式 - 支持【复用功能定义】**： 如果当前产品功能与其他产品功能相似，可通过【复用功能】将其他产品的功能复制到当前产品中- 复用功能后会对当前已配置的功能进行覆盖，因此如在自动化、消息推送等配置中已使用现有功能，则请手动前往删除，以免产生异常数据； - Wi-Fi+BLE 的产品只可选择 Wi-Fi+BLE 的同品类 Spec 产品复用，BLE 的产品只可选择 BLE 的同品类 Spec 产品复用，其他联网方式只能选择从相同品类的产品中复制。 |

默认功能定义

#### 2.2 - 定义服务

代表了一类互相有联系的功能合集，例如开关 Switch 服务下，包含以下属性、方法、事件可以描述该服务中包含的具体功能。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/d6611621f76319893cb5b257e46d7f24_8.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=sCZQwvd7fjW2GtOFvxjP0o1U0Do=)

属性/方法/事件列表

| **服务类型** | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 标准服务（推荐）   | 支持小爱语控和和米家快捷卡片，可修改描述 编辑服务时可编辑服务名称、描述、备注字段- 描述：小爱语控通过描述字段选择正确的服务进行语控，如添加同名服务，请修改服务中的"描述"，例如 2 个 Switch 服务，请修改一个一个 Switch 服务的"描述"用于左键开关，修改另一个 Switch 用于右键开关 - 备注：用于开发者自行区分**注意：**- Wi-Fi+BLE 产品可以添加通过 Wi-Fi 上报的标准功能（即功能类型为 "标准 Wi-Fi"），也可按需添加通过 BLE 上报的标准功能（即功能类型为 "标准 BLE"），但自定义的功能只能通过 Wi-Fi 上报； - Wi-Fi+BLE、BLE 产品中的 BLE 服务 siid 不能大于 15，因此 Wi-Fi+BLE 的产品请先添加完 BLE 服务再添加 Wi-Fi 服务，但自定义服务 siid 不受限，其余联网方式的标准和自定义服务 siid 不受限。 |
| 自定义服务         | 自定义功能不支持小爱语控和米家快捷卡片，不可编辑描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

定义服务

#### 2.3 - 定义属性

单一的功能操作可以定义为属性，属性支持被查询、控制、订阅，例如灯的开关。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/e5ead60046c2e0a83ccea3029347c1dd_11.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=DSYaTXQql8znwXEIlbMTE6USnR4=)

属性列表

| **属性类型** | **说明**                                                                                                                                                                                                                                         |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 标准属性（推荐）   | - 在标准服务中只可以添加该服务预置的标准属性，无法在标准服务 A 下添加标准服务 B 预置的属性； - 格式默认为 bool、string 的标准属性不建议修改格式； - 格式默认为 uint、int 的标准属性可以修改为其他 uint、int 格式； - 可以修改单位； - 不可以修改权限。 |
| 自定义属性         | - 只可以在自定义服务下新建自定义属性 - 可以自定义名称、权限、格式、单位                                                                                                                                                                                |

定义属性

> **注意：**
>
> * Wi-Fi+BLE、BLE、BLE - Mesh 产品在添加标准、自定义 BLE 功能时，需要进一步选择功能用于：
>
>   + "1：网关上报"：表示该属性仅支持网关上报，只显示"网关权限"且不可更改。
>   + "2：云端计算"：表示该属性不支持网关/蓝牙直连操作，仅作为云端存储项
>   + "3：蓝牙直连"：表示该属性只支持蓝牙直连，只显示"直连权限"，非必填，默认空，从 "读/写/上报" 中选择。
>
>   > 蓝牙直连：是指可通过功能定义中的 Spec 蓝牙直连配置实现设备在未连接蓝牙 / 蓝牙 Mesh 网关时，通过扩展程序借助手机蓝牙与设备通信。
>   >
>
>   + "4：蓝牙直连和上报"：表示该属性支持蓝牙直连和网关上报，显示"网关权限" 且不可更改，同时显示 "直连权限" 非必填，默认空，从 "读/写/上报" 中选择。
>   + 如果是 string 属性："功能用于" 只能选择 "蓝牙直连"。

#### 2.4 - 定义方法

主要用于向设备下发组合控制指令，如电饭煲的开始煮饭。方法由输入参数、输出参数组成，可不配参数，也可按需配置 1 个或多个参数，只可选择当前服务中的属性作为参数。

| **方法类型** | **说明**                                                                                                                 |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------ |
| 标准方法（推荐）   | 在标准服务中，只可以添加该服务预置的标准方法，无法在标准服务 A 下添加标准服务 B 预置的方法，有的标准服务下不一定有预置标准方法 |
| 自定义方法         | 只可以在自定义服务下新建自定义方法                                                                                             |

定义方法

#### 2.5 - 定义事件

主要用于设备向云端上报组合数据，如门锁被打开。由输出参数组成，可不配参数，也可按需配置 1 个或多个参数，只可选择当前服务中的属性作为参数。

| **方法类型** | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 标准事件（推荐）   | - 在标准服务中只可以添加该服务预置的标准事件，无法在标准服务 A 下添加标准服务 B 预置的事件，有的标准服务下不一定有预置标准事件。 - 如果是 eiid>= 1000 的标准事件，参数总长度不能>9bytes。即所选全部参数按下面格式换算后累加不能>9bytes。（如添加了 string 参数，string 参数不参与长度计算。） bool ( 1byte ), int8 ( 1byte ), int16 ( 2bytes ), int32 ( 4bytes ), int64 ( 8bytes ), uint8 ( 1byte ), uint16 ( 2bytes ), uint32 ( 4bytes )，float（按 IEEE754 格式编码 , 4bytes） |
| 自定义事件         | 只可以在自定义服务下新建自定义事件                                                                                                                                                                                                                                                                                                                                                                                                                                               |

定义事件

#### 2.6 - 查看语音指令

为方便用户通过使用小爱语音控制设备，米家基于典型语控场景，针对部分品类的部分标准功能实现了语音指令，开发者可参考[小爱语控与功能定义使用规范](/v2/new/doc/resources-and-services/design/feature-define/language-control)，在对应品类中使用对应的标准功能时会自然支持被小爱语音控制，无需额外开发。

> **注意：**
>
> * 自定义功能不支持被小爱语控
> * 同名功能请选择不同的描述进行区分，例如多键位开关面板或多滤芯类产品，可能会有多种控制方式和查询指令，如"打开左开关"和"查询 1 号滤芯剩余量"等，因此开发者在定义产品功能时，需在统一命名服务下，使用不同的描述（即 description）加以区分，详细可参考[服务、属性描述词与功能定义使用对照表](/v2/new/doc/resources-and-services/design/feature-define/description)。

##### 2.6.1 - 查看语音指令

如果当前产品支持小爱语控，则会在下图出现【查看语音指令】按钮

> **说明：**
>
> 如没有需要的指令，请在上图点击【申请添加】，或在【控制台 - 管理 - 平台资源申请】点击【小爱语控申请】，工作人员会对您的需求予以评估。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/0f601891426fd49db92b3bb65b9a3430_1730690734432.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=NkicGEjQS3X4fhe9syinpjVCPyQ=)

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/28dc380857a9c204953560cd0e11989b_1730690817106.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Sd7on4Gt7aqaj/RZHGr9Z5weC0w=)

查看语音指令

##### 2.6.2 - 小爱语控测试工具

需要符合如下 2 个条件方可选择设备进入小爱语控测试工具。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/5afe3ae863fe1c050b3fa7ea4c1918d4_1730690892643.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ahgqb537A2fsLAV0a5h0FKQZ3po=)

小爱语控测试工具

#### 2.7 - 查看 JSON

点击【查看 JSON】按钮可查看功能定义的 JSON 数据，又称为 "实例" 或 "设备功能描述文件"。关于该 JSON 的解读请参考[实例定义规范](/v2/new/doc/resources-and-services/design/feature-define/feature-define)。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/6d4045a2b4e54edce35292a36bb29e15_1730690990856.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=Jm3iYYhhN+I6fnsp74wc04W+/xA=)

查看 JSON 数据

#### 2.8 - 配置多语言文案

功能定义的多语言文案用于快捷卡片（快速控制产品）、扩展程序页面等处展示，仅使用 Spec 标准协议的产品需要配置。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/3b776df1afcd460004fb789cc7b4f50a_1730691084465.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=dwhU3hFfZnORPwAf+JVrPRQ9DSY=)

功能定义文案多语言配置页面

#### 2.9 - 快捷卡片

为了方便用户在使用米家 App、小爱带屏音箱、小米手机负一屏、小米电视通过快捷卡片快速控制产品，使用标准 Spec 功能可自动生成快捷卡片，详情可参考[快捷卡片功能与 Spec 标准功能对照](/v2/new/doc/resources-and-services/design/feature-define/quick-card)，使用自定义 Spec 功能暂不支持生成快捷卡片。

## 后续操作

### 功能定义状态

功能定义默认状态为 "开发中"，如果产品或固件申请上线会将功能定义状态自动变成 "审核中"，产品或固件审核通过功能定义状态会变成 "已上线"。

### 功能定义版本迭代

| **迭代场景** | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 不迭代功能         | 功能定义上线后，仅支持对原（已上线）版本修改描述、备注，以及单位从“无”改为有单位； 暂不支持其他修改，以避免已购买设备的用户遇到体验不兼容的问题。                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 迭代功能           | 功能定义上线后，如需迭代功能: 1.**迭代新版本** 可点击【开始编辑】生成全新版本； 新版本会自动复制原版本的功能定义，开发者可在此基础上对功能：- 添加新功能； - 对原（已上线）版本修改描述、备注，以及单位从“无”改为有单位，为数值列表属性增加数值。   **注意：** 增加数值后不可删除，请谨慎操作。      2. **申请新版本上线** 迭代版本的功能定义如需上线，需要同步迭代固件版本； 在平台上传固件包的时候，选择关联当前需要上线的功能定义版本，等固件上线后，新功能定义版本的状态会自动变成“已上线”，扩展程序可通过当前设备上的固件版本关联的功能定义版本获取相应功能。 |

不同类型功能定义迭代说明

#### 扩展程序配置

# 扩展程序配置

更新时间：2024/11/06

> **注意：**
>
> 本章内容为扩展程序如何在平台进行上传配置，本地开发指导请参考[扩展程序开发](/v2/new/doc/plugin/quickstart/quick-start)

## 概念说明

扩展程序是米家 App 控制智能产品的操作界面，根据开发模式不同分为以下几种类型：

1. **标准扩展程序：** 由小米 IoT 平台基于产品功能定义中的标准功能自动生成的扩展程序，目前只针对部分品类开放；
2. **标准 + 自定义扩展程序：** 如果标准扩展程序不能完全满足企业的需求，企业可基于标准扩展程序自定义开发增量扩展程序包，只需实现标准扩展程序暂不支持的功能，请参考 [自定义扩展程序开发指导](/v2/new/doc/plugin/quickstart/quick-start)；
3. **自定义扩展程序：** 完全由开发者自行开发扩展程序的全部功能，请参考 [自定义扩展程序开发指导](/v2/new/doc/plugin/quickstart/quick-start)。

> **说明：**
>
> 在这些品类中，如灯、开关和窗帘电机，如果团队不具备扩展程序的开发能力，开发者可选择经过平台认证的[免开发解决方案](https://iot.mi.com/fe-op/solutionCenter/market)，7 天 0 代码即可实现快速产品接入。

## 前提条件

1. 在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[注册企业](/v2/new/doc/configuration/signin/create-enterprise)；
2. [登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)；
3. 在平台成功[创建产品](/v2/new/doc/configuration/create)；
4. [定义产品功能](/v2/new/doc/resources-and-services/design/feature-define/feature-define)。
5. 完成[扩展程序本地开发](/v2/new/doc/plugin/quickstart/quick-start)

## 配置要求

1. 如果产品支持标准扩展程序，则新建版本时不需要上传扩展程序代码包，否则需要上传；开发者可通过以下页面显示，判断该品类产品是否支持标准扩展程序：

| **扩展程序类型** | **页面显示** |
| ---------------------- | ------------------ |
| 标准扩展程序           |                    |
| 非标准扩展程序         |                    |

扩展程序类型判断

2. 无论是何种开发模式，都需要在每一条扩展程序上配置"在线隐私"，请参考[在线隐私配置](/v2/new/doc/configuration/extension-development/privacy-online)。

## 操作步骤

### 第 1 步 - 新建版本

在扩展程序页面，点击【新建版本】按钮后：

| **扩展程序类型** | **详情**                                                                                                                                                                                                               |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 标准扩展程序           | 如果该产品支持标准扩展程序，那么在"新建版本"后会生成一个标准版本如果标准版本不能完全满足企业的需求，企业可基于此开发增量扩展程序包：在该标准版本通过下图【增加】按钮上传自定义功能扩展包，即可实现标准扩展程序暂不支持的功能 |
| 自定义扩展程序         | 如果该产品不支持标准扩展程序，则需在"新建版本"后上传 16M 以内的 mpkg 扩展程序包                                                                                                                                              |

新建扩展程序版本

### 第 2 步 - 配置在线隐私

请参考[在线隐私配置](/v2/new/doc/configuration/extension-development/privacy-online)。

### 第 3 步 - 多语言文案配置（可选）

如使用标准扩展程序，则需要「高阶配置」中为功能定义[配置多语言文案](/v2/new/doc/configuration/advance-configure/multi-language)；

如不使用标准扩展程序，可以跳过此步骤。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/2aec950329a6faebb26e11dddc24548a_1730699588380.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=yz+oef8+5tPY1LzLataE20GrdZE=)

配置多语言文案

### 第 4 步 - 调试与自测

在完成扩展程序的开发和上传之后，开发者需要完成调试和自测，并将测试报告上传至小米 IoT 开发者平台。

> **说明：**
>
> * 新产品提交认证审核时，固件测试结果和扩展程序测试结果可共用一份测试报告；
> * 产品功能迭代提交认证审核时，固件测试结果和扩展程序测试结果可根据实际的情况，填写测试报告中相应的内容；
> * 测试资料，可在「控制台 - 产品 - 产品详情」左侧流程图「自测与预约」环节中下载。

#### 4.1 扩展程序调试

开启测试之前，请务必完成“扩展程序调试”。

如需调试扩展程序的控制功能，请开发者结合硬件产品调试扩展程序，若仅需调试扩展程序的 UI，开发者可在手机本地调试扩展程序，具体参考[调试器](/v2/new/doc/configuration/firmware/test-tool#%E8%B0%83%E8%AF%95%E5%99%A8)。

#### 4.2 扩展程序自测

在扩展程序列表中，点击【开启测试】，等待版本状态变成“测试中”后，可使用白名单进行测试扩展程序功能是否符合预期：

* 如果有真实设备，测试账号请通过米家 App 添加设备后测试；
* 如果暂无真实设备，点击【虚拟设备调试】可借助于虚拟设备测试。

> **说明：**
>
> 目前，虚拟设备只支持联网方式为 Wi-Fi 和 Wi-Fi+BLE 的产品；
>
> 在调试虚拟设备时：
>
> * 在 Web 端勾选属性、事件并设置后，点击【上报】可模拟设备上报数据，然后在米家 App 扩展程序即可看到相关功能的呈现结果；
> * 在米家 App 扩展程序上操作后，可在 Web 端查看日志。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/1e92bcc2ffe78b5b820676459dacaf5a_1730699975758.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=uZZ4txJTPo2STpNO+DDgqu+YNic=)

虚拟设备调试步骤

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/1654fe3be4463d22d993b91841a1585a_8.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=7FWybNn5+jOkRSnLqDva1cex//k=)

虚拟设备调试页面

### 第 5 步 - 申请上线

完成以上步骤后，在列表处点击【申请上线】，即可对扩展程序申请上线。

## 后续操作

等待审核结果，如审核不通过，请重新新建版本并自测。

### 迭代扩展程序

开发完新版本扩展程序后，需在扩展程序开发页面新建版本并上传，并参考本章“[操作步骤](/v2/new/doc/configuration/extension-development/extension-development#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4)”部分为新版本配置在线隐私、自测，重新提交申请上线。

#### 固件配置

# 固件配置

更新时间：2024/11/06

## 概念说明

* **固件：** 指写入 EROM（可擦写只读存储器）或 EEPROM（电可擦可编程只读存储器）中的程序，是担任着一个系统最基础最底层工作的软件，是控制硬件产品与小米 IoT 平台通信并执行指定功能的基础。
* **模组：** 模组是一个可以集成到目标电子系统的元器件，小米智能模组集成了小米 IoT 平台开放能力，并已获取了主流的认证测试，能够使嵌入式系统连接到网络，并与小米服务进行通信。
* **OTA：** OTA 为 Over-the-Air 的缩写，是对设备固件进行迭代升级的方式。
* **CRC32：** CRC 为 Cyclic Redundancy Check 的缩写，指循环冗余检查，是一种为了保证数据的正确而采用的验错手段，当使用的是 Wi-Fi+BLE 模组，且使用小米标准模组 + MCU 开发模式时，需要在固件尾部添加 CRC，小米提供了[添加 CRC32 的工具](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/ea87815b02c04550ea4bdae20d9ea2a8_crc32.zip?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=CYNJHo23nP1Cwba2roLXxuO3ghc=)。

## 前提条件

开始固件设置及开发前，请确保您已完成以下内容：

1. 在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[注册企业](/v2/new/doc/configuration/signin/create-enterprise)；
2. [登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)；
3. 在平台成功[创建产品](/v2/new/doc/configuration/create)；
4. [定义产品功能](/v2/new/doc/resources-and-services/design/feature-define/feature-define)。
5. 成功[创建扩展程序](/v2/new/doc/configuration/extension-development/extension-development)；
6. 参考[小米模组硬件设计规范](/v2/new/doc/resources-and-services/design/hardware)，了解固件开发时所需注意的事项；
7. [申请或采购模组](/v2/new/doc/resources-and-services/module)

> **说明：**
>
> 如不具备固件开发能力，可选择经过平台官方认证的[免开发解决方案](https://iot.mi.com/fe-op/solutionCenter/market)（目前仅支持"灯"、"开关"、"电机"品类，更多品类开放敬请关注「解决方案中心」），7 天 0 代码即可快速实现产品智能化。

## 操作步骤

### 第 1 步 - 固件设置

在「固件开发 - 固件设置」中，点击【编辑】按钮，配置固件的基础信息：

> **注意：**
>
> 请根据产品实际情况，参考以下提示正确填写固件信息；
> 该信息会影响后续固件资源申请项、支持固件类型和自动化测试工具的正确显示和配置。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/3568471c22d0633bb45fa6be2042467a_1730702264388.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=tCY3z96umd/z7o8v5GgVhdCd6Ao=)

固件基础信息配置

#### 操作系统

请选择您的设备使用的操作系统，若无其它操作系统，请选择"无"。

#### 开发方式

固件开发中，关于开放方式的选择可参考下表：

| 联网方式                            | 联网方式特点[（更多指南）](/v2/new/doc/introduction/preparation/access_mode)                                                                              | 设备操作系统                                                                | 开发模式              | 开发模式特点                                                                  | 安全芯片                                                   | 需申请的资源[（更多指南）](/v2/new/doc/resources-and-services/source) |
| ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------- | --------------------- | ----------------------------------------------------------------------------- | ---------------------------------------------------------- | ------------------------------------------------------------------ |
| Wi-Fi或Wi-Fi+BLE                    | - 产品有电源常供电 - 使用环境中有 WiFi 网络覆盖 - 产品没有批量部署需求                                                                                 | - RTOS - 无                                                                 | 小米标准模组 + MCU    | - 适用于可集成 MCU 的产品 - 开发者仅需开发 MCU 程序，难度低、成本低、易于维护 | /                                                          | /                                                                  |
| 基于小米 IoT SDK 开发               | - 适用于不能或不想集成 MCU 的产品 - 需修改平台 SDK 并进行固件烧录，难度高，不易维护                                                                    | /                                                                           | Wi-Fi SDK             |                                                                               |                                                            |                                                                    |
| 基于小米 SDK 标准接口的独立模块开发 | - 适用于不能或不想集成MCU的产品 - 通过 Wasm 虚拟机技术，应用代码与模组固件可分开编译与升级，开发方式类似 " MCU + 标准模组 " ，难度低，成本低，易于维护 | /                                                                           | MIOT INC SDK          |                                                                               |                                                            |                                                                    |
| - Linux - Android                   | 基于小米 IoT SDK 开发                                                                                                                                  | - 用于使用 LInux / Android 系统的设备 - 需要修改平台 SDK ，难度高，不易维护 | 有                    | Linux SDK / Android SDK                                                       |                                                            |                                                                    |
| 无                                  | - Linux SDK / Android SDK - 三元组                                                                                                                     |                                                                             |                       |                                                                               |                                                            |                                                                    |
| BLE                                 | - 由电池供电的低功耗产品 - 需近场通信的产品 - 车载类产品                                                                                               | - RTOS - 无                                                                 | 基于小米 IoT SDK 开发 | - 适用于单 SOC 开发的产品和可集成 MCU 的产品                                  | 除高安全级别产品（如：锁、保险箱等）外，均无需使用安全芯片 | BLE SDK                                                            |
|                                     |                                                                                                                                                        |                                                                             |                       |                                                                               |                                                            |                                                                    |
| BLE Mesh                            | - 低功耗 - 需大批量部署 - 有数据上报和指令接收操作                                                                                                     | /                                                                           | BLE Mesh SDK          |                                                                               |                                                            |                                                                    |
| 固件开发方式                        |                                                                                                                                                        |                                                                             |                       |                                                                               |                                                            |                                                                    |

#### OTA 方式

根据开发模式的不同，小米支持以下 OTA 方式：

| 开发模式                            | OTA 方式                                                                                                                                                                                            | OTA 方式特点                                                                                                                                                                                  |
| ----------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 小米标准模组 + MCU                  | MCU 固件 OTA                                                                                                                                                                                        | - 厂商需要迭代 MCU ：厂商在小米开发者平台上传 MCU 版本，并由平台分发给用户 - 小米平台更新 SDK ：小米开发者平台自动分发给用户                                                                  |
|                                     |                                                                                                                                                                                                     |                                                                                                                                                                                               |
| 基于小米 IoT SDK 开发               | 含 SDK 固件 OTA                                                                                                                                                                                     | 仅使用小米 IoT SDK 开发 - 厂商需要迭代 SDK 时，修改 SD K后，在小米开发者平台上传新版本，并由平台分发给用户 - 平台需要更新 SDK 时，厂商需要下载最新的 SDK 、修改并上传到平台，由平台分发给用户 |
| 含 SDK 固件 OTA + MCU 固件 OTA      | 同时使用小米 IoT SDK 和 MCU 开发 - 厂商需要迭代时，需修改 SDK 版本 / MCU 版本，上传至开发者平台，并由平台分发给用户 - 平台发起时，厂商需要下载最新的 SDK 、修改并上传到开发者平台，由平台分发给用户 |                                                                                                                                                                                               |
| 基于小米 SDK 标准接口的独立模块开发 | 独立模块 OTA[（更多指南）](/v2/new/doc/embedded-dev/inc-dev/function-dev/inc-ota)                                                                                                                      | - 厂商需要迭代 INC 固件：厂商在小米开发者平台上传新版本 INC 固件，并由平台分发给用户 - 小米平台更新 SDK ：小米开发者平台自动分发给用户                                                        |
| 固件 OTA 方式                       |                                                                                                                                                                                                     |                                                                                                                                                                                               |

#### 模组型号

请选择您在本章[「前提条件 - 申请或采购模组」](/v2/new/doc/resources-and-services/module)部分中选择的模组型号。

> **注意：**
>
> 为避免开发受阻，若还没有确定模组型号，请务必先参考[模组选型](/v2/new/doc/resources-and-services/module)，提前完成[模组采购](https://iot.mi.com/fe-op/manageCenter/purchase/module)。

### 第 2 步 - 资源申请

根据您的产品类型和固件基础信息，平台会自动向您推荐适合的资源，您也可以参考[资源申请](/v2/new/doc/resources-and-services/source)。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/8bbd7ccbd53ca0e46da686db23a870ce_1730702390383.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=nde86+tWwumc27SQ100AhbR7t/w=)

资源申请

### 第 3 步 - 固件开发

根据产品类型和联网方式，请参考以下文档进行开发：

* [Wi-Fi 通用模组开发](/v2/new/doc/embedded-dev/module-dev/quickstart)
* [Wi-Fi SDK 开发](/v2/new/doc/embedded-dev/sdk-dev/quickstart)
* [Wi-Fi INC SDK 开发](/v2/new/doc/embedded-dev/inc-dev/c3_inc_quickstart)
* [OT Client SDK 开发](/v2/new/doc/embedded-dev/linux-ot/quickstart)
* [BLE SDK 开发](/v2/new/doc/embedded-dev/ble-sdk/quickstart)
* [BLE Mesh SDK 开发](/v2/new/doc/embedded-dev/ble-mesh/quickstart)

> **注意：**
>
> 当您使用的是 **WiFi+BLE 模组**，且开发模式为 **小米标准模组 + MCU** 时，**必须使用 [CRC32 工具](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/ea87815b02c04550ea4bdae20d9ea2a8_crc32.zip?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=CYNJHo23nP1Cwba2roLXxuO3ghc=)在固件尾部添加 CRC**。

### 第 4 步 - 上传固件

在「固件开发 - 上传固件」处，点击【新建版本】，完成固件包的上传。

> **说明：**
>
> 您需要上传 **至少 2 个固件版本**，一个版本与您的厂包相同，用于进行上线；另一个无需上线，仅用于[测试 OTA 能力](/v2/new/doc/configuration/firmware/test-tool)；
>
> 其中，两个版本的固件内容可以相同，版本号需进行区分。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/608c71a77e5f9c7ed4afc9dc35a463b0_1730702517285.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=VwFnOQ2VejFFshGliUTqyXWQ0RY=)

上传固件版本

#### 填写项说明

点击【新建版本】后，需要完成弹窗内容的填写，具体填写说明参考下表：

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/55ba044029c83dea06be9c2e4a1f74a7_1730702588181.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=kX4GG6Iy9hO3CKm9EuKzr3xo7iI=)

新建固件版本弹窗

| 填写项                 | 说明                                                                                                                                                                                                                     | 备注                                                                                                                                                                                              |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 固件版本               | - 开发模式为“小米标准模组 + MCU ”的硬件产品，固件版本的格式为“xxxx”，其中xxxx为 0~9 数字，如 0001 - 开发模式为“基于小米 IoT SDK 开发”硬件产品，固件版本的格式为“ SDK 版本\_xxxx ”，其中 xxxx 为 0~9 数字如 0001 | 建议开发者从“ 0001 ”起，以按序递增的方式编写固件号                                                                                                                                              |
| 关联功能版本           | 选择开发者需关联的功能版本                                                                                                                                                                                               | 请开发者正确地选择所需关联的功能版本                                                                                                                                                              |
| 固件包                 | 与产品功能定义关联的产品固件包                                                                                                                                                                                           | - 固件包格式： .bin/zip - 固件包大小：不超过 80MB                                                                                                                                                 |
| 更新日志               | 为方便用户查看固件更新的信息，开发者上传硬件产品的固件后，需更新固件的日志                                                                                                                                               | - 该日志内容用户可见 - 为了提升用户查看固件日志的体验，建议开发者准确填写固件日志，例如“更新(优化) XXX 、 XXX 和 XXX 等功能” - 固件上线前，请及时检查并测试固件日志中的内容，确保内容正确且准确 |
| 新建固件版本填写项说明 |                                                                                                                                                                                                                          |                                                                                                                                                                                                   |

#### 固件操作说明

完成固件上传后，固件版本列表会出现以下操作项：

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/7d9e76d0aafbbf58707ed876f58c9f2b_1730703099898.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=c4Rx1bSnRLc/QER8xNOf/08POQA=)

固件版本列表操作项

| **操作项** | **说明**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | **图例** |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------- |
| 详情             | 固件上传成功后，小米 IoT 开发者平台将会自动生成下载链接，可点击【详情】进行查看；链接可被使用于平台测试工具。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                |
| 开启测试         | 点击【开启测试】后，您可使用平台的[测试工具](https://account.xiaomi.com/fe/service/oauth2/authorize?response_type=token&skip_confirm=false&client_id=2882303761517852065&redirect_uri=https%3A%2F%2Fautotest.iot.mi.com%2Fcb&_locale=zh_CN)对固件进行测试；同时，您在「[管理 - 成员管理 - 内测用户](https://iot.mi.com/fe-op/manageCenter/member/intranetMember)」中添加的白用户可获取到该固件版本。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                |
| 签名             | 为提高固件的安全性，您需对开发模式为**"基于小米 IoT SDK 开发"** 的硬件产品签名。 **注意：** 请在"开启测试"前完成对硬件产品固件的签名，否则将无法操作签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                |
| 设为必经         | 为方便用户更新体积较大的固件，开发者可使用"设为必经"的功能，将指定版本的固件设为必经；将固件设置为必经后，用户在升级产品固件时，会先升级该固件包，实现逐步升级产品固件的效果。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                |
| 配置签名和 HTTPS | -**支持签名的最低版本：** 指定支持签名的最低版本后，开发者迭代硬件产品的固件时，如该固件版本大于支持签名最低版本，均需对固件签名。请从已签名的 **最低版本** 开始选择，如选择的版本较高或选择"不支持"，则当用户升级某版本时，如该版本低于"支持签名的最低版本"，则即使该版本已签名，也仅会拉取未签名的版本； - **支持 HTTPS 的最低版本：** 指定支持 HTTPS 的最低版本后，用户下载硬件产品的固件时，如该固件版本大于支持 HTTPS 的最低版本，固件的下载链接将会被加密； - **强制升级版本：** 指定强制升级的版本后，若用户固件的版本低于开发者指定的版本，米家 App 将会 **强制** 用户升级产品的固件，不升级到该固件版本时，用户无法正常使用扩展程序。因此，为保证用户体验，请勿滥用该功能。  **说明:**  "强制升级版本"与"设为必经"功能的区别是：- 有强制升级版本时，用户如不进行升级，就无法进行后续操作； - 有必经版本时，用户可以在不升级的状态下继续使用扩展程序及设备功能，但当用户需要升级时，无法直接升级至最新版本，需要先升级至必经版本。 |                |

固件版本列表操作说明

### 第 5 步 - 调试与测试

为方便开发者调试和自测固件，平台提供了一系列的自动化测试工具，具体参考[调试与测试](/v2/new/doc/configuration/firmware/test-tool#%E8%B0%83%E8%AF%95%E5%99%A8)：

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e3d4da2ecde3c2ddf48e18da5f6d2d72_1730703701167.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=pHCPALCYRybd5ndNnCXY4DK2lKU=)

固件调试与测试工具

## 后续操作

### 申请上线

各模块均开发及自测完成后，可提交固件上线，请参考[产品申请上线](/v2/new/doc/configuration/publish-product)。

### 固件迭代

> 注意：迭代固件之前，请确认是否需要迭代功能定义。

固件上线后，如需迭代固件版本，可在固件列表中【新建版本】并完成新固件包的上传，操作步骤和新建固件完全一致，请参考本章[第 4 步 - 上传固件](/v2/new/doc/configuration/firmware/firmware#%E7%AC%AC%204%20%E6%AD%A5%20-%20%E4%B8%8A%E4%BC%A0%E5%9B%BA%E4%BB%B6)；

另外，为了提升用户查看固件日志的体验，在更新版本时候请准确填写固件日志，例如"更新（优化）XXX、XXX 和 XXX 等功能"。

#### 高阶配置

# 配网引导配置

更新时间：2024/11/06

> **注意：** 所有产品必配，可以参考[米家 App 素材设计规范](/v2/new/doc/resources-and-services/design/elements)上传符合规范的图片和内容。

## 概念说明

**配网引导**：配置设备联网说明、设备初始化说明等米家 App 添加产品流程中的相关页面，用于引导用户通过米家 App 将设备加入网络。

## 前提条件

1. 在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[注册企业](/v2/new/doc/configuration/signin/create-enterprise)；
2. [登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)；
3. 在平台成功[创建产品](/v2/new/doc/configuration/create)；
4. [定义产品功能](/v2/new/doc/resources-and-services/design/feature-define/feature-define)。

## 配置要求

必须完成配置后，产品才允许申请上线，可以参考[米家 App 素材设计规范](/v2/new/doc/resources-and-services/design/elements)上传符合规范的图片和内容。

## 操作步骤

### 第 1 步 - 选择快连入口

每个产品在米家 App 都有单独的快连添加入口，如果当前产品和另一款已上线的产品类型、名称、外观、联网方式、配网方式均一致，可以选择与其共用一个添加入口和配网引导配置，称作"合并快连"。

合并快连后当前产品就不用配置配网引导，而"不合并"快连入口，则需配置配网引导。

| **类型** | **说明**                                                                                                                           |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| 合并快连入口   | 只有当前企业组，存在另一款产品和当前产品"产品类型"、"联网方式"、"配网方式"、"名称"、"外观"均一致，且产品已上线，该配置才会显示"合并"选项 |
| 不合并快连入口 | 选择"不合并"快连入口，则需要完成下方的配网引导项                                                                                         |

快连入口选项说明

### 第 2 步 - 配置配网引导项

当选择"不合并"快连时，则需要配置对应的配网引导项：

> **注意：**
>
> * 设备确认配对引导如有文案，需将文案写在图片上，每种语言上传分别上传一张图片；
> * 其余 3 种配网引导文案与图片分离，多种语言共需一张图片，不同语言的文案可在[「文案多语言配置」](/v2/new/doc/configuration/advance-configure/multi-language)中配置；
> * 产品上线后，开发者可在"多语言配置"中编辑"设备配网引导"中的信息；
> * 有关配网引导素材的详细说明，请参考"[米家 App 素材设计规范](/v2/new/doc/resources-and-services/design/elements)"，上传符合规范的图片和内容。

| **联网方式**            | **其他条件**                                      | **需要配置的配网引导项（附图）**                                          |
| ----------------------------- | ------------------------------------------------------- | ------------------------------------------------------------------------------- |
| BLE                           | 配对方式为 "设备确认即配对"                             | 需要配置"产品初始化引导"、"BLE 重置引导"、"BLE 设备确认配对引导"共 3 种配网引导 |
| 配对方式不为 "设备确认即配对" | 需要配置"产品初始化引导"、"BLE 重置引导"共 2 种配网引导 |                                                                                 |
| Wi-Fi+BLE                     | 配网方式为 " WiFi+BLE 双绑定"                           | 需要配置"产品初始化引导"、"BLE 设备确认配对引导"共 2 种配网引导                 |
| Wi-Fi、Wi-Fi+BLE、仅网线      | 基础配置中选择 "支持" 网线                              | 需要配置"产品初始化引导"、"网线配网引导"共 2 种配网引导                         |
| 其他                          | -                                                       | 仅需配置产品初始化引导                                                          |

联网方式和配网引导配置项对应关系

### 固件开发

#### Wi-Fi 通用模组开发

# 开发准备

更新时间：2024/11/06

## 技术框架

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/73eac8fd9a2204fc4baa4e86c1194d25_mcu_dev_model2.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=URDE2BoBQ2mFGx9AYkSa50/y7WY=)

MCU 技术框架

## 开发资源/文档地图

| **文档说明**                                            | **文档链接**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Wi-Fi 模组选型、Datasheet、射频证书                           | [模组硬件资料](https://iot.mi.com/moduleBrowser.html)                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Wi-Fi 模组硬件连接、串口测试、联网测试、串口 log、及 OTA 测试 | [模组快速启动](/v2/new/doc/quick-started/standard-module)                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| MCU 功能调试、串口指令交互、程序流程图                        | [MCU 功能开发](/v2/new/doc/embedded-dev/module-dev/function-dev/mcu-dev) [串口指令](/v2/new/doc/embedded-dev/module-dev/function-dev/serial-communication)                                                                                                                                                                                                                                                                                                                                              |
| MCU 固件更新规范、MCU Xmodem 升级流程、MCU 固件 OTA 测试      | [MCU 固件更新](/v2/new/doc/embedded-dev/module-dev/ota/mcu-ota) [MCU 测试工具](https://autotest.iot.mi.com/ota/main) [MCU 固件自动更新](/v2/new/doc/embedded-dev/module-dev/ota/auto-ota)                                                                                                                                                                                                                                                                                                                  |
| 通用模组开发方式插座 Demo                                     | [Demo 开发指导文档](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/11edeba687d093a36e1fb36e5374b049_MIOT-%E6%99%BA%E8%83%BD%E6%8F%92%E5%BA%A7Demo.pdf?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=AQNaFgPlq6UVvFBsDqz7o8FbzwM=) [Demo 程序](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/80c0bfc182c3d9d4ce3607b29e15efcb_plug_mcu_demo.zip?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=/oUDctnST4xePh4jHbqy2bTNq9o=) |
| MCU 固件生成代码、云端 Spec 交互指令                          | [固件生成代码](/v2/new/doc/embedded-dev/module-dev/auto-dev) [云端交互指令](/v2/new/doc/embedded-dev/module-dev/rpc)                                                                                                                                                                                                                                                                                                                                                                                    |
| 平台固件开发操作                                              | [固件开发平台操作](/v2/new/doc/configuration/firmware/firmware)                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 开发过程中如需查询模组的日志信息                              | 请参考文档[&#34;设备日志查询&#34;](/v2/new/doc/configuration/others/log)；                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Wi-Fi 开发 FAQ                                                | [Wi-Fi FAQ](/v2/new/doc/embedded-dev/module-dev/mcu-faq) [帮助中心](/v2/new/doc/help-support/help-center)                                                                                                                                                                                                                                                                                                                                                                                               |

开发资源

## 前提条件

* 注册企业：在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[注册企业](/v2/new/doc/configuration/signin/create-enterprise#%E5%88%9B%E5%BB%BA%E6%96%B0%E4%BC%81%E4%B8%9A%E7%BB%84)。
* 成为开发者：在企业开发组下添加开发者，参考[企业成员管理](/v2/new/doc/configuration/signin/manage-member)。

## 固件开发

### 固件平台设置

* 第 1 步：固件设置（开发模式、OTA 方式、系统平台、模组型号）和申请样品
* 第 2 步：资源申请
* 第 3 步：固件开发（重点）

### 硬件链接

[模组硬件资料](https://iot.mi.com/moduleBrowser.html)

| MHCWB5 模组引脚图 | MHCWB6 模组引脚图 |
| ----------------- | ----------------- |
|                   |                   |

> **注意：**
>
> MHCWB4P-B(IB) 模组平台已经 EOL，不支持新产品接入。

### 串口连接 + 基础设置

* 建议开发者使用 CP2102/CH340 串口转 USB 工具
* 波特率: 115200、数据位: 8、奇偶校验: None、停止位: 1

> **注意：**
>
> 小米模组出厂带有模组程序**无需烧录**，且**命令串口**与 **log 串口** 分别为**两个串口**

#### 开机 log

log

```
 \_| \_| \_|\_|\_| \_|\_|\_| \_|\_|  
 \_|\_| \_|\_| \_| \_| \_| \_|  
 \_| \_| \_| \_| \_| \_| \_|  
 \_| \_| \_| \_| \_| \_|  
 \_| \_| \_|\_|\_| \_|\_|\_| \_|\_|  
 JENKINS BUILD NUMBER: N/A  
 BUILD TIME: Apr 26 2021,11:58:13  
 BUILT BY: N/A  
 MIIO APP VER: 2.2.0    // Wi-Fi Version  
 MIIO MCU VER: 0001     // MCU Version  
 MIIO DID: 313397xxx    // DID：device ID  
 MIIO WIFI MAC: 5ce50c9bdxxx  // MAC  
 MIIO MODEL: miot.plug.plugin  // model  
 ARCH TYPE: esp32,0x0000a601  // 芯片平台  
 ARCH VER: ba139e4  
 FLASH INFO: manufacturer(0x68), memory type(0x40), capacity(0x16)  

```

#### 基础命令设置

log

```
[0;32m08:00:30.950 [D] tou: recv=model miot.plug.plugin  
[0;32m08:00:30.970 [D] tou: send=ok  
[0;32m08:00:33.960 [D] tou: recv=ble_config set 9366 0001  
[0;32m08:00:33.960 [D] tou: send=ok  
[0;32m08:00:42.820 [D] tou: recv=mcu_version 0001  
[0;32m08:00:42.960 [D] tou: send=ok   
  
// 检查参数设置  
[0;32m08:00:42.830 [D] tou: send=ok  
[0;32m08:00:56.230 [D] tou: recv=model  
[0;32m08:00:56.230 [D] tou: send=miot.plug.plugin  
[0;32m08:01:11.740 [D] tou: recv=ble_config dump  
[0;32m08:01:11.740 [D] tou: send=["product id":9366,"version":2.2.0_0001]   

```

### 串口命令

参考[《串口命令》文档](/v2/new/doc/embedded-dev/module-dev/function-dev/serial-communication)

## 联网测试

1. 模组正常启动后，开发者将模组 model 修改为待开发产品的 model 和 pid 后，可以使用命令 `model` 和 `ble_config dump` 检查。

> **说明：**
>
> 1. [如何查看 model+pid？](/v2/new/doc/embedded-dev/module-dev/mcu-faq#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%BA%A7%E5%93%81%E7%9A%84%20model%20%E4%B8%8E%20pid%EF%BC%9F)
> 2. [串口发送失败/没反应？](/v2/new/doc/embedded-dev/module-dev/mcu-faq#%E6%A8%A1%E7%BB%84%E7%9A%84%E4%B8%B2%E5%8F%A3%E5%91%BD%E4%BB%A4%E6%B2%A1%E6%9C%89%E5%8F%8D%E5%BA%94)

命令：

log

```
// 设置产品 model  
↓ model miot.plug.plugin  
↑ ok  
  
// 设置产品 PID  
↓ ble_config set 9366 0001  
↑ ok  
  
// 设置 MCU 版本  
↓ mcu_version 0001  
↑ send=ok  

```

2. 使用[具有开发者权限的账号](/v2/new/doc/configuration/signin/manage-member)登录米家 App，并通过添加设备连接该模组连上云端。([发现不了设备？](/v2/new/doc/embedded-dev/module-dev/mcu-faq#%E7%B1%B3%E5%AE%B6%20App%20%E6%97%A0%E6%B3%95%E6%89%BE%E5%88%B0%E8%AE%BE%E5%A4%87))

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/6c386b329f260b5d0d47feff64a04faa_1702349964770.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=vGOoODzK4IvuPr1Z6GCQVgkalfE=)

   设备配网
3. 使用添加产品的账号，登录小米 IoT 开发者平台，进入该企业组对应的产品后，开发者在 **"固件开发"** 页面的硬件调试列表中可看到产品对应的设备

   ![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/9e9f8b4162582f8cb26c0e88738b41f8_1730707391348.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=e2ctxg1SBFv35hhtnPNlRuYF4l8=)

   硬件调试

### 调试 log

#### 调试工具

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/9d7b0a31eeb96cd14488e79d5391e04e_1730707424758.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=xfbZJBshLki2GEgYEr0OE6B52Gw=)

工具按钮

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/9e78b5f67cde70eec639015c3019d86e_1702364535015.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=LlxvbJVG8SN5M9yTsdqfig7HJX4=)

set\_properties (关闭开关)

#### 模组 log

log

```
[0;32m21:40:48.530 [D] ots: {"from":"11","id":1658871,"method":"set_properties","params":[{"did":"313397xxx","piid":1,"siid":2,"value":false}]}.  
[0;32m21:40:49.410 [D] tou: recv=get_down  
[0;32m21:40:49.410 [D] tou: send=down set_properties 2 1 false  
[0;32m21:40:49.930 [D] tou: recv=result 2 1 0  
[0;32m21:40:49.950 [D] tou: send=ok  
[0;32m21:40:49.960 [D] ots: ots_down_rpc_delegate_ack(), 198, ack: {"id":1658871,"result":[{"did":"313397366","siid":2,"piid":1,"code":0}],"exe_time":1420}, len: 88  

```

> **注意：**
>
> 如果选择的是 ESP32-WROOM-32D(32U) 系列或者 MHCWB6 系列通用模组，且固件版本分别在 2.2.6 及以上、1.0.7 及以上，模组会默认关闭日志输出，启动后会打印少量日志后再无任何输出，如果需要查看模组运行日志，请使用 set\_log\_level log\_level 指令进行打开，log\_level 范围为 0 ~ 5, 0 表示开启 debug 日志，5 表示关闭日志打印。

#### Wi-Fi SDK 开发

# 快速开始

更新时间：2024/05/15

为了帮助开发者快速了解使用 Wi-Fi+BLE 双模模组和 Wi-Fi SDK 将产品接入小米 IoT 平台的步骤和开发方式，开发者需根据本文内容，获取用于开发产品功能的 SDK，根据开发固件所使用的模组或芯片搭建开发环境，借助小米 IoT 平台提供的 Demo 程序了解开发产品固件的步骤和方法。

> **说明：**
>
> * 仅 Linux 环境支持开发者使用 Wi-Fi SDK 开发产品的固件。

## 开发资源

| **文档说明**                               | **文档链接**                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Wi-Fi 模组选型、Datasheet、射频证书              | [模组硬件资料](https://iot.mi.com/moduleBrowser.html)                                                                                                                                                                                                                                                                                                                                                                                                   |
| SDK 申请、环境搭建、固件烧录、联网测试、串口 log | [SDK 开发快速开始](/v2/new/doc/quick-started/sdk-module)                                                                                                                                                                                                                                                                                                                                                                                                |
| SDK 固件自动 OTA 更新                            | [固件自动更新](/v2/new/doc/embedded-dev/sdk-dev/function-dev/auto-ota)                                                                                                                                                                                                                                                                                                                                                                                  |
| SDK 智能灯 Demo                                  | [Demo 开发指导文档](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/60531eea1dbc571998d80cdb74809c9f_1703747379178.zip?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=h9jHf9RuJLyxipszYe/sH8TcY4o=)  [Demo 程序](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/c0355544ffcab2d48a4d24f36b16e186_1703758081196.zip?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=f2ifQJbYLFbcYg7PipAcXkCoByA=) |
| MCU 固件生成代码、云端 Spec 交互指令             | [固件生成代码](/v2/new/doc/embedded-dev/module-dev/auto-dev#%E5%9F%BA%E4%BA%8E%E5%B0%8F%E7%B1%B3IoT%E7%A1%AC%E4%BB%B6SDK%E5%BC%80%E5%8F%91) [云端交互指令](/v2/new/doc/embedded-dev/module-dev/rpc) [平台固件开发操作](/v2/new/doc/configuration/firmware/firmware)                                                                                                                                                                                           |
| Wi-Fi 开发 FAQ                                   | [Wi-Fi FAQ](/v2/new/doc/embedded-dev/sdk-dev/sdk-faq) [帮助中心](/v2/new/doc/help-support/help-center)                                                                                                                                                                                                                                                                                                                                                     |

开发资源

## 获取 SDK

开发者需先用小米账号登录[小米 partner-gitlab 账号](https://partner-gitlab.mioffice.cn/)，在平台[申请 Wi-Fi SDK](/v2/new/doc/resources-and-services/source#%E8%B5%84%E6%BA%90%E7%94%B3%E8%AF%B7%E6%B5%81%E7%A8%8B) 及**配置账号 SSH**，再使用命令 `git clone` 在本地环境(Linux)下获取相应的资源。

> **说明：**
>
> * 为了确保开发者能够完整地获取小米 IoT 模组的 SDK，请开发者使用 `git --recursive` 命令；
> * 请在 Linux 环境下编译 SDK，在虚拟机环境(cgywin)或者 WSL 下编译 SDK 时可能会无法编译。
> * linux 环境中乐鑫 SDK 需要时 Python2.7 版本。

## 搭建开发环境

### ESP32 模组 SDK 开发

可参考 p-gitlab SDK 中二次开发 API 指导 PDF( [ESP32-WiFi 模组二次开发指导文档.pdf](https://partner-gitlab.mioffice.cn/miot/bsp/miot-esp32-sdk/-/tree/master/debug/docs) )。

**准备工作：安装工具**

bash

```
sudo apt-get install git wget flex bison gperf python python-pip python-setuptools python-serial python-click python-cryptography python-future python-pyparsing python-pyelftools cmake ninja-build ccache  

```

**1.下载小米 ESP32 SDK（也可以参考[乐鑫官网引导安装](https://docs.espressif.com/projects/esp-idf/zh_CN/latest/get-started/index.html)）**

bash

```
cd ~    # 回到 home 目录  
sudo mkdir esp      # 建立 esp 开发文件夹，编译开发文件夹  
cd esp/             # 进入 esp 目录  
sudo git clone --recursive git@partner-gitlab.mioffice.cn:miot/bsp/miot-esp32-sdk.git   # clone 米家 SDK  

```

**2.下载乐鑫 SDK 和获取对应 SDK 及工具链**

建议直接 `cd` 到 `miot-esp32-sdk/debug` 执行 [**config\_esp\_sdk.sh**](https://partner-gitlab.mioffice.cn/miot/bsp/miot-esp32-sdk/-/blob/master/debug/config_esp_sdk.sh) 脚本（2.2.0 版本以上支持）自动完成乐鑫工具链和 IDF 的下载

bash

```
cd miot-esp32-sdk/  
./config_esp_sdk.sh  

```

**3.固件编译**

bash

```
cd miot-esp32-sdk/debug/miio_project/  
./gen_default.sh                     # 全编译  
make flash                           # python 直接烧录，注意加载串口和进入 Boot 模式  

```

**4.如编译不过，可以检查：**

> 如编译不过，可以检查：
>
> 1. 所有 git 使用 `--recursive` 保证 git 完整
> 2. 编译工具链的环境配置：环境变量的配置可以在对应的工程下运行 `printenv |grep "PATH"` 查看，SDK 和 toolchain 两者缺一不可而且**必须和工程位置保持一致**
>
>    3. 检查是否有 `IDF_PATH=$your_path/miot-esp32-sdk/debug/esp-idf`
>
>    > IDF 设置：在 `miot-esp32-sdk/debug` 目录下，用 `source path_config.sh` 设置生效 SDK path
>    >
>
>    2. 检查是否有 `PATH=$your_path/esp/xtensa-esp32-elf/bin`
>
>    > Toolchain 设置：在 home 目录下用 `vim .profile` 编辑加入 `export PATH="$your_path/esp/xtensa-esp32-elf/bin:$PATH"` 并执行 `source .profile`
>    >
> 3. 检查依赖：`sudo apt-get install git wget flex bison gperf python python-pip python-setuptools python-serial python-click python-cryptography python-future python-pyparsing python-pyelftools cmake ninja-build ccache`
> 4. 乐鑫 SDK 是否打上小米 Patch: `$your_path/miot-esp32-sdk/debug/esp-idf-patch`
> 5. 请**不要在 cgywin** 下进行编译，需要 Linux 环境

### 工程目录结构

完成上述操作后，目录结构如下：

bash

```
$SDK_PATH/miot-esp32-sdk/debug$tree -L 2  
├── bins  
├── builds  
│   └── miot.light.demo22-1  
│                └── bins  
│                        ├── bootloader.bin  
│                        ├── iflash_miot.light.demo22-1_4MB.bin    # 4M 厂包 bin 文件  
│                        ├── phy_init_data.bin  
│                        ├── upd_miot.light.demo22-1.bin    # 上传至服务器 OTA bin 文件  
│                        ├── upd_miot.light.demo22-1.elf  
│                        ├── upd_miot.light.demo22-1.map  
│                        └── xiaomi_partitions_4M.bin  
├── config_esp_sdk.sh    # 环境自动配置脚本  
├── docs  
│   ├── ESP32-WiFi模组二次开发指导文档_1.0.7_20201204175704.pdf  
│   ├── ESP-WROOM-32D(U)-xiaomi模组规格书-Rev1.3_20201204175623.pdf  
│   ├── MIoT设备开源协议接入手册.md  
│   ├── OTA  
│   ├── Protocols  
│   ├── readme.md  
│   └── WIFI_SDK_API开发指导V1.0.2_rs.pdf    # SDK API 文档  
├── esp-idf    # 乐鑫 sdk git下载后新添的目录  
├── esp-idf-patch  
│   └── 0001-add-xiaomi-configs-and-fixups.patch  
├── get-pip.py  
├── miio_project  
│   ├── build  
│   ├── components    # miio_sdk/miio_instance/miio_instance_config.h 文件中可改变 model 、版本  
│   ├── gen_default.sh    # 厂包编译脚本  
│   ├── main    # 用户扩展组件目录（用业务应用代码 main 文件夹替换，可平台自动生成），包含 设备 Spec 方法实现（SDK 本身不包含硬件驱动）  
│   ├── Makefile  
│   ├── sdkconfig  
│   └── xiaomi_partitions_4M.csv  
├── path_config.sh  
├── readme.md  
└── tools  

```

## 硬件连接

使用小米 IoT 模组开发硬件产品的固件时，请开发者使用串口线和串口转 USB 板（如 CP1202），按如下引导连接小米 IoT 模组、硬件产品 MCU 和电脑
模组资料下载：[模组页面](https://iot.mi.com/moduleBrowser.html)

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/8e885f1df068a4d6d508907618abf2cb_module_sys.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ZxyFhyZqALL8uJ2wiDcZ/iLqnIw=)

模组连接

### ESP32 模组重要的管脚说明

| 引脚           | 功能描述                                                                                                |
| -------------- | ------------------------------------------------------------------------------------------------------- |
| VDD            | 3.3V 供电 (VDD)                                                                                         |
| CHIP-EN        | 芯片使能端，正常工作外部需拉高                                                                          |
| GPIO16         | 与 MCU 主控通讯串口 RX                                                                                  |
| GPIO17         | 与 MCU 主控通讯串口 TX                                                                                  |
| GPIO0          | BOOT：外部拉低，用于 Flash 启动模式； 外部拉高，用于 Download，此时 IO7 和 IO16 上电默认功能为烧录 UART |
| **RXD0** | **log /串口下载 RX**                                                                              |
| **TXD0** | **串口下载 TX**                                                                                   |

ESP32 模组管脚说明

### 模组调试 log 打印

1. 硬件接线方法：

   ![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/5c90055f2fb4209efc777a1cd93c76ea_1684208825576.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=9V1vrSTj/VpfK9r+MqJnA2z46OM=)

   硬件接线
2. 设置串口参数：波特率:115200，数据位:8，奇偶校验: None，停止位: 1，注意：RTS/CTS 不要选

> **说明：**
>
> MTDI 应保持低电平；焊接 P\_GND 时，请使用适量的焊锡膏（该引脚可不焊接在底板上），有关电源功能相关的详细说明请参见模组[“规格书”](/v2/new/doc/introduction/knowledge/select_module#%E7%94%B3%E8%AF%B7%E4%B8%8E%E9%87%87%E8%B4%AD)。

## 运行 Demo 程序

借助小米 IoT 平台提供的 Demo 程序，开发者可快速了解使用 Wi-Fi SDK 将硬件产品接入小米 IoT 平台的方法，快速开发出功能完善的硬件产品。

> **说明：**
>
> 有关硬件产品功能开发的详细说明，请参见[功能开发](/v2/new/doc/embedded-dev/overview_fw_dev)。

**固件编译**

bash

```
cd MIoT-ESP32-SDK/debug/miio_project/  
./gen_default.sh                     # 全编译  
make flash                           # python 直接烧录，注意加载串口和进入 boot 模式  

```

**配置 model 和程序版本号**

在 `$MIIO_SDK_DIR/miio_project/components/miio_sdk/miio_instance/miio_instance_config.h` 中，包含以下

宏定义：

c

```
#define MIIO_INSTANCE_MODEL         "miot.light.demo22"  
#define MIBLE_PRODUCT_ID            14896    // 填入与model对应的蓝牙PID->发现设备  
#define MIIO_APP_VERSION_NUMBER     0001  

```

根据规则修改 `MIIO_INSTANCE_MODEL` 与 `MIIO_APP_VERSION_NUMBER` 即可完成产品的 model 和程序版本号配置。

**更改 log 打印级别**

通过 `/miot-esp32-sdk/debug/miio_project/Makefile` 宏配置开启 OT debug 级别日志 `MIIO_LOG_LEVEL=0`，默认关闭 OT 日志打印

c

```
CFLAGS := -D MIIO_LOG_LEVEL=0    // 表示关闭LOG打印MIIO_LOG_LEVEL=5  
  
#define LOG_LEVEL_VERBOSE                  0  
#define LOG_LEVEL_INFO                     1  
#define LOG_LEVEL_WARNING                  2  
#define LOG_LEVEL_ERROR                    3  
#define LOG_LEVEL_FATAL                    4  
#define LOG_LEVEL_OFF                      5  

```

> **说明：**
> 有关产品 model、PID 和固件版本的详细说明，请参见小米 IoT 开发者平台使用文档[创建产品](/v2/new/doc/configuration/create)。

### 模组烧录

烧录需要复位模组同时按下 GPIO0 进入 Boot 模式

* 方式 1.编译在 `$MIIO_SDK_DIR/miio_project/`  执行 `gen_default.sh` 全编译，加载串口再使用 `make flash` 对 ttyUSB0 进行烧录
* 方式 2.使用 Windows 工具烧录, [flash\_download\_tool 工具链接](https://www.espressif.com.cn/sites/default/files/tools/flash_download_tool_3.9.4_0.zip)

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/85097c473a5a76f44eb4fea8a3ac3caa_fw_upgrad.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=BTn6ulSd6Uw/XN7KKqkEt4m1DGE=)

下载设置与串口输出

> **注意：**
>
> 出现 "Efuse check fail" 错误需要设置：把烧录工具先关掉，参考下面图片在 `flash_download_tool_vx.x.x\configure\esp32\spi_download.conf` 文件中，把配置改成 `efuse_err_halt = 0` 然后重新打开烧录工具即可正常使用。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/aeba7bb3cae2a5210db2c75cec044a9b_tool_setting.jpg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=FPhgN3RvLU3IxAqSHAvPGI/JE9s=)

工具设置

**查看打印信息**

**重启设备** 串口工具输出下面信息：

bash

```
_|      _|  _|_|_|  _|_|_|    _|_|  
_|_|  _|_|    _|      _|    _|    _|  
_|  _|  _|    _|      _|    _|    _|  
_|      _|    _|      _|    _|    _|  
_|      _|  _|_|_|  _|_|_|    _|_|  
JENKINS BUILD NUMBER: N/A  
BUILD TIME: Oct 28 2022,08:45:36  
BUILT BY: N/A  
MIIO APP VER: 2.2.6                     // Wi-Fi Version  
MIIO MCU VER:  
MIIO DID: 313397xxx                     // DID：device ID  
MIIO WIFI MAC: 5ce50c9bxxx  
MIIO MODEL: miot.light.demo22           // Model  
ARCH TYPE: esp32,0x0000a601             // 芯片平台  
ARCH VER: 61d9af5fc  
FLASH INFO: manufacturer(0x68), memory type(0x40), capacity(0x16)  

```

重要信息说明：`MIIO APP VER: 2.2.6` 代表模组固件版本是 2.2.6
`MIIO MODEL: miot.light.demo22` 代表产品的 model
`MIIO DID: 313397xxx` 是 DID Device ID，由小米平台发放

#### Wi-Fi INC SDK 开发

*Error processing page: Message:
Stacktrace:
	GetHandleVerifier [0x0055D933+25811]
	(No symbol) [0x004EE314]
	(No symbol) [0x003E2523]
	(No symbol) [0x00427483]
	(No symbol) [0x0042765B]
	(No symbol) [0x00466BA2]
	(No symbol) [0x0044AD74]
	(No symbol) [0x004646F0]
	(No symbol) [0x0044AAC6]
	(No symbol) [0x0041BEFD]
	(No symbol) [0x0041C8FD]
	GetHandleVerifier [0x0082F143+2981091]
	GetHandleVerifier [0x00882FF9+3324825]
	GetHandleVerifier [0x005EB32F+605903]
	GetHandleVerifier [0x005F2CBC+637020]
	(No symbol) [0x004F6F4D]
	(No symbol) [0x004F3DD8]
	(No symbol) [0x004F3F75]
	(No symbol) [0x004E6406]
	BaseThreadInitThunk [0x76DAFCC9+25]
	RtlGetAppContainerNamedObjectPath [0x76F282AE+286]
	RtlGetAppContainerNamedObjectPath [0x76F2827E+238]
*

#### Linux OT SDK 开发

*Error processing page: Message:
Stacktrace:
	GetHandleVerifier [0x0055D933+25811]
	(No symbol) [0x004EE314]
	(No symbol) [0x003E2523]
	(No symbol) [0x00427483]
	(No symbol) [0x0042765B]
	(No symbol) [0x00466BA2]
	(No symbol) [0x0044AD74]
	(No symbol) [0x004646F0]
	(No symbol) [0x0044AAC6]
	(No symbol) [0x0041BEFD]
	(No symbol) [0x0041C8FD]
	GetHandleVerifier [0x0082F143+2981091]
	GetHandleVerifier [0x00882FF9+3324825]
	GetHandleVerifier [0x005EB32F+605903]
	GetHandleVerifier [0x005F2CBC+637020]
	(No symbol) [0x004F6F4D]
	(No symbol) [0x004F3DD8]
	(No symbol) [0x004F3F75]
	(No symbol) [0x004E6406]
	BaseThreadInitThunk [0x76DAFCC9+25]
	RtlGetAppContainerNamedObjectPath [0x76F282AE+286]
	RtlGetAppContainerNamedObjectPath [0x76F2827E+238]
*

#### BLE SDK 开发

# 开发准备

更新时间：2024/07/04

> **说明：**
>
> * 在进行 BLE 设备固件开发前，建议先参考 [BLE 基础知识](/v2/new/doc/introduction/knowledge/ble_basic)文档，熟悉米家 BLE 设备的基本原理。
> * 新品开发时，请务必下载**当前最新版本** **SDK** 开发固件。

## 获取 SDK

SDK 列表 -->申请 -->clone

| 芯片平台   | RTL8762C                                                                                  | EFR32BG21                                                                                    | EFR32BG22                                                                                      | TLSR825x/827x                                                                                  | TLSR921x/951x                                                                                | BK3633                                                                            | LE502x                                                                              | NRF52840                                                                                   | NRF52832                                                                                   | HS6621C                                                                               | OM6621P                                                                               | GR5525                                                                            | BES2600Z                                                                                |
| ---------- | ----------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| 封装       | MHCB05P(23.5\*13) MHCB06P(26\*16.5) MHCB07P(13.5\*12) QFN48(6\*6) QFN40(5\*5) QFN32(5\*5) | MHCB08P(22\*16) QFN32(4\*4)                                                                  | MHCB09P(14\*11) QFN40(5\*5) QFN32(4\*4)                                                        | QFN48(7\*7) QFN32(5\*5) QFN24(4\*4)                                                            | QFN80(9\*9) QFN64(8\*8) QFN56(7\*7) QFN48(6\*6) QFN40(6\*4)                                  | QFN48(6\*6) QFN40(5\*5) QFN32(5\*5)                                               | QFN48(6\*6) QFN32(4\*4) SOP24(8.7\*6) SOP16(10\*6)                                  | BGA73(7\*7) QFN48(6\*6) WLCSP(3.5\*3.6)                                                    | QFN48(6\*6) WLCSP(3.5\*3.6)                                                                | QFN48(6\*6) QFN32(4\*4)                                                               | QFN64(8\*8) QFN48(6\*6) BGA76(3.5\*5)                                                 | QFN68(7.0\*7.0\*0.85)                                                             | BGA108(3.6\*6.7)                                                                        |
| CPU        | Cotex-M4F 40MHz                                                                           | Cotex-M33 80MHz                                                                              | Cotex-M33 76.8MHz                                                                              | RISC 48MHz                                                                                     | RISC-V 96MHz                                                                                 | ARM968E-S 80MHz                                                                   | Cotex-M0 64MHz                                                                      | Cotex-M4F 64MHz                                                                            | Cotex-M4F 64MHz                                                                            | Cotex-M4F 64MHz                                                                       | Cotex-M4F 128MHz                                                                      | Cotex-M4F 96MHz                                                                   | Cotex-M33 300MHz                                                                        |
| RAM        | 160K                                                                                      | 64K                                                                                          | 32K                                                                                            | 32K/48K/64K                                                                                    | 256K                                                                                         | 80K                                                                               | 64K                                                                                 | 256K                                                                                       | 64K                                                                                        | 64K                                                                                   | 392K                                                                                  | 256K                                                                              | 1.8M                                                                                    |
| FLASH      | 512K                                                                                      | 512K/1M                                                                                      | 512K                                                                                           | 256K/512K/1M                                                                                   | 1M/2M/4M                                                                                     | 512K                                                                              | 512K                                                                                | 1M                                                                                         | 512K                                                                                       | 512K/1M                                                                               | 1M/2M                                                                                 | 1M                                                                                | 4M                                                                                      |
| GPIO       | - 小米模组：up to 25 - 单芯片：up to 33                                                   | up to 20                                                                                     | - 小米模组：up to 18 - 单芯片：up to 26                                                        | up to 32                                                                                       | up to 40                                                                                     | up to 32                                                                          | up to 34                                                                            | up to 48                                                                                   | up to 32                                                                                   | up to 32                                                                              | up to 50                                                                              | up to 50                                                                          | up to 28                                                                                |
| 通信标准   | Bluetooth LE 5.0                                                                          | Bluetooth LE 5.1                                                                             | Bluetooth LE 5.2                                                                               | Bluetooth LE 5.0                                                                               | Bluetooth Classic+LE 5.2                                                                     | Bluetooth LE 5.2                                                                  | Bluetooth LE 5.1                                                                    | Bluetooth LE 5.3                                                                           | Bluetooth LE 5.3                                                                           | Bluetooth LE 5.1                                                                      | Bluetooth LE 5.1                                                                      | Bluetooth LE 5.3                                                                  | Bluetooth Classic+LE 5.3                                                                |
| TX最大功率 | 7.5dbm                                                                                    | 20dbm                                                                                        | 8dbm                                                                                           | 10dbm                                                                                          | 10dbm                                                                                        | 10dbm                                                                             | 12dbm                                                                               | 8dbm                                                                                       | 4dbm                                                                                       | 9dbm                                                                                  | 9dbm                                                                                  | 7dbm                                                                              | 12dbm                                                                                   |
| RX@1Mbps   | -97dbm                                                                                    | -97.5dbm                                                                                     | -99dbm                                                                                         | -96dbm                                                                                         | -96dbm                                                                                       | -96dbm                                                                            | -99.7dbm                                                                            | -95dbm                                                                                     | -96dbm                                                                                     | -96.5dbm                                                                              | -96dbm                                                                                | -97dbm                                                                            | -98dbm                                                                                  |
| 功耗       | - 休眠 3uA - 唤醒 57.5uA/MHz - TX 7.9mA@0dbm - RX 7.3mA                                   | - 休眠 5uA - 唤醒 50.9uA/MHz - TX 9.3mA@0dbm - RX 8.8mA                                      | - 休眠 2uA - 唤醒 27uA/MHz - TX 4.1mA@0dbm - RX 3.6mA                                          | - 休眠 3.5uA - 唤醒 70uA/MHz - TX 4.8mA@0dbm - RX 5.3mA                                        | - 休眠 50uA - 唤醒 50uA/MHz - TX 5.5mA@0dbm - RX 5mA                                         | - 休眠 15uA - 唤醒 140uA/MHz - TX 6.1mA@0dbm - RX 5.5mA                           | - 休眠 13uA - 唤醒 70uA/MHz - TX 4.3mA@0dbm - RX 4.5mA                              | - 休眠 3uA - 唤醒 51.6uA/MHz - TX 6.4mA@0dbm - RX 6.3mA                                    | - 休眠 2uA - 唤醒 57.8uA/MHz - TX 5.3mA@0dbm - RX 5.4mA                                    | - 休眠 6.1uA - 唤醒 62.5uA/MHz - TX 6.5mA@0dbm - RX 6.4mA                             | - 休眠 5.8uA - 唤醒 60uA/MHz - TX 6.4mA@0dbm - RX 6.8mA                               | - 休眠 5.21uA - 唤醒 53uA/MHz - TX 6.5mA@0dbm - RX 5.4mA                          | - 休眠 5uA - 唤醒 50uA/MHz - TX 26mA@0dbm - RX 18mA                                     |
| 应用       | - 蓝牙直连 - 蓝牙Mesh - 传感器 - 遥控器 - 门锁                                            | - 蓝牙直连 - 传感器 - 门锁                                                                   | - 蓝牙直连 - 蓝牙Mesh低功耗 - 传感器                                                           | - 蓝牙直连 - 传感器 - 遥控器                                                                   | - 蓝牙直连 - 经典蓝牙                                                                        | - 蓝牙直连                                                                        | - 蓝牙直连                                                                          | - 蓝牙直连 - 传感器 - 门锁                                                                 | - 蓝牙直连 - 传感器 - 门锁                                                                 | - 蓝牙直连                                                                            | - 蓝牙直连 - 传感器                                                                   | - 门锁                                                                            | - 蓝牙直连 - 经典蓝牙 - 音频                                                            |
| 用户资源   | - RAM: 50K - FLASH: 140K                                                                  | - RAM: 32K - FLASH: 100K                                                                     | - RAM: 4K - FLASH: 100K                                                                        | - RAM: 4K (@32K) - FLASH:   100K (@512K)   360K(@1M)                                           | - RAM: 200K - FLASH:   320K(@1M)                                                             | - RAM: 40K - FLASH: 50K                                                           | - RAM: 35K - FLASH: 50K                                                             | - RAM: 220K - FLASH: 390K                                                                  | - RAM: 32K - FLASH: 110K                                                                   | - RAM: 26K - FLASH: 310K(@1M)                                                         | - RAM: 300K - FLASH: 400K                                                             | - RAM: 190K - FLASH: 800K                                                         | - RAM: 30K - FLASH: 1.4M                                                                |
| 仓库分支   | [realtek](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_mesh/-/tree/realtek)         | [silabs\_xG2](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/silabs_xG2) | [silabs\_BG22](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/silabs_BG22) | [telink\_825x](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/telink_825x) | [telink\_b91](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/telink_b91) | [beken](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/beken) | [le502x](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/le502x) | [nordic\_v2](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/nordic_v2) | [nordic\_v2](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/nordic_v2) | [hs6621c](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/hs6621c) | [om6621p](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/hs6621p) | [gr5525](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_secure/-/tree/GR5525) | [bes2600z](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_standard/-/tree/bes2600z) |

> **注意：**
>
> * 使用标准 BLE 协议将硬件产品接入小米 IoT 平台时，可根据实际的使用需要选择使用**小米模组**或**单芯片 SDK** 的方式，如使用 BLE 单芯片方式接入，MAC 需使用 Public 地址且保证唯一，MAC 可向芯片原厂或 IEEE 购买。由 MAC 重复造成的设备异常问题，请厂商自行解决！

## 环境搭建

参考工程目录下 README.md

## 软件架构

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/ab901628d94912bdfbffa2674c98a022_ID_13.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=ETWxBZExQmiSJ/gmV2hDgjndI20=)

软件架构

开发者应用开发在米家 BLE 应用层之上，调用米家 lib 封装的 user API 接口，常用接口基本都在 `miio_user_api.h` 文件中。

#### BLE Mesh SDK 开发

# 开发准备

更新时间：2023/12/19

为了帮助开发者深入了解 BLE Mesh 产品接入的过程、方法和注意事项，小米 IoT 平台提供了[公开课](/v2/new/doc/resources-and-services/open-classes)，开发者可在接入 BLE Mesh 产品前，通过公开课了解 BLE Mesh 产品接入的过程、方法和注意事项，高效地将产品接入小米 IoT 平台。

> **说明：**
>
> * 在进行 BLE Mesh 设备固件开发前，建议先参考 [BLE Mesh 基础知识](/v2/new/doc/introduction/knowledge/mesh_basic)文档，熟悉米家 BLE Mesh 设备的基本原理。
> * 新品开发时，请务必下载**最新版本** **SDK** 开发固件。

## 获取 BLE Mesh SDK

在获取 BLE Mesh SDK 前，开发者需先申请 BLE Mesh SDK 等开发资源，并按照各分支下 README 中的内容，在配置 SSH Key 后，使用 git 命令在本地环境(Windows)下载相应的资源。

> **说明：**
>
> 1. 小米 IoT 的 SDK 和开发资源维护在小米 GitLab 仓库中，如需获取 GitLab 账号并访问 BLE Mesh 资源，请参考文档[申请平台资源](/v2/new/doc/resources-and-services/source#%E7%AC%AC%202%20%E6%AD%A5%20-%20%E7%94%B3%E8%AF%B7%E8%B5%84%E6%BA%90%E9%A1%B9)申请；
> 2. 请在收到账号开通的短信/邮件后，及时按照短信/邮件中的说明，完成身份信息的验证（验证有效期为三天）并设置账号密码，此外，在登录小米 GitLab 时，请选择使用“短信验证码登录”，无需使用小米人 App 登录；
> 3. 小米 IoT 平台提供的 BLE Mesh SDK 中的 src 文件夹提供了芯片各个外设的 demo，若对外设驱动程序有疑问，请咨询芯片原厂。

## 快速开始

> **注意：**
>
> 下面相关指导文档放置在 SDK 仓库中，如要查看请先申请 [SDK 仓库权限](https://iot.mi.com/fe-op/manageCenter/projectApply/index)

### 使用 Realtek 系列模组

[RTL8762 模组快速开始指导.pdf](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_mesh/-/blob/realtek/UserGuide/QSG1101-RTL8762C%E6%A8%A1%E7%BB%84%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B%E6%8C%87%E5%AF%BC.pdf)

### 使用 Silabs 系列模组

[EFR32XGXX 模组快速开始指导.pdf](https://partner-gitlab.mioffice.cn/miot/bsp/mijia_ble_mesh/-/blob/silabs_BG22/UserGuide/EFR32XGXX%E6%A8%A1%E7%BB%84%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B%E6%8C%87%E5%AF%BC.pdf)

### 扩展程序开发

#### 快速入门

# 扩展程序快速入门

更新时间：2024/11/06

米家扩展程序，又称米家 App 插件，是由各接入厂商开发的，在米家 App 中用于查看硬件产品实时信息和控制硬件产品的子程序。

在米家 App 设备页面，点击设备宫格进入到的设备控制界面即是扩展程序界面。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/6cdd1308fe5f553929102aeabd891875_1689736244072.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=PCDXe9B48we+DMyen0DUwi49GKw=)

米家扩展程序展示

扩展程序使用 JavaScript 语言进行编写，使用 [ReactNative](https://www.reactnative.dev/) 框架（以下简称 RN）。

扩展程序按照开发方式的不同，可分为以下两种：

1. 标准扩展程序

部分成熟品类的产品可直接使用小米 IoT 平台提供的标准扩展程序。**无需自行开发扩展程序**即可方便的控制设备。具体可开通的品类和开通方式，请咨询米家产品经理。

2. 自定义扩展程序

开发者自行开发的扩展程序。不同于标准扩展程序的品类限制，所有的品类都可以开发自定义扩展程序来进行控制设备。开发者在遵循平台规范的前提下，可以自行决定扩展程序的 UI 界面外观、字体样式、功能逻辑等。对比标准扩展程序来说，自定义扩展程序自主性更强，可以更好的满足开发者的个性化需求。

## 开发扩展程序

> **注意：**
>
> 1. 由于标准扩展程序无需开发者进行开发，以下扩展程序开发内容均指自定义扩展程序开发
> 2. 请确保开发者的小米帐号在企业中的角色是[**开发人员**](/v2/new/doc/configuration/signin#%E5%8A%A0%E5%85%A5%E5%B7%B2%E6%9C%89%E4%BC%81%E4%B8%9A%E7%BB%84)

开发需要在 [SDK 框架](https://github.com/MiEcosystem/miot-plugin-sdk)下开发扩展程序。扩展程序的 Native 部分由米家 App 提供，并使用 SDK 框架进行桥接，通过 SDK 向开发者进行接口暴露。

故开发者仅需要使用 JavaScript 语言，调用 SDK 或 RN 提供的接口进行开发，不需要开发 Native 部分的功能。

### 环境配置

#### 安装 NodeJS

前往 [NodeJS 官网](https://nodejs.org/en)下载安装，推荐 LTS 版本。要求 NodeJS 版本 >= 12.13.1，npm 版本 >= 6.12.1。

安装之后使用以下命令验证是否安装成功：

bash

```
node -v  
npm -v  

```

#### 设置 npm 淘宝镜像（可选）

由于大部分依赖都位于国外服务器，可能会导致 SDK 依赖下载缓慢等问题。

建议开发者设置淘宝镜像以加快依赖下载速度：

bash

```
npm config set registry https://registry.npmmirror.com  

```

如需**取消淘宝镜像**，设置回官方源，请使用：

bash

```
npm config set registry https://registry.npmjs.org  

```

#### 获取扩展程序 SDK

插件调用 Native 的部分功能都需要 [SDK](https://github.com/MiEcosystem/miot-plugin-sdk) 进行处理，可以安装使用 [git](https://git-scm.com/) 克隆仓库：

bash

```
git clone https://github.com/MiEcosystem/miot-plugin-sdk.git  

```

> **说明：**
>
> 扩展程序无法在 master 分支下进行开发，请切换到其它分支进行开发

选择 SDK 版本（将下面的 `${SDK_VERSION}` 替换成你选择的版本号）进行开发：

bash

```
# 比如：git checkout SDK_10083  
git checkout SDK_${SDK_VERSION}  

```

如果不想使用 git，可访问 [https://github.com/MiEcosystem/miot-plugin-sdk](https://github.com/MiEcosystem/miot-plugin-sdk) 选择 SDK 版本后直接下载 zip 压缩文件。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/6d8c0668c5c3eb7ec3ca2b29b21957c2_branches.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=eVAkAvbcyslH1UTKauWghtg9D/c=)

选择 SDK 版本

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/48befcd8bdfc4530f76fb56eb55e6035_download.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=g/B/94moKhqksbMZAYPVQarZ674=)

下载压缩包

下载完成后解压即可。

#### 安装 SDK 依赖

切换到 SDK 文件夹进行安装：

bash

```
cd miot-plugin-sdk  
npm install --legacy-peer-deps  

```

> **说明：**
>
> 1. 如果使用 npm 安装报错，可尝试 **设置 npm 淘宝镜像** 或使用搜索引擎搜索解决方案;
> 2. 如果还是没法安装，可以手动下载依赖：
>
>    2.1 删除项目 `miot-plugin-sdk` 根目录下的 `node_modules` 文件夹和 `package-lock.json` 文件;
>
>    2.2 [访问此地址](https://kpan.mioffice.cn/webfolder/ext/En2oHYEhI6c%40)下载 `node_modules` 依赖压缩包；
>
>    2.3 解压缩上面下载的 `.zip` 文件到项目 `miot-plugin-sdk` 根目录后再次执行 `npm install` 即可。

#### 下载调试版本 App

要想直接[调试扩展程序](/v2/new/doc/plugin/quickstart/plugin-dev#%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95)，需要使用手机下载安装
[调试版本 App](https://github.com/MiEcosystem/miot-plugin-sdk#%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83)，不能使用应用市场上安装的米家 App。

### 创建项目

本质上，扩展程序项目是 SDK 的一个 `nodejs` 子项目。开发者只需要参考[扩展程序开发](/v2/new/doc/plugin/quickstart/plugin-dev#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE)一文内容在 `./miot-plugin-sdk/projects/` 文件夹下正常创建项目即可。

在 `projects` 目录下，已经包含了一些示例项目，开发者可以直接运行查看运行效果。

以下内容将使用 `projects` 目录下的 `com.xiaomi.demo` 项目作演示。

### 运行调试

开发者在创建开发项目后，可以直接运行调试，并实时查看变更效果（下图左一）：

找到要运行的项目文件夹名称，比如 `com.xiaomi.demo` :

bash

```
cd miot-plugin-sdk  
npm start com.xiaomi.demo  

```

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/b49407ab32f8d234960d4d726c9b705a_node_server.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=1Vx0O4dxC0OueHC4283Oy4Xo1/g=)

控制台命令及二维码

在控制台上可以看到调试二维码（上图右一），保持手机 Wi-Fi 和电脑处于同一个内网环境。

使用[调试 App](https://github.com/MiEcosystem/miot-plugin-sdk#%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83)
点击右上角 + 号，扫一扫控制台二维码开启调试模式。

然后在设备列表中点击需要调试的设备即可直接调试设备。

有关扩展程序调试与测试的详细内容，请参考[开发调试](/v2/new/doc/plugin/quickstart/plugin-dev#%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95)。

> **说明：**
>
> 1. 由于生成的二维码较大，可能需要将控制台窗口全屏才能正确显示二维码；
> 2. 如果不方便绑定调试真实设备，可以先使用[虚拟设备](/v2/new/doc/plugin/quickstart/plugin-dev#%E8%99%9A%E6%8B%9F%E8%AE%BE%E5%A4%87%E8%B0%83%E8%AF%95)进行扩展程序的 UI 调试工作。

### 打包上传

开发调试完成后，可将扩展程序打包上传到开发者平台供白名单用户测试。

bash

```
cd miot-plugin-sdk  
npm run publish com.xiaomi.demo  

```

如无错误，打包文件将存放在：

bash

```
/miot-plugin-sdk/projects/com.xiaomi.demo/build/publish.mpkg  

```

登录[开发者平台后台](https://iot.mi.com)，前往控制台 - 产品 - 扩展程序开发 - 新建版本，上传刚刚打包的 `.mpkg` 文件。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/2c13486e3c38d365a6ee0069ca7d0ea4_1730708916492.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fdvgHZmPwHGvfZXgsoSHDbFK9WA=)

新建版本

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/6e083389d935db6ecdb9d15a3a473b05_1730708936989.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=f0zyk6Ky4wstH4dHYNmUdDRVjc8=)

上传扩展程序

等待右侧**打包中**变为可看到**开启测试**按钮后，点击开启测试使该扩展程序进入测试中状态。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/63ab936d17d1c7c61a115808b1f6d802_1730708963153.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=O6qF60nHLg44H2cRZX8vdUPz0iI=)

开启测试

等待约半小时后，可联系其他**白名单用户**使用正式版本或调试版本的米家 App 绑定设备并测试扩展程序。

#### 扩展程序基本功能开发

# 基础信息

更新时间：2024/01/02

扩展程序 SDK 内封装了大量包括但不限于获取手机基础信息（手机型号、手机网络等）、硬件设备基础信息（[did](/v2/new/doc/introduction/knowledge/explanation#DID)、是否是共享设备等）及用户帐号基础信息等接口。

## 获取帐号信息

在开发扩展程序时，开发者可获取用户的[账号信息](https://github.com/MiEcosystem/miot-plugin-sdk/wiki/09-%E8%B4%A6%E6%88%B7%E6%A8%A1%E5%9D%97)。其中包含当前账号信息、指定账号信息和批量账号信息等。

> **说明：**
>
> 目前米家扩展程序 SDK 暂时没有提供账号信息修改和删除的功能。

比如获取当前登录米家 App 的用户信息：

javascript

```
import { Service } from 'miot';  
import logger from './logger';  
  
// 用户 ID（uid）可以直接获取  
logger.i('account id: ', Service.account.ID);  
  
// 如果想获取到用户的详细信息，需要预先加载一次  
if (Service.account.isLoaded) {  
  logger.i('nickName: ', Service.account.nickName);  
} else {  
  Service.account  
    .load()  
    .then((account) => {  
      logger.i('load account nickName: ', account.nickName);  
    })  
    .catch((err) => {  
      logger.e('load account error: ', err);  
    });  
}  

```

如果是共享设备，可通过如下方式获取设备拥有者的 id:

javascript

```
import { Device, Service } from 'miot';  
  
let ownerId = Device.ownerId || Device.owner?.ID;  
  
export async function getOwnerId() {  
  if (Device.isOwner) return Service.account.ID;  
  if (!ownerId) {  
    ownerId = (await Device.owner?.load?.())?.ID;  
  }  
  return ownerId;  
}  

```

## 获取手机或米家 App 信息

通过 [Package](https://github.com/MiEcosystem/miot-plugin-sdk/wiki/08-%E6%8F%92%E4%BB%B6%E5%AF%BC%E8%88%AA%E6%A8%A1%E5%9D%97) 或 [Host](https://github.com/MiEcosystem/miot-plugin-sdk/wiki/01-%E5%8E%9F%E7%94%9F%E6%A8%A1%E5%9D%97) 中的相关对象获取扩展程序相关的信息。如米家 App 的版本、平台类型（iOS 或 Android）、App 的版本号和本地化设置等。

详情可参考 [Demo 程序](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/projects/com.xiaomi.demo/Main/tutorial/PackageDemo.js)。

## 调用手机系统功能

React Native 框架提供了不少调用手机系统功能的接口。为了提升用户使用扩展程序时的体验，扩展程序 SDK 在此基础上提供了获取用户移动终端系统中如罗盘、扫码和震动等信息和功能的接口。开发者可根据功能实现的实际需要选择使用相应的接口。

下表是 SDK 内各系统能力接口实现文件：

|                                                                                                              |                                                                                                               |                                                                                                          |                                                                                                                      |                                                                                                                       |
| ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| [电量(battery.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/battery.js)       | [蓝牙(bluetooth.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/SDK_10074/miot-sdk/system/bluetooth.js) | [音量(volume.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/volume.js)     | [加速计(accelerometer.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/accelerometer.js) | [罗盘(compass.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/compass.js)                |
| [陀螺仪(gyroscope.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/gyroscope.js) | [性能(memory.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/memory.js)          | [扫码(scancode.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/scancode.js) | [震动(vibrate.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/vibrate.js)               | [语音/相机权限(permission.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/permission.js) |
| [定位(location.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/location.js)     | [网络(network.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/network.js)        | [摇一摇(shake.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/shake.js)     | [iOS 健康(health.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/SDK_10078/miot-sdk/system/health.js)          | [nfc(nfc.js)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/miot-sdk/system/nfc.js)                         |

系统能力接口

> **说明：**
>
> 部分系统能力的方法还放在 [Host](https://github.com/MiEcosystem/miot-plugin-sdk/tree/master/miot-sdk/host) 模块下，后续会逐渐迁移到 [System](https://github.com/MiEcosystem/miot-plugin-sdk/tree/master/miot-sdk/system) 模块下。

React Native 能力相关参考：

1. 使用 [react-native-netinfo](https://github.com/react-native-netinfo/react-native-netinfo) 监听网络状态
2. 使用终端系统中的 [Geolocation](https://github.com/michalchudziak/react-native-geolocation) 获取手机地理位置信息

#### API + Demo

# 扩展程序概述

更新时间：2024/07/15

## 加载机制

在用户点击米家 App 中的设备图标后，米家 App 会自动获取扩展程序下载地址，并加载当前支持的最新版本的扩展程序。

具体加载流程见下图：

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/bd89c06c5eb81f8f62111cba2403bb70_1689749150875.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=oAO/DG6GgnuUY8q8HPSGuuWrCaI=)

加载机制

## 生命周期

扩展程序基于 RN 框架，故所有 Class 组件都能使用 `React.Component` 的生命周期。开发者可以正常使用 React 中的组件级别生命周期。

需要注意的是，在扩展程序中，如果开发者调用 `Package.exit()` 函数来退出扩展程序，将直接退出扩展程序，可能不会回调组件的 `componentWillUnmount` 函数。

为了帮助开发者管理扩展程序的生命周期，开发者可使用 `PackageEvent` 中的事件，在扩展程序即将加载、加载完成及即将退出等六个时间点管理扩展程序。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/7d13322fe466828b2990ae2d4c752a7a_1689751308158.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=UCqUOxMb76kF6OHIj0vMMAbHTh4=)

生命周期

## 原生差异

由于 Android 和 iOS 原生部分由各端进行开发实现。在实际使用 SDK 过程中，可能会略有差异，具体可以在使用 SDK API 的时候查看源代码处的注释。

## 扩展程序 SDK

开发者需要使用扩展程序 SDK 和 RN 框架提供的 API 来完成扩展程序的开发。

1. RN 框架

对于 RN 框架的使用，米家扩展程序使用 React Native 的版本为：`0.61.0`。开发者可以自行前往 [RN 官方文档](https://reactnative-archive-august-2023.netlify.app/docs/0.61/getting-started)
找到对应的版本学习查看如何使用。

2. 米家扩展程序 SDK

[米家扩展程序 SDK](https://github.com/MiEcosystem/miot-plugin-sdk) 是小米 IoT 平台提供给开发者用于开发扩展程序的专用 SDK。扩展程序的 Native（原生）部分由米家 App 提供，并使用 SDK 框架进行桥接，通过 SDK 向开发者进行接口暴露。故开发者仅需要使用 JavaScript 语言，调用 SDK 或 RN 提供的接口进行开发，不需要开发 Native 部分的功能。

## SDK 版本

SDK 目前在不断迭代更新，用于新增功能和漏洞修复。

SDK 版本号越高，其提供的功能越丰富，漏洞越少。但由于 SDK 是内置于米家 App 内部的，对于使用版本号过高的 SDK 开发的扩展程序，可能会使得使用低版本的米家 App 无法加载插件。

故开发者在开发扩展程序的时候，需要选择合适的 SDK 版本进行开发。

SDK 已发布后，会在此地址进行更新：[https://github.com/MiEcosystem/miot-plugin-sdk/releases](https://github.com/MiEcosystem/miot-plugin-sdk/releases)

对于带有 `Pre-release` 标签的版本为预发布版本，请尽量不要选择此版本。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/8c602337de0413c63c5443952a56601a_1685351092520.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=z10Zj+NSL7sHm6Bq9Ye8UEkyYz0=)

预发布版本

对于选择 SDK 版本后，切换到对应的分支后即完成了 SDK 版本切换。

比如切换到 `10080` 版本 SDK，需要切换到 `SDK_10080` 分支：

bash

```
git checkout SDK_10080  

```

## 目录结构

bash

```
├── 示例图片  
├── babel.config.js                # babel 配置  
├── bin                            # 运行脚本  
├── doc-md                         # 文档  
├── eslint-mihome-plugin           # eslint 配置        
├── metro.config.js                # metro 配置  
├── miot-sdk                       # SDK 主目录  
│   ├── Account.js                     # 账号管理  
│   ├── Bluetooth.js                   # 蓝牙/BLE Spec  
│   ├── ClassicBluetooth.js            # 经典蓝牙（老设备）  
│   ├── darkmode                       # 深色模式  
│   ├── device                         # 设备/Spec/网络  
│   ├── Device.js                      # device 目录导出  
│   ├── hooks                          # 封装的 hooks  
│   ├── host                           # 原生模块  
│   ├── Host.js                        # host 目录导出  
│   ├── index.js                       # SDK 导出  
│   ├── Package.js                     # 插件框架  
│   ├── package.json                   # SDK 项目 package.json 文件  
│   ├── Properties.js                  # 设备属性集合的本地缓存工具类  
│   ├── resources                      # 资源（字符串/图片/样式）  
│   ├── sdkContext                     # SDK Context（theme、i18n）  
│   ├── service                        # 服务端能力  
│   ├── Service.js                     # service 目录导出  
│   ├── system                         # 手机系统能力  
│   ├── ui                             # UI  
│   └── utils                          # utils 工具类  
├── package.json                   # 主项目 package.json  
├── package-lock.json              # 主项目 lock 文件  
├── projects                       # 扩展程序目录  
└── UIDocImages                    # 文档截图  

```

## API 和 DEMO

对于开发中的常见功能和 API，开发者平台将持续维护和更新文档，具体见左侧目录扩展程序功能开发部分。

但由于 SDK 功能众多，API 未能一一列出。[com.xiaomi.demo](https://github.com/MiEcosystem/miot-plugin-sdk/tree/master/projects/com.xiaomi.demo)
列出了绝大部分 API 的使用方法和效果预览。

对于未能列出的 API 的用法、DEMO 以及注释，可以在 SDK 内全局搜索。或者浏览 wiki 查看：

[https://github.com/MiEcosystem/miot-plugin-sdk/wiki](https://github.com/MiEcosystem/miot-plugin-sdk/wiki)

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/551f340ac0d46ddaad27e1831daedf54_wiki.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=cDUPlGLbj4L3aE2/hRz3w4aHPBU=)

扩展程序 wiki 文档

除提供各种原生部分的功能外，在 React Native 的基础上 SDK 还提供了一套开发扩展程序的 UI 组件。其中包含通用设置、列表组件、地图组件、对话框、选择器和摄像头音视频渲染等常用的功能，详情可参见 [UI 组件](/v2/new/doc/plugin/basic/ui-component)中的内容。

## 第三方库

开发者可根据实际的使用需求，在扩展程序项目的目录下，引入扩展程序 SDK 中已集成的第三方库。或根据实际的开发需求引入其他**纯 JS 代码**的第三方库。

### 引用 SDK 中已集成的第三方库

开发者初始化开发扩展程序的环境时，米家扩展程序 SDK 已为开发者引入常用的第三方库。开发者可以直接在项目中使用，无需再次引入这些库。

SDK 根目录 `miot-plugin-sdk` 下的 `package.json` 文件格式化之后。在其 `dependencies` 节点展示了所有 SDK 内已集成的第三方库。

### 引入纯 JS 第三方库

为了保护用户个人数据和隐私信息，提高用户使用扩展程序的体验，降低开发者维护扩展程序的成本，请开发者避免使用非扩展程序 SDK 中已集成的第三方库。

若开发者仍需使用其他第三方库，请使用纯 JS 开发的第三方库，否则打包发布时可能会导致打包失败。

bash

```
# 进入项目目录，如 com.xiaomi.demo  
cd projects/com.xiaomi.demo  
# 引用第三方库，xxxx 为第三方库的名称  
npm install --save xxxx  

```

> **注意：**
>
> 请不要使用 `cnpm` 安装 SDK 依赖和第三方库，否则会导致依赖库安装失败。如果开发者已经使用 `cnpm` 安装，请删除 `node_modules` 文件夹和 `package-lock.json` 文件。然后重新使用 `npm install` 安装。

### 一些三方库的兼容性问题

对于一些第三方库可能会有兼容性问题，大部分问题都是与 NodeJS/Npm 版本或者 React Native 层面的问题。

* 对于在安装第三方库时发生的错误，请直接通过搜索引擎来搜索处理；
* 对于在使用第三方库的过程中，由第三方库引发的 BUG，请尝试联系第三方库贡献者解决；
* 对于在开发扩展程序的过程中，发现 SDK 或者米家 App 引发的问题，请提交工单联系开发者平台处理，具体参见[工单系统](/v2/new/doc/help-support/workorder)。

下面是一些开发者使用第三方库经常遇到的问题。

#### 如何安装 native-echarts

1. 在开发者自己的项目目录，比如 `projects/com.xiaomi.demo` 中执行安装命令：

bash

```
# 不要使用 cnpm 安装  
# 如果已经使用 cnpm 安装请删除 node_modules 文件夹  
# 和 lock 文件后重新使用 npm 安装  
npm install native-echarts  

```

2. 修复 Android App 调试显示 HTML 源代码

> 此问题只影响本地调试，不影响打包后运行。

找到项目目录 `miot-plugin-sdk` 下的 `node_modules` 文件夹 `getSecurityHeadersMiddleware.js` 文件（全局搜索）。

将 `res.setHeader('X-Content-Type-Options', 'nosniff');` 注释掉重新执行 `npm start` 运行扩展程序即可。

3. echarts API

`native-echarts` 内部使用的是 `echarts` 这个库。具体如何使用请参考：[https://echarts.apache.org/zh/index.html](https://echarts.apache.org/zh/index.html)

> **注意：**
>
> [react-native-echarts](https://github.com/somonus/react-native-echarts) 由第三方提供，并非由小米 IoT 平台提供。
>
> 对于使用 react-native-echarts 过程中遇到的问题，请联系原开发者处理。

#### 组件

# UI 组件

更新时间：2023/09/22

为了提高开发者在开发扩展程序时的开发效率，米家扩展程序 SDK 基于 React Native 提供了开发扩展程序的 UI 组件。其中包含通用设置、列表组件、地图组件、对话框、选择器和摄像头音视频渲染等常用的功能。详情可参见 [API 文档](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/%E7%B1%B3%E5%AE%B6%E6%8F%92%E4%BB%B6%E9%80%9A%E7%94%A8UI%E7%BB%84%E4%BB%B6%E6%89%8B%E5%86%8C.md)中的内容。或者参考 [com.xiaomi.demo](https://github.com/MiEcosystem/miot-plugin-sdk/tree/master/projects/com.xiaomi.demo) 以查看完整的 API 示例及实际演示效果。

## 路由导航

为了管理扩展程序中的多个页面，米家扩展程序在 [react-navigation](https://reactnavigation.org/docs/2.x/api-reference) 的基础上，为开发者提供了简单易用的跨平台导航方案（导航器，navigator）。方便开发者在 iOS 和 Android 系统上实现翻页式、Tab 选项卡式和抽屉式的导航布局。

在扩展程序项目根目录 `index.js` 文件中，需要指定入口 `component` 以使扩展程序打开的时候展示 UI 界面：

javascript

```
import { Package } from "miot";  
import App from "./components/app";  
  
Package.entry(App);  

```

借助 [react-navigation](https://reactnavigation.org/docs/2.x/api-reference) 中的原生组件和 `Animated` 动画库。扩展程序不仅支持开发者自定义控制手势，还将大幅度提高扩展程序的运行性能。

以下是组件 `App` 中配置页面路由和跳转动画等操作的示例代码：

javascript

```
import React, { Component } from "react";  
import { createStackNavigator } from "react-navigation";  
import NavigationBar from "miot/ui/NavigationBar";  
import { Entrance, Package } from "miot";  
import { MoreSetting } from "miot/ui/CommonSetting";  
  
import { interpolator } from "./interpolator";  
import { routes } from "../../utils/constant";  
import MainPage from "../../pages/main";  
import SettingPage from "../../pages/setting";  
import ScenePage from "../../pages/scene";  
  
export default class App extends Component {  
    constructor(props) {  
        super(props);  
        this.initRoutes();  
    }  
  
    /**  
     * 初始化初始路由  
     */  
    initRoutes() {  
        switch (Package.entrance) {  
            case Entrance.Main:  
                this.initialRoute = routes.main;  
                break;  
                
            /**  
             * 跳转到智能场景设置页面，如果没有相关逻辑请删除这个 case。  
             *   
             * 有关如何配置智能场景设置页面，参考此文档：  
             * {@link https://iot.mi.com/v2/new/doc/plugin/other/automation-develop }  
             */  
            case Entrance.Scene:  
                this.initialRoute = routes.scene;  
                break;  
            default:  
                this.initialRoute = routes.main;  
                break;  
        }  
    }  
  
    render() {  
        const RootStack = createRootStack(this.initialRoute);  
        return <RootStack />;  
    }  
}  
  
/**  
 * 创建栈页面导航。  
 * @param {string} initialRoute 初始页面路由。  
 * @return {function} 栈页面导航。  
 */  
function createRootStack(initialRoute) {  
    return createStackNavigator(  
        {  
            [routes.main]: MainPage,  
            [routes.setting]: SettingPage,  
            [routes.moreSetting]: MoreSetting,  
            [routes.scene]: ScenePage,  
        },  
        {  
            initialRouteName: initialRoute,  
            navigationOptions: ({ navigation }) => {  
                let { titleProps, title } = navigation.state.params || {};  
                // 如果 titleProps 和 title 都为空， 则不显示页面 header 部分  
                if (!titleProps && !title) return { header: null };  
  
                // 如果 titleProps 为空， 则 title 肯定不为空， 初始化 titleProps 并赋值 title  
                if (!titleProps) {  
                    titleProps = {  
                        title: title,  
                    };  
                }  
  
                if (!titleProps.left) {  
                    titleProps.left = [  
                        {  
                            key: NavigationBar.ICON.BACK,  
                            onPress: () => {  
                                navigation.goBack();  
                            },  
                        },  
                    ];  
                }  
                return {  
                    header: <NavigationBar {...titleProps} />,  
                };  
            },  
            // 控制页面切换的动画  
            transitionConfig: () => ({  
                screenInterpolator: interpolator,  
            }),  
        }  
    );  
}  

```

### NavigationBar

米家扩展程序中的页面导航栏主要是 `NavigationBar`，开发者可根据实际的使用需要开发相应的扩展程序。

`NavigationBar` 组件中，可配置的各个属性如下：

javascript

```
({ navigation }) => {  
    return {  
        header:  
            <NavigationBar  
                // 导航栏背景色  
                backgroundColor='transparent'  
                // 导航栏类型：`NavigationBar.TYPE.DARK` 表示深色背景白色文字，`NavigationBar.TYPE.LIGHT` 相反  
                type={NavigationBar.TYPE.DARK}  
                // 左侧按钮的集合，最多显示两个，多余无效 [{ key, disable, showDot, onPress }]  
                left={[  
                  {  
                    key: NavigationBar.ICON.BACK,  
                    onPress: _ => this.props.navigation.goBack()  
                  },  
                  {  
                    key: NavigationBar.ICON.CLOSE,  
                    onPress: _ => console.log('onPress')  
                  }  
                ]}  
                // 右侧按钮的集合，最多显示两个，多余无效 [{ key, disable, showDot, onPress }]  
                right={[  
                  {  
                    key: NavigationBar.ICON.COLLECT,  
                    disable: true,  
                    onPress: _ => console.log('onPress')  
                  },  
                  {  
                    key: NavigationBar.ICON.MORE,  
                    showDot: this.state.showDot,  
                    onPress: _ => console.log('onPress')  
                  }  
                ]}  
  
                // 中间的标题  
                title='标题'  
                // 中间的标题的样式，目前支持 fontSize  
                titleStyle={{ fontSize=15 }}  
                // 中间的副标题  
                subtitle='副标题'  
                // 中间的副标题的样式，支持的属性有 fontSize, colorType 。colorType 是副标题的颜色，目前支持三种： normal '#666666', warning: '#f43f31' exception: '#f5a623'  
                subtitleStyle={{ fontSize=12 }}  
                // 点击标题的事件  
                onPressTitle={_ => console.log('onPressTitle')}  
            />  
    };  
};  
  
// titleNumberOfLines - 10040 新增 控制 title 文字的行数， 默认 1 行  
// subtitleNumberOfLines - 10040 新增 控制 subtitle 文字的行数，默认 1 行  
// allowFontScaling - 10040 新增 字体大小是否随系统大小变化而变化, 默认值为 true  

```

### 页面跳转

上面 App 组件的 `header` 中使用了 `NavigationBar`，代表扩展程序所有的页面通用此导航栏。开发者无需在具体的各个页面中，再次编写导航栏。

如果开发者想在页面中跳转到其他页面可以使用：

javascript

```
this.props.navigation.navigate(routes.setting, { title: "设置" });  

```

## 通用设置组件

为提升开发者接入效率，对于设置页面，米家扩展程序 SDK 为开发者提供了包含多种类型的[通用设置项(CommonSetting)](https://github.com/MiEcosystem/miot-plugin-sdk/blob/master/%E7%B1%B3%E5%AE%B6%E6%8F%92%E4%BB%B6%E9%80%9A%E7%94%A8UI%E7%BB%84%E4%BB%B6%E6%89%8B%E5%86%8C.md#%E7%B1%B3%E5%AE%B6%E6%8F%92%E4%BB%B6%E9%80%9A%E7%94%A8%E8%AE%BE%E7%BD%AE-CommonSetting)。

如无特殊情况，开发者都应该直接使用 `CommonSetting` 组件配置设置页面。设置页面在使用 `CommonSetting` 之后，仅需少量配置就可直接使用。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/edeb99f4b54a8df803ce36adfbc4df61_commonsetting.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=sylVM5biQJUlB44P6uMad4V1hO4=)

通用配置

在通用配置组件中，`安全设置` 项为默认显示项，默认在 `更多设置` 中。若无需使用，开发者可通过 `excludeOptions` 去除。但对于门锁和保险箱类产品，`安全设置` 必须放在一级菜单中。

有关 `CommonSetting` 的详细内容请参见 [API 文档](https://github.com/MiEcosystem/miot-plugin-sdk/wiki/03-%E9%80%9A%E7%94%A8%E8%AE%BE%E7%BD%AE)中的内容。

> **注意：**
>
> * 请开发者直接引用通用设置组件，在组件开放的配置项下进行配置。
> * 请勿复制其源代码后修改，或自行修改某个功能项的逻辑等。
> * 否则可能出现组件更新后无法同步的现象，引起的后果需开发者自行承担。

## 地图组件

扩展程序 SDK 集成了高德地图。开发者可调用相应的接口，实现显示用户位置、交通状况和指南针等功能，详情请参见[地图组件接口文档](https://github.com/MiEcosystem/miot-plugin-sdk/wiki/04-%E5%9C%B0%E5%9B%BE%E7%BB%84%E4%BB%B6)。

> **说明：**
>
> 由于使用的是高德地图，此组件不支持在海外地区使用，销售于海外地区的产品请勿使用此组件。

## 摄像头音视频渲染组件

接入了 MISS/TUTK 固件的摄像头品类产品，可使用米家扩展程序提供的组件，实现摄像头视频流显示、摄像头音频流播放、视频比例缩放等功能。详情请参见[摄像头音视频渲染组件文档](https://github.com/MiEcosystem/miot-plugin-sdk/wiki/01-%E5%B8%B8%E7%94%A8UI%E7%BB%84%E4%BB%B6)和 Demo 程序 `com.xiaomi.camera.demo`。

### 视频渲染

使用摄像头音视频渲染组件时，开发者需要配合[摄像头 P2P] 的能力。在发送 `VIDEO-START` 命令后，调用方法 `CameraRenderView` 的 `startRender()` 开始渲染视频。并在用户切换至其他页面时，调用方法 `stopRender()` 停止视频的渲染。

javascript

```
class DemoComponent extends Component {  
  render() {  
    return (  
      <CameraRenderView  
        ref="openGLViewRef"  
        style={{  
          width: 350,  
          height: (350.0 / 1920.0) * 1080.0,  
          backgroundColor: "red",  
          justifyContent: "center",  
        }}  
        videoCodec={MISSCodec.MISS_CODEC_VIDEO_H264} // video的视频格式 h264 h265  
        audioCodec={MISSCodec.MISS_CODEC_AUDIO_G711A} // 音频的格式 aac g711a  
        audioRecordSampleRate={MISSSampleRate.FLAG_AUDIO_SAMPLE_8K} // 录音时的sampleRate  
        audioRecordChannel={MISSAudioChannel.FLAG_AUDIO_CHANNEL_MONO} // 录音时的channel  
        audioRecordDataBits={MISSDataBits.FLAG_AUDIO_DATABITS_16} // 录音时的databits  
        audioRecordCodec={MISSCodec.MISS_CODEC_AUDIO_G711A} // 指令录制音频时的音频编码方式，如果没有指定，则默认与audioCodec一致。  
        correctRadius={1.2} // 用来调整直播视频帧的畸变程度的  
        osdx={0.243} // 水印区域宽度占据视频画面宽度的百分比  
        osdy={0.03964} // 水印区域高度占据视频画面高度的百分比  
        useLenCorrent={true} // 是否使用畸变纠正  
        onVideoClick={() => {}} // 单击视频时，回调给js端，让js端执行相关操作。  
        fullscreenState={true} // 当前是否是全屏  
        videoRate={1} // ios端专属  
        maximumZoomScale={3} // 最大缩放系数 android端不支持  
        minimumZoomScale={0.5} // 最小缩放系数。 android端不支持  
        scale={1} // videoview 缩放系数 双端支持。  
        recordingVideoParam={{ width: 1920, height: 1080, fps: 20 }} // 录制视频时，过滤写入到mp4文件里的视频帧宽高width && height，只有符合该分辨率的视频宽高才能写入视频文件里，  fps指定录制视频的帧率，如果不指定，默认为20帧，如果指定为-1，则按照实际收到视频帧的时间把视频帧插入mp4视频文件里  
        whiteBackground={false} // videoView是否使用白色背景  
      />  
    );  
  }  
  
  renderViewCommands() {  
    this.refs.openGLViewRef.startRender(); // 开始渲染视频，米家APP收到视频帧后会通过该组件解码渲染视频，发送video-start or playback 指令后调用  
    this.refs.openGLViewRef.stopRender(); // 停止渲染视频video-stop 后调用  
    this.refs.openGLViewRef.startAudioPlay(); // 开始播放音频 启动native端线程播放video发过来的音频帧  
    this.refs.openGLViewRef.stopAudioPlay(); // 停止播放音频kill 音频播放帧的线程  
    this.refs.openGLViewRef.startAudioRecord(); // 开始录音并发送至设备端  开启录音的线程,android端需要提前使用PermissionAndroid获取录音权限，iOS端需要通过permissions获取系统的录音权限  
    this.refs.openGLViewRef.stopAudioRecord(); // 停止录音，并关闭录音的线程  
  }  
}  

```

### 截取视频画面

* 截取视频画面并保存到指定路径：
  + 使用 Android 系统的设备在截取 `videoview` 里的画面前，需先使用 `PermissionAndroid` 获取 SD 卡的读写权限；
  + 使用 iOS 系统的设备在截图前需要使用 `permissions` 先获取相册读写权限。
* `CameraRenderView.snapShot()` 传入的 path 必须是以 `Host.file.storageBasePath` 开始的路径。如果不符合该规则，native 端会拒绝截图。

javascript

```
class DemoClass {  
  static snapShot(vidoeRenderView) {  
    return new Promise((resolve, reject) => {  
      var path = this.getFileName(false);  
      vidoeRenderView  
        .snapShot(Host.file.storageBasePath + "/" + path)  
        .then((_) => {  
          // 截图成功后，将图片转存至系统相册  
          return this.saveToAlbum(path, false);  
        })  
        .then((path) => {  
          resolve(path);  
        })  
        .catch((e) => {  
          reject(e);  
        });  
    });  
  }  
  
  static saveToAlbum(path, isVideo) {  
    // 转存资源到系统相册。  
    if (isVideo) {  
      return new Promise((resolve, reject) => {  
        Host.file  
          .saveVideoToPhotosDidAlbum(path)  
          .then((result) => {  
            resolve(path);  
          })  
          .catch((error) => {  
            reject(error);  
          });  
      });  
    } else {  
      return new Promise((resolve, reject) => {  
        Host.file  
          .saveImageToPhotosDidAlbum(path)  
          .then((result) => {  
            resolve(path);  
          })  
          .catch((error) => {  
            reject(error);  
          });  
      });  
    }  
  }  
}  

```

### 实现录像功能

* 录像前，开发者需调整视频清晰度，默认调整到最高清晰度，并在 `CameraRenderView` 中，通过参数 `recordingVideoParam` 指定该清晰度对应的分辨率宽高 width&&height，如果视频帧率不是 20 帧，还需要指定该分辨率下的帧率 fps，如果希望按照实际收到视频帧的时间点插入视频帧到文件里，指定 `fps = -1` 即可（fps 功能只对 Android 端生效）。
* 开始录制前，如果没有开启声音，需要发开启声音的命令，但不调用 `startAudioPlay()`，结束录制的时候，如果开始录制前没有开启声音，就需要发送关闭声音的命令。
* 录制视频画面，并将录制后的视频保存到指定路径，使用 Android 系统的设备在录制 `videoview` 里的画面前，需先使用 `PermissionAndroid` 获取 SD 卡的读写权限；使用 iOS 系统的设备在录制 `videoView` 里的画面前需要使用 `permissions` 先获取相册读写权限。
* `CameraRenderView.startRecord(path, timeCallbackName)` 传入的 path 必须是以 `Host.file.storageBasePath` 开始的路径，如果不符合该规则，native 端会拒绝录制。如果想获取当前录制视频的实时长度，可以通过 `DeviceEventEmitter` 监听 `timeCallbackName` 获取录制视频时长，单位为秒(s)。

javascript

```
class DemoClass {  
  // 开始录像  
  realStartRecord() {  
    // 切换清晰度为高清  
    if (this.state.resolution != 3) {  
      // 不是高清  
      Service.miotcamera  
        .sendP2PCommandToDevice(MISSCommand.MISS_CMD_STREAM_CTRL_REQ, {  
          videoquality: 3,  
        })  
        .then((retCode) => {  
          // 不修改如下信息  
          // this.setState({ resolution: index })  
          // StorageKeys.LIVE_VIDEO_RESOLUTION = index;  
        })  
        .catch((err) => {  
          console.log(err);  
        });  
    }  
    // 打开声音  
    if (this.state.isMute) {  
      // 不是有声音 开启声音通道 不播放  
      Service.miotcamera  
        .sendP2PCommandToDevice(MISSCommand.MISS_CMD_AUDIO_START, {})  
        .then((retCode) => {  
          console.log("audio stop get send callback");  
          console.log(retCode);  
        });  
    }  
    let path = AlbumHelper.getFileName(true);  
    this.videoRecordPath = path;  
    this.refs.openGLViewRef  
      .startRecord(  
        Host.file.storageBasePath + "/" + path,  
        kRecordTimeCallbackName  
      )  
      .then((retCode) => {  
        console.log("start record, retCode: " + retCode);  
        this.setState({ isRecording: true });  
      })  
      .catch((err) => {  
        console.log(err);  
        Toast.success("action_failed");  
      });  
  }  
  
  // 停止录像  
  _stopRecord() {  
    if (!this.state.isRecording) {  
      return;  
    }  
  
    if (this.state.resolution != 3) {  
      // 不是高清  
      Service.miotcamera  
        .sendP2PCommandToDevice(MISSCommand.MISS_CMD_STREAM_CTRL_REQ, {  
          videoquality: this.state.resolution,  
        })  
        .then((retCode) => {  
          // 不修改这些信息  
        })  
        .catch((err) => {  
          console.log(err);  
        });  
    }  
  
    if (this.state.isMute) {  
      // 默认静音  
      Service.miotcamera  
        .sendP2PCommandToDevice(MISSCommand.MISS_CMD_AUDIO_STOP, {})  
        .then((retCode) => {});  
      this.refs.openGLViewRef.stopAudioPlay();  
    }  
  
    this.refs.openGLViewRef  
      .stopRecord()  
      .then((result) => {  
        this.setState({ isRecording: false, recordTimeSeconds: 0 });  
        if (this.videoRecordPath == null || this.videoRecordPath == "") {  
          return;  
        }  
        setTimeout(() => {  
          // stopRecord后，要延迟一会再保存，不然视频文件还没有生成，copy就会出错。  
          // 录制成功后 将视频转存储到相册。  
          AlbumHelper.saveToAlbum(this.videoRecordPath, true)  
            // 把视频保存到手机相册里，在手机相册中查看所录制的视频  
            .then((result) => {  
              console.log(result);  
            })  
            .catch((err) => {  
              console.log(err);  
            });  
          // 完成录屏后截图  
          this._realStartSnapshot(true);  
        }, 500);  
      })  
      .catch((error) => {  
        this.setState({ isRecording: false, recordTimeSeconds: 0 });  
        if (error == -2) {  
          // Android端没有录制超过3s 时将返回该错误码  
          Toast.fail("record_video_failed_time_mini");  
        } else {  
          Toast.fail("record_video_failed");  
        }  
      });  
  }  
}  

```

## 04 自测与上线

### 自测与预约（上线前完成）

# 自测与预约

更新时间：2024/11/06

> **注意：**
>
> 创建产品后，为避免影响产品开发上市周期，顺利通过审核上线，建议在开发初期，就在「控制台 - 产品 - 产品详情页 - 自测与预约」中，下载最新的自测资料，明确认证审核标准

## 概念说明

**自测：** 在小米 IoT 平台产品接入中，特指在完成产品的开发和配置后，开发者需要在提交产品上线前，依据平台提供的测试资料，自行完成产品软硬件功能的测试；

**认证实验室：** 是指由小米 IoT 平台授权的米家接入认证实验室，具备在认可范围内执行米家接入设备认证测试的能力。实验室严格按照小米实验室管理规定，对米家认证测试全流程进行有效、系统的管理，出具的报告被小米 IoT 平台认可。

## 前提条件

1. 在小米 IoT 平台注册企业且被审核通过，关于如何注册企业请参考[注册企业](/v2/new/doc/configuration/signin/create-enterprise)；
2. [登录小米 IoT 平台](https://iot.mi.com/fe-op/productCenter)；
3. 在平台成功[创建产品](/v2/new/doc/configuration/create)；
4. 如果您的开发流程中出现：「自测与预约」，则需要完成以下产品全部开发和配置工作后，才能“预约认证实验室”：

* [基础配置](/v2/new/doc/configuration/configuration)
* [国际化配置（可选）](/v2/new/doc/configuration/globalization)
* [功能定义](/v2/new/doc/configuration/define-features)
* 扩展程序：[扩展程序开发](/v2/new/doc/plugin/quickstart/quick-start)、[扩展程序配置](/v2/new/doc/configuration/extension-development/extension-development)
* 固件：[固件开发](/v2/new/doc/embedded-dev/module-dev/quickstart)、[固件配置](/v2/new/doc/configuration/firmware/firmware)
* [高阶配置](/v2/new/doc/configuration/advance-configure/network-distribution)

## 配置要求

如果左侧流程出现「自测与预约」选项，则表明该类产品需要通过认证实验室审核，所以必须完成的“预约”实验室的操作，即下方步骤中的全部；

如果仅出现「自测」选项，则只需完成下方步骤中的第一步即可。

## 操作步骤

### 第 1 步 - 下载自测资料

在完成基础的产品开发和配置后，需要通过“自测”确保产品符合小米 IoT 平台的上线标准。

开发者可以在「自测与预约 - 下载资料自测」中，下载最新的测试资料，并使用白名单账号，对产品功能进行逐一检查核对后，按要求填写测试资料。填写完成的测试报告，需要在后续产品“申请上线”的时候上传审核。

> **注意：**
>
> * 不同类型的产品、在不同服务器上线的产品，自测资料均不一样，建议每次申请上线前都要下载最新资料；
> * 关于自测资料的有效时间：在“审核执行日期”前，可使用该版本资料提审，也可使用上一个版本的资料提审。在该日期后，仅可使用该版本资料提审。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/ca310cdda5503d78d97d108f7d0862c7_1730706203754.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fKv/R51lRWlMctBpYyoaZyqOxCM=)

下载自测资料入口

### 第 2 步 - 预约认证实验室

> **注意：**
>
> 如果主流程中，仅出现「自测」，可跳过该步骤；
>
> 如果主流程中，出现「自测与预约」，则表示该品类产品需要通过认证实验室验收。

为了能够让开发者顺利通过产品的验收测试，提高接入效率，小米 IoT 平台联合具有资质的实验室，帮助开发者在产品的研发阶段提高产品质量。

待接入米家的产品，经由小米 IoT 平台授权的米家接入认证实验室认证测试通过后，再经小米 IoT 平台审批通过，产品才能正式上线。其中，测试认证的费用，请以认证实验室的具体报价为准。

> **说明：**
>
> * 在产品验收过程中，若出现任何问题，请开发者联系“认证实验室”沟通；
> * 认证实验室的介绍、地址和联系人等信息，请参见“预约实验室”详情页面；
> * 产品认证的费用标准请参考预约页面，具体认证费用请和认证实验室沟通，小米 IoT 平台不会以任何方式直接向厂商索取任何费用。

点击页面中的【预约】，按要求填写内容提交，即可完成预约申请。审核时间一般需要 1-2 个工作日，如需加急请联系实验室。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/2be6114a443c182a366d6d3ec3695071_1730706242483.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=b++ODSgc21AGff8gWHmfEBEWZwE=)

认证实验室预约

## 后续操作

认证实验室预约通过后，请在平台对产品申请上线，参考[产品申请上线](/v2/new/doc/configuration/publish-product)。

### 申请上线

*Error fetching page: Could not reach host. Are you offline?*

## 05 用户运营

### 数据服务

# 数据看板

更新时间：2024/11/06

平台将统计数据形成可视化的看板，BI 看板提供了**总体预览看板**、**设备相关统计与分析**、**米家扩展程序相关统计与分析**、**用户画像**等内容。

数据包含**中国大陆地区**、**港澳台**及**国外服务器**的设备统计。

进入“控制台 - 数据”页面，可以查看设备、用户、扩展程序的数据统计与分析。

> **说明：**
>
> * 仅当前企业开发组的**拥有者、管理员和数据产品经理**可以查看“数据”模块。
> * 数据产品经理，仅可查询被授权的产品 model 下的数据。
> * 遇到数据增量为负数、总量减少时，为数据正在维护或是数据尚未完全产出，平台会尽快协调资源处理，开发者可以稍晚再次查看。

## 总体指标看板

平台提供了面向设备、用户、扩展程序的总体指标看板：

* 可以查看产品上线以来，**设备激活的总数**、**扩展程序的用户总数**，并且可以通过折线图一目了然的了解到周期内**总数数据**的变化趋势。
* 可以查看**前一日**的**新增设备数**、**新增用户数**、**设备日活环比**、**扩展程序日活环比**。
* 可以查看**近 7 日、近 30 日、近 60 日**的**设备新增总数**、**扩展程序用户新增总数**、及**对应的环比统计**，并且可以通过折线图一目了然的了解到周期内**新增数据**的变化趋势。
* 可以查看当前企业组下的所有设备，**总数的排行**、**7 日内新增总数的排行**、**30 日内新增总数的排行**。

![](https://cdn.cnbj1.fds.api.mi-img.com/iotweb-user-center/82ae17d29057a0b0a04d1ceb5ea195f3_100.jpeg?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=OUPP1z0owq5NzUZTKY5O2OcGMFk=)

数据概览

## 设备统计与分析

对设备的总数、新增、日活、最大在线数、地域分布，进行了更详细的统计和分析。

### 总体分析

* 可查看**总体或某个**产品下所有设备的，**总体的 / 近 7 日的 / 近 30 日的 / 近 60 日的**，**激活总数**、**对应扩展程序的用户总数**、**日活跃数**、**单小时最大在线数**。
* 可查看对应数据的、对应周期内的环比情况和增长趋势，其中增值趋势提供了可视化的折线图。
* 可查看**总体或某个**产品下所有设备的**固件版本升级情况**。
* 可以下载可视化统计图和数据表格。

![](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_png_163ebe17425edaa9393f4f629f96c5f6.png)

设备分析

### 地域分布

* 可查看**总体或某个**产品下所有设备的，\*\*中国（包括中国大陆地区和港澳台地区）**和**全球（包含中国）\*\*的，**设备激活总数**、**设备新增总数**。
* 可使用中国地图和世界地图的可视化形式，一目了然的查看设备的**分布情况**和**区域下的激活总数 / 激活新增数**。

  + 中国面向各个省份。
  + 全球面向各个国家。
* 可以查看分别针对**中国各省份**和**全球各国家**的**设备激活总数 / 新增总数**的排行。
* 可以下载分布地图和数据表格。

> **说明：** 可通过地图旁的条状滚轴，确定要查看的数据范围，从而在地图上展示对应数据范围的地区。

![](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_png_f566a2d7a13cc3ecbdaf5c19a7b84722.png)

地域分布

## 扩展程序统计与分析

对米家扩展程序的日活、手机操作系统分布、手机型号分布、崩溃情况，进行了更详细的统计和分析。

### 用户情况

* 可查看**总体或某个**产品对应米家扩展成程序的，**用户总数**、**安卓系统下用户总数**、**iOS 系统下用户总数**、及对应的**前一日新增用户数**。
* 可查看**某个具体扩展程序版本**的，近 7 日 / 近 15 日 / 近 30 日的，用户日活趋势和环比。
* 可查看**总体或某个**产品对应米家扩展成程序的，用户使用手机操作系统分布情况，以环状图可视化展现。
* 可查看**总体或某个**产品对应米家扩展成程序的，用户使用手机型号排行 TOP20。
* 可以下载统计图和数据表格。

![](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_png_ac8d711a15b3981d097380088f30ff7f.png)

扩展程序分析

### 崩溃情况

* 可查看**前一日**，**总体或某个**产品对应米家扩展程序的，**崩溃率**、**崩溃次数**、**崩溃总人数**、**人均崩溃次数**、及对应的**环比情况**。
* 可查看**总体或某个**产品对应米家扩展程序的，近 7 日 / 近 18 日 / 近 30 日的，**崩溃率**、**崩溃次数**、**崩溃总人数**、**人均崩溃次数**趋势。
* 可查看前一日的具体崩溃记录。
* 可以下载统计图和数据表格。

![](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_png_14a70b13728bd866554881c2e4616acb.png)

扩展程序崩溃率

## 用户画像

* 可以查询**所有设备的用户总体画像**，也可以查询**某个具体设备的用户画像**。
* 提供查询的用户属性包括：**性别**、**年龄**、**学历**、**有无小孩**、**使用手机品牌**、**使用手机型号**、**个人拥有智能设备数**。
* 可以定位每个用户属性中，每个区段的个数和占比，并且平台会通过条形图或环图来可视化展现。
* 暂时仅支持展示**截止到 4 日前**的总体统计结果。

![](https://cdn.cnbj0.fds.api.mi-img.com/miio.files/commonfile_png_2d2d8cf976a2958815fc610080dd9f3d.png)

用户画像

## 小爱语控

* 可查看**所有产品**的小爱语控相关数据，也可查看某个**具体产品**的小爱语控相关数据。
* 可查看小爱语控用户活跃情况，包括**日活**、**周活**、**月活**、**日新增语控用户数**、**语控次数**、**人均语控次数**，并且可以通过折线图一目了然地了解到近 7 日 / 近 18 日 / 近 30 日的变化趋势。
* 可查看小爱语控的转化情况，包括**设备转化**和**用户转化**的平均转化率，并且可以通过折线图一目了然地了解到近 7 日 / 近 18 日 / 近 30 日和变化趋势。

  + **设备转化**折线图中，可查看**可控设备数**、**每日在线设备数**、**每日真实交互设备数**、**每日被小爱控制设备数**。
  + **用户转化**折线图中，可查看**有可控设备用户数**、**每日有在线被控设备用户数**、**每日有真实交互被控设备用户数**、**每日语音控制用户数**。
* 可查看小爱语控的用户渗透率，包括**日渗透率**、**周渗透率**、**月渗透率**，并且可以通过折线图一目了然地了解到近 7 日 / 近 18 日 / 近 30 日和变化趋势。
* 可查看小爱语控产品的排行榜，采用单独的时间查询条件，默认按**语控用户总数**倒序排列，用户可手动调整按照其他指标排序，包括**日人均语控次数**、**设备日均转化率**、**用户日均转化率**、**用户日均渗透率**。

> **说明：** 由于大数据的数据清洗机制有时间差，故看板数据取值时间为 2 天前。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/24808001e5b6a4421913aa1890fbf63f_1730706741063.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=bjTTw9Ld6pMzXlgjJVtDqqbtIs0=)

小爱语控

### 用户运营

# 用户运营

更新时间：2024/11/06

平台提供开发者对其产品用户的运营管理，包括**用户设备管理**，和**来自米家扩展程序上的用户反馈管理**。

进入“控制台 - 运营 - 用户运营”页面，进行用户运营管理。

## 用户设备信息管理

### 通用设备使用

进入“控制台 - 运营 - 用户运营 - 用户设备信息查询”页面，可以查询某个“用户 ID(uid)”下的设备信息，也可以反向查询某个“设备 ID(did)”下的用户信息。

> **说明：**
>
> * 当前仅支持查询中国大陆地区的设备的相关信息，暂不支持查询港澳台地区和其他国家的相关信息。
> * 仅支持查询当前企业开发组下拥有的产品对应的设备和用户信息。

| **结果字段**     | **含义**                           | **用途**         |
| ---------------------- | ---------------------------------------- | ---------------------- |
| **设备名称**     | 当前具体设备，用户在米家 App 上的命名。  | -                      |
| **设备 model**   | 当前具体设备，在平台对应的的产品 model。 | -                      |
| **设备 ID(did)** | 当前具体设备，在平台的唯一设备标识 did。 | 可用于其他日志的查询。 |
| **固件版本**     | 当前具体设备，已经升级到的最新固件版本。 | -                      |
| **MAC**          | 当前设备的 Mac 地址。                    | -                      |
| **状态**         | “在线”或“离线”。                     | -                      |

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/a960e3c86ec2744b0a416ecd12fb8389_1730707180354.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fquxFTspETOQjhCBVoG12Kt0zl0=)

设备信息查询

### 强绑定蓝牙设备解绑

进入“控制台 - 运营 - 用户运营 - 用户设备信息查询 - 设备信息”页面，输入要解绑的设备对应的设备 ID(did)，在操作位置点击【解绑】按钮，可以解绑当前设备所绑定的用户 ID(did)。

* 仅面向蓝牙产品，且“控制台 - 产品 - 基础配置”中的“强弱绑定”信息项为“强”的设备可操作。
* 主要面向“锁”、“保险箱”等高安全级别的设备适用，主要用于用户无法主动解绑时（比如未解绑就退货），开发者帮助用户实现解绑。
* 仅当前企业开发组的**拥有者**和**管理员**可以进行此操作。

## 用户反馈管理

可以查询当前企业开发组下所有产品通过米家 App 扩展程序提交的反馈。

* 默认是展示全部历史反馈，可以筛选某个具体产品、具体安卓或 iOS 版本、具体的处理状态，来筛选反馈信息。
* 反馈列表展现了**反馈的内容描述**和**用户提交反馈的时间**。
* 点击当条反馈后的【查看详情】，可以查看用户在提交此反馈时的**设备状态**和**设备日志**，设备状态包括“用户 ID”、“用户联系方式”、“用户当前 App 的版本号”及“其他内容信息”。
* 在【查看详情】中，开发者回复用户，以实现与用户的交流。
* 点击【下载数据】按钮，**可下载反馈数据表**。

> **说明：** 在平台提交工单咨询具体设备或扩展程序问题的时候，需要附件提交有问题的反馈日志。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/6360f91100f0dbc9490f829e7544e817_1730707202191.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=VCZsE+KPjUKiSZ+EtPI3ktSRx6Y=)

用户反馈

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/df6b2003777c6acbf9b1a23b11f1d3d9_1730707318875.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=fstYVDqWQS7/i0lmm/0T8TH+Vck=)

用户反馈日志

### 日志查询

# 日志查询

更新时间：2024/11/06

> **说明：**
>
> * 当前仅支持查询 7 天内的日志；
> * 仅可查询当前登录人在当前企业有权限的产品对应的设备、用户数据。

## 设备日志查询

### 通信日志

* 进入“控制台 - 运营 - 设备日志查询 - 通信日志”页面，通过 **设备 ID(did)** 进行查询。
* 用途：可查询某个具体设备的上报数据和执行指令，从而排查设备的功能异常。

| **结果字段** | **含义**                                              | **用途**                                       |
| ------------------ | ----------------------------------------------------------- | ---------------------------------------------------- |
| 时间               | 当前数据条的生成时间。                                      | -                                                    |
| 消息类型           | 1. 上行日志：设备的上报数据。 2. 下行日志：设备的执行指令。 | -                                                    |
| 消息内容           | -                                                           | 提交工单咨询的时候，附上消息内容，以便平台排查问题。 |

通信日志查询

> **说明：** 由于设备通信日志较多，鉴于查询效率，一次仅可查询一个小时内的日志。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/42a8e6705c76c1d2d71cf9aac1ffc5cf_1730706784927.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=swZc2lTWrWw/4cufEVJchIme4tg=)

通讯日志查询

### 上线/下线日志

* 进入“控制台 - 运营 - 设备日志查询 - 上下线日志”页面，通过 **设备 ID(did)** 查询。
* 用途：查询某个具体设备近 7 天内发生的上线、离线记录，从而排查设备的离线异常。

| **结果字段** | **含义**                   | **用途** |
| ------------------ | -------------------------------- | -------------- |
| 时间               | 设备上线或下线发生的时间。       | -              |
| 上线/下线          | “online”或“offline”          | -              |
| IP                 | 当前设备上线或离线所在的 IP 环境 | -              |

上线/下线日志查询

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e370ba585653ad2062f19bf58c2b250f_1730706811967.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=i72r/U14lfpxQEylCeDYlEQFYzo=)

上下线日志查询

### 绑定/解绑日志

* 进入“控制台 - 运营 - 设备日志查询 - 绑定/解绑日志”页面，通过 **设备 ID(did)** 查询。
* 用途：查询某个具体设备近 7 天内发生的绑定、解绑记录，从而排查绑定与解绑的异常。

| **结果字段** | **含义**                                                                                                                                  | **用途** |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| 操作用户           | 当条绑定/解绑记录的操作用户。                                                                                                                   | -              |
| 操作类型           | 包括“绑定”和“解绑”。                                                                                                                        | -              |
| 触发方式           | 1.**手动操作**：用户在 App 上主动添加或删除设备。 2. **发现重置**：用户在设备上发起的重置操作，该方式当操作类型为“解绑”时会出现。 | -              |
| 操作时间           | 当条绑定/解绑操作发生的时间。                                                                                                                   | -              |

绑定/解绑日志查询

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/8de5d78827dbab0020dc2fb69264a391_1730706840603.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=9MQAjFAT/fooGfnpAePnkJMyGDw=)

绑定/解绑日志查询

### 配网日志

* 进入“控制台 - 运营 - 设备日志查询 - 配网日志”页面，通过 **设备 ID(did)** 查询。
* 用途：查询某个具体设备近 7 天内，连接过的路由器信息和配网时间，明确配网环境。

| **结果字段** | **含义**                         | **用途** |
| ------------------ | -------------------------------------- | -------------- |
| 操作用户           | 操作该设备配网和绑定的用户 ID(uid)。   | -              |
| 路由器 ssid        | 连接路由器的广播地址，一般由用户命名。 | -              |
| 路由器 bssid       | 连接路由器的 Mac 地址。                | -              |
| 操作时间           | 当条配网绑定操作发生的时间。           | -              |

配网日志查询

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/c94964733dc0a3b4ef5f74247944c813_1730706869817.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=lnDzsQyWSi8pJnx4sBm+wc09SsY=)

配网日志查询

## 扩展程序崩溃日志查询

* 进入“控制台 - 运营 -RN 扩展程序崩溃日志”页面，可以查询**某个用户**下**具体扩展程序**的**具体扩展程序版本**，在某一天的崩溃日志。
* 仅支持查询**中国大陆地区近 7 天内**的日志，由于崩溃日志内容可能较多，每次只支持查找一天。
* 用途：通过扩展程序崩溃日志查询，排除扩展程序的不稳定 Bug，以指导扩展程序的版本迭代。

| **结果字段** | **含义**                      | **用途**                         |
| ------------------ | ----------------------------------- | -------------------------------------- |
| 时间               | 崩溃发生的时间。                    | -                                      |
| 用户 ID(uid)       | 崩溃问题所在扩展程序绑定的用户 ID。 | -                                      |
| 崩溃 class         | 崩溃问题发生所在的 class。          | **在工单咨询相关问题时可提供**。 |
| 崩溃 method        | 崩溃问题发生所在的 method。         | **在工单咨询相关问题时可提供**。 |
| 设备型号           | 出现崩溃的手机型号。                | **在工单咨询相关问题时可提供**。 |
| App 版本           | 出现崩溃的米家 App 版本。           | **在工单咨询相关问题时可提供**。 |
| 系统               | 出现崩溃的所在手机操作系统。        | **在工单咨询相关问题时可提供**。 |
| 操作               | 可查询具体的崩溃日志                | **在工单咨询相关问题时可提供**。 |

RN扩展程序崩溃日志

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/f3477ed9404be883dfaab7137efd4657_1730706897385.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=KEiGJj02EbrZY130FDeHl6qSSc4=)

RN扩展程序崩溃日志

## 消息推送日志查询

* 前提：查询“消息推送日志”之前，需要先确定触发消息推送的设备上报日志 ID，即 logid。
* 进入“控制台 - 运营 - 上报日志查询”页面，通过 **设备 ID(did)** 查询。

| **结果字段** | **含义**             | **用途**                                                                                                                         |
| ------------------ | -------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| logid              | 设备上报记录 ID。          | 查询消息推送日志的重要参数。                                                                                                           |
| 上报数据           | -                          | 可以提交工单的时候，附消息内容，以便平台排查问题。                                                                                     |
| 上报时间           | 当条设备上报数据的发生时间 | 可以提交工单的时候附上。                                                                                                               |
| 操作               | -                          | 点击【查看消息推送日志】按钮，可以直接跳转至当条上报数据所触发的消息推送结果查询页，如果当条上报数据不触发消息推送，则跳转页面无数据。 |

上报日志查询

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/c4b80530f1e8cc9d2eee997236db4140_1730706928061.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=wvnGiUHEdvs7dE7utgL9S4gH3zk=)

上报日志查询

* 进入“控制台 - 运营 - 消息推送日志查询”页面，通过 **logid** 查询。
* 用途：查询消息推送执行是否成功，如果未成功，可以通过消息推送日志排查问题。

| **结果字段** | **含义**                                   | **用途**                     |
| ------------------ | ------------------------------------------------ | ---------------------------------- |
| 消息名称           | 开发者自定义的该消息的备注，在消息推送配置时定义 | -                                  |
| 消息文案           | 推送给用户的消息内容，在消息推送配置时定义       | -                                  |
| 推送结果           | “成功”或“失败”                               | -                                  |
| 原因备注           | 执行日志。                                       | **可在工单咨询过程中附上**。 |
| 推送时间           | 该条消息发生推送的时间。                         | -                                  |

消息推送日志查询

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/1f66b2a067a23ba41591b91213c8bd35_1730706954325.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=0FkOmRgY3RTSr3LKN2KXwtBzkKs=)

消息推送日志查询

## 场景信息查询

### 场景基本信息

* 进入“控制台 - 运营 - 场景信息查询”页面，通过 **用户 ID(uid)** 或 **完整的智能场景名称** 查询。
* 用途：收集用户设定的智能场景信息，以便管理与排查问题。

| **结果字段** | **含义**                                                                                                                   | **用途**                         |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------- |
| 场景 ID            | 某条场景在平台的唯一标识                                                                                                         | **在工单咨询相关问题时可提供**。 |
| 场景名称           | 某条智能场景的全称，由用户自定义。                                                                                               | **在工单咨询相关问题时可提供**。 |
| 模板类型           | 开发者无需关注。                                                                                                                 | **在工单咨询相关问题时可提供**。 |
| 执行类型           | 1.**本地执行**：无需查上报内容，直接在本地看配置与开发。 2. **云端执行**：会有涉及设备上报，需要额外查设备上报记录。 | **在工单咨询相关问题时可提供**。 |
| 场景状态           | “成功”或“失败”，在自动执行过程中有一次执行失败记录，即会显示“失败”。                                                       | -                                      |
| 创建时间           | 用户创建该条智能场景的时间。                                                                                                     | -                                      |

场景基本信息

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/bcd6547a0b1680e6e452839dd05c7402_1730706979189.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=SbPeiK7tgViXrNE6FNz0kxMPzEc=)

场景基本信息

### 场景配置信息

* 进入“控制台 - 运营 - 场景信息查询”页面，在通过用户 ID(uid)搜索出场景信息的情况下，点击某条具体场景后的【查看配置】，进入“场景配置信息查询”页面进行查询。
* 用途：排查智能场景功能定义与开发是否正确。

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/8db8b4dc5727d5e32bbd4f69713f9683_1730707005240.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=JmuBwvIaKL3xJnsC0hpF6iLWLhM=)

场景详情配置

### 场景执行日志

* 进入“控制台 - 运营 - 场景信息查询”页面，在通过用户 ID(uid)搜索出场景信息的情况下，点击某条具体场景后的【查看日志】，进入“场景执行日志查询”页面进行查询。
* 用途：用于查询用户自行定义的智能场景，在自动执行时，是否成功，并获取执行日志，以便排查智能场景的定义和开发正确性。

| **结果字段** | **含义**              | **用途**           |
| -------- | ------------------- | ---------------- |
| 执行结果     | “成功”或“失败”           | -                |
| 原因备注     | 执行日志。               | **可在工单咨询过程中附上**。 |
| 执行时间     | 用户已设置的该条场景，自动执行的时间。 | -                |

场景执行日志

![](https://cdn.cnbj1.fds.api.mi-img.com/miot-images/e4b9f44219913dfe957a0461c4029b1f_1730707137558.png?GalaxyAccessKeyId=AKVGLQWBOVIRQ3XLEW&Expires=9223372036854775807&Signature=6ETlDH3qHrNOQUpFKVqLRiiDlZU=)

场景执行日志