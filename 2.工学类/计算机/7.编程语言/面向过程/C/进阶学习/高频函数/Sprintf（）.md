#### 目录

- [前言](https://blog.csdn.net/Colorful___/article/details/132766101#_1)
- [一.`sprintf()`函数的原型](https://blog.csdn.net/Colorful___/article/details/132766101#sprintf_5)
- [二.`sprintf()`的应用](https://blog.csdn.net/Colorful___/article/details/132766101#sprintf_18)
- - [1.字符串拼接](https://blog.csdn.net/Colorful___/article/details/132766101#1_20)
    - [2.数字转字符串](https://blog.csdn.net/Colorful___/article/details/132766101#2_33)
    - [3.填充字符串](https://blog.csdn.net/Colorful___/article/details/132766101#3_45)
    - [4.格式化输出](https://blog.csdn.net/Colorful___/article/details/132766101#4_54)
    - [5.将字符串转换成整数 `atoi`](https://blog.csdn.net/Colorful___/article/details/132766101#5_atoi_64)
- [三.注意事项](https://blog.csdn.net/Colorful___/article/details/132766101#_82)
- [四. 安全版本的`sprintf()` ：（`snprintf()`）](https://blog.csdn.net/Colorful___/article/details/132766101#_sprintf__snprintf_88)
- - [1.目标字符串长度限制:](https://blog.csdn.net/Colorful___/article/details/132766101#1_94)
    - [2.返回值:](https://blog.csdn.net/Colorful___/article/details/132766101#2_98)
    - [3.安全性:](https://blog.csdn.net/Colorful___/article/details/132766101#3_102)
- [结论](https://blog.csdn.net/Colorful___/article/details/132766101#_109)

## 前言

当我们需要将格式化的[数据写入](https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5&spm=1001.2101.3001.7020)字符串时，`sprintf()` [函数](https://marketing.csdn.net/p/3127db09a98e0723b83b2914d9256174?pId=2782&utm_source=glcblog&spm=1001.2101.3001.7020)是一个非常有用的工具。它可以帮助我们动态地创建字符串，以便后续使用。

在C语言中，`sprintf()` 函数允许我们使用类似于 `printf()` 函数的[格式化字符串](https://so.csdn.net/so/search?q=%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020)来生成文本，并将结果存储在一个字符数组中。下面，让我们一起深入了解 `sprintf()` 函数的使用方法和注意事项。

## 一.`sprintf()`函数的原型
### 1. 描述
  
C 库函数 `int sprintf(char *str, const char *format, ...)` 发送格式化输出到 str所指向的字符串。

### 2. 声明

首先，让我们来看一下 `sprintf()` 函数的原型：

```c
#include <stdio.h> //头文件
int sprintf(char* str, const char* format, ...);
```

`sprintf()` 函数有三个主要参数：

- `str`：指向要写入的字符串的指针。
- `format`：包含格式控制符的字符串，用于指定输出的格式。
- `...`：可变参数列表，根据格式化字符串中指定的格式进行输出。


### 3. 参数

- **str** -- 这是指向一个字符数组的指针，该数组存储了 C 字符串。
- **format** -- 这是字符串，包含了要被写入到字符串 str 的文本。它可以包含嵌入的 format 标签，format 标签可被随后的附加参数中指定的值替换，并按需求进行格式化。format 标签属性是 **%[flags][width][.precision][length]specifier**，具体讲解如下：

|specifier（说明符）|输出|
|---|---|
|c|字符|
|d 或 i|有符号十进制整数|
|e|使用 e 字符的科学科学记数法（尾数和指数）|
|E|使用 E 字符的科学科学记数法（尾数和指数）|
|f|十进制浮点数|
|g|自动选择 %e 或 %f 中合适的表示法|
|G|自动选择 %E 或 %f 中合适的表示法|
|o|有符号八进制|
|s|字符的字符串|
|u|无符号十进制整数|
|x|无符号十六进制整数|
|X|无符号十六进制整数（大写字母）|
|p|指针地址|
|n|无输出|
|%|字符|

  

|flags（标识）|描述|
|---|---|
|-|在给定的字段宽度内左对齐，默认是右对齐（参见 width 子说明符）。|
|+|强制在结果之前显示加号或减号（+ 或 -），即正数前面会显示 + 号。默认情况下，只有负数前面会显示一个 - 号。|
|(space)|如果没有写入任何符号，则在该值前面插入一个空格。|
|#|与 o、x 或 X 说明符一起使用时，非零值前面会分别显示 0、0x 或 0X。  <br>与 e、E 和 f 一起使用时，会强制输出包含一个小数点，即使后边没有数字时也会显示小数点。默认情况下，如果后边没有数字时候，不会显示显示小数点。  <br>与 g 或 G 一起使用时，结果与使用 e 或 E 时相同，但是尾部的零不会被移除。|
|0|在指定填充 padding 的数字左边放置零（0），而不是空格（参见 width 子说明符）。|

  

|width（宽度）|描述|
|---|---|
|(number)|要输出的字符的最小数目。如果输出的值短于该数，结果会用空格填充。如果输出的值长于该数，结果不会被截断。|
|*|宽度在 format 字符串中未指定，但是会作为附加整数值参数放置于要被格式化的参数之前。|

  

|.precision（精度）|描述|
|---|---|
|.number|对于整数说明符（d、i、o、u、x、X）：precision 指定了要写入的数字的最小位数。如果写入的值短于该数，结果会用前导零来填充。如果写入的值长于该数，结果不会被截断。精度为 0 意味着不写入任何字符。  <br>对于 e、E 和 f 说明符：要在小数点后输出的小数位数。  <br>对于 g 和 G 说明符：要输出的最大有效位数。  <br>对于 s: 要输出的最大字符数。默认情况下，所有字符都会被输出，直到遇到末尾的空字符。  <br>对于 c 类型：没有任何影响。  <br>当未指定任何精度时，默认为 1。如果指定时不带有一个显式值，则假定为 0。|
|.*|精度在 format 字符串中未指定，但是会作为附加整数值参数放置于要被格式化的参数之前。|

  

|length（长度）|描述|
|---|---|
|h|参数被解释为短整型或无符号短整型（仅适用于整数说明符：i、d、o、u、x 和 X）。|
|l|参数被解释为长整型或无符号长整型，适用于整数说明符（i、d、o、u、x 和 X）及说明符 c（表示一个宽字符）和 s（表示宽字符字符串）。|
|L|参数被解释为长双精度型（仅适用于浮点数说明符：e、E、f、g 和 G）。|






- **附加参数** -- 根据不同的 format 字符串，函数可能需要一系列的附加参数，每个参数包含了一个要被插入的值，替换了 format 参数中指定的每个 % 标签。参数的个数应与 % 标签的个数相同。

### 4. 返回值

如果成功，则返回写入的字符总数，不包括字符串追加在字符串末尾的空字符。如果失败，则返回一个负数。








## 二.`sprintf()`的应用

`sprintf()` 是 `C 标准库`中的一个函数，用于将格式化的[字符串输出](https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BE%93%E5%87%BA&spm=1001.2101.3001.7020)到一个字符数组中。它有类似于 `printf()` 的语法和用法，但不是将数据输出到控制台，而是将数据输出到指定的字符数组中。下面介绍一些使用 `sprintf()` 的技巧：

### 1.字符串拼接

在日常编程中，我们常需要将一个或多个字符串拼接成一个新的字符串。可以使用 `sprintf()` 来完成这种操作。例如：

```c
char str1[] = "Hello";
char str2[] = "world!";
char str3[100];
sprintf(str3, "%s %s", str1, str2);
printf("%s\n", str3); // 输出 "Hello world!"
```

在上面的示例中，我们首先定义了两个字符串 `str1 和 str2`，然后使用 `sprintf()` 将它们拼接成 `str3`。

### 2.数字转字符串

`sprintf()` 函数还可以将数字类型（如 `int、float、double` 等）的变量转换为字符串。例如：

```c
int num = 123;
char str[100];
sprintf(str, "%d", num);
printf("%s\n", str); // 输出 "123"
```

可以通过格式化字符串的占位符指定变量的类型和输出格式。

### 3.填充字符串

`sprintf()` 函数的格式化字符串还可以指定字符串的长度和填充字符。例如：

```c
char str[10];
sprintf(str, "%10s", "Hello");
printf("'%s'\n", str); // 输出 "     Hello"
```

上面的示例中，使用 `%10s` 指定输出字符串长度为 `10`，不足的地方会用空格填充。

### 4.格式化输出

与 `printf()` 一样，`sprintf()` 函数的格式化字符串支持各种占位符，可以实现各种复杂的格式化输出。例如：

```c
double pi = 3.1415926;
char str[100];
sprintf(str, "The value of pi is approximately %.2f", pi);
printf("%s\n", str); // 输出 "The value of pi is approximately 3.14"
```

在上面的示例中，使用 `%.2f` 指定输出浮点数的精度为 `2`。

### 5.将字符串转换成整数 `atoi`

函数原型：`int atoi(const char *nptr);`

- 字符串转整数函数，`nptr`: 要转换的字符串

```c
#include<stdio.h>
#include<stdlib.h> 

int main()
{
	printf("字符串\"123456\"转换为数字：%d\n", atoi("123456"));
	printf("字符串\"-123456\"转换为数字：%d\n", atoi("-123456"));
	return 0;
}
```

## 三.注意事项

在使用 `sprintf()` 函数时，需要注意以下几点：

- 确保目标字符串的缓冲区足够大，能够容纳生成的字符串。避免缓冲区溢出的风险。
- 确保提供足够数量和类型的参数，以匹配格式化字符串中的格式控制符。如果提供的参数与格式化字符串不匹配，可能会导致未定义的行为。
- 谨慎处理用户输入。使用 `%s` 格式控制符时，要确保所传入的字符串不会引起缓冲区溢出或其他安全漏洞。

## 四. 安全版本的sprintf()、snprintf()

在实际开发中，为了防止缓冲区溢出问题，可以使用 `snprintf()` 函数代替 `sprintf()` 函数。`snprintf()` 函数在写入目标字符串时会限制写入的字符数，从而防止溢出。

```c
int snprintf(char* str, size_t size, const char* format, ...);
```

### 1.目标字符串长度限制:

- `sprintf()` 函数没有对目标字符串的长度进行限制，因此可能会导致缓冲区溢出。如果生成的字符串超过了目标字符串的容量，就会发生未定义的行为。
- `snprintf()` 函数通过第二个参数来限制目标字符串的最大长度，包括终止的空字符。即使生成的字符串超过了指定的长度，`snprintf()` 也会确保生成的字符串不会溢出目标缓冲区。

### 2.返回值:

- `sprintf()` 函数返回成功写入目标字符串的字符数，如果发生错误则返回负值。
- `snprintf()` 函数返回尝试写入目标字符串的字符数（不包括终止的空字符），但是返回的字符数不会超过指定的字符串长度。如果返回的字符数等于或超过指定的长度，则表示输出被截断，这可以用来检查是否发生了缓冲区溢出。

### 3.安全性:

- `sprintf()` 函数在使用时需要特别小心，因为它没有对目标字符串的长度进行限制。如果没有足够大的缓冲区，可能会导致缓冲区溢出，从而引发安全漏洞。
- `snprintf()` 函数相对较安全，因为可以限制目标字符串的最大长度。通过指定正确的缓冲区大小，可以避免缓冲区溢出问题。

因此，为了确保安全性并防止缓冲区溢出，建议在可能的情况下使用 `snprintf()` 函数替代 `sprintf()` 函数，以便控制生成的字符串的长度并避免潜在的问题。

## 结论

`sprintf()` 函数是一个功能强大的工具，可用于将格式化的数据写入字符串中。它可以帮助我们创建动态的字符串，用于日志记录、文本生成和其他各种用途。

但是，在使用 `sprintf()` 函数时需要注意缓冲区大小、格式化字符串和参数列表的匹配，以及安全性等问题。如果有可能，可以选择使用更安全的 `snprintf()` 函数来避免缓冲区溢出问题。

希望本篇博客能够帮助你理解和使用 `sprintf()` 函数，使你的字符串操作更加方便和灵活。