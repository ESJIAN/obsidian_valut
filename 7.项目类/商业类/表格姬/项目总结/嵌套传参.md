ä½ æåˆ°çš„é—®é¢˜éå¸¸å…¸å‹ï¼š**å½“å‡½æ•°åµŒå¥—å±‚æ¬¡è¿‡æ·±ï¼Œä¸”éœ€è¦å±‚å±‚ä¼ é€’å‚æ•°æ—¶ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€å¯è¯»æ€§å·®ã€æ‰©å±•æ€§å·®**ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„â€œ**å‡½æ•°é“¾å¼è°ƒç”¨ + å‚æ•°ä¼ é€’æ··ä¹±**â€é—®é¢˜ã€‚

---

## ğŸ§¨ é—®é¢˜æœ¬è´¨åˆ†æ

ä½ æåˆ°çš„ç—›ç‚¹ï¼š

- **å‡½æ•°åµŒå¥—å¤šå±‚**ï¼šæ¯”å¦‚ A â†’ B â†’ C â†’ Dï¼Œæ¯ä¸€å±‚éƒ½è¦ä¼ é€’ä¸€å †å‚æ•°ï¼›
- **å˜é‡éœ€è¦æ›´æ–°**ï¼šæ¯”å¦‚æŸä¸ªä¸­é—´å‡½æ•°ä¿®æ”¹äº†æŸä¸ªå‚æ•°ï¼Œåç»­å‡½æ•°éœ€è¦ä½¿ç”¨æ›´æ–°åçš„å€¼ï¼›
- **ç»´æŠ¤å›°éš¾**ï¼šä¸€æ—¦å‚æ•°æˆ–é€»è¾‘å˜æ›´ï¼Œéœ€è¦ä¿®æ”¹å¤šä¸ªå‡½æ•°ï¼›
- **å¯è¯»æ€§å·®**ï¼šè°ƒç”¨é“¾å¤ªæ·±ï¼Œé˜…è¯»ä»£ç æ—¶å®¹æ˜“è¿·å¤±åœ¨å‡½æ•°ä¹‹é—´ï¼›
- **æµ‹è¯•å›°éš¾**ï¼šå‡½æ•°ä¹‹é—´ä¾èµ–å¼ºï¼Œéš¾ä»¥ç‹¬ç«‹æµ‹è¯•ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆæ€»è§ˆ

|æ–¹æ¡ˆ|æè¿°|ä¼˜ç‚¹|ç¼ºç‚¹|
|---|---|---|---|
|1. ä½¿ç”¨Â **ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆContext Objectï¼‰**|æŠŠæ‰€æœ‰å‚æ•°å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œå‡½æ•°é—´ä¼ é€’è¿™ä¸ªå¯¹è±¡|å‚æ•°é›†ä¸­ç®¡ç†ï¼Œæ˜“äºæ‰©å±•|åˆæœŸéœ€è¦é‡æ„|
|2. ä½¿ç”¨Â **å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆå¦‚å•ä¾‹ï¼‰**|ä½¿ç”¨å•ä¾‹æ¨¡å¼æˆ–å…¨å±€å˜é‡ä¿å­˜çŠ¶æ€|è°ƒç”¨æ–¹ä¾¿ï¼Œæ— éœ€å±‚å±‚ä¼ å‚|æ˜“é€ æˆçŠ¶æ€æ··ä¹±|
|3. ä½¿ç”¨Â **å‡½æ•°ç»„åˆ/ç®¡é“æ¨¡å¼**|æŠŠå‡½æ•°ä½œä¸ºæ­¥éª¤ï¼Œç»„åˆæˆä¸€ä¸ªæµç¨‹|é€»è¾‘æ¸…æ™°ï¼Œå¯å¤ç”¨|éœ€è¦ä¸€å®šæŠ½è±¡èƒ½åŠ›|
|4. ä½¿ç”¨Â **è£…é¥°å™¨/ä¸­é—´ä»¶æ¨¡å¼**|åœ¨å‡½æ•°è°ƒç”¨å‰åç»Ÿä¸€å¤„ç†å‚æ•°|ç»Ÿä¸€å¤„ç†é€»è¾‘ï¼Œè§£è€¦|ç†è§£æˆæœ¬ç•¥é«˜|
|5. ä½¿ç”¨Â **æ•°æ®ç»“æ„ï¼ˆå¦‚å­—å…¸ã€ç±»ï¼‰**|æŠŠå‚æ•°ç»Ÿä¸€ä¸ºç»“æ„ä½“|ç®€æ´ï¼Œæ˜“äºæ‰©å±•|éœ€è§„èŒƒå‘½å|
|6. ä½¿ç”¨Â **äº‹ä»¶é©±åŠ¨/è§‚å¯Ÿè€…æ¨¡å¼**|é€šè¿‡äº‹ä»¶è§¦å‘å‡½æ•°|è§£è€¦é€»è¾‘ï¼Œé€‚åˆå¤æ‚æµç¨‹|å­¦ä¹ æˆæœ¬è¾ƒé«˜|

---

## âœ… æ¨èæ–¹æ¡ˆï¼šä½¿ç”¨Â **ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆContext Objectï¼‰**

### âœ… ç¤ºä¾‹ï¼šå°è£…ä¸€ä¸ªÂ `Context`Â ç±»

`class Context:     def __init__(self, app, main_workbook, product_name, single_name, category_name, amount, **kwargs):         self.app = app        self.main_workbook = main_workbook        self.product_name = product_name        self.single_name = single_name        self.category_name = category_name        self.amount = amount        self.month = kwargs.get('month')         self.day = kwargs.get('day')         self.unit_name = kwargs.get('unit_name')         self.row_data = kwargs.get('row_data')         self.header_index = kwargs.get('header_index')         self.remark = kwargs.get('remark')         self.quantity = kwargs.get('quantity')         self.price = kwargs.get('price')         self.company_name = kwargs.get('company_name')         # å¯æ‰©å±•å…¶ä»–å­—æ®µ...     def update(self, **kwargs):         for key, value in kwargs.items():             if hasattr(self, key):                 setattr(self, key, value)`

### âœ… ä½¿ç”¨æ–¹å¼

python

`context = Context(     app=app,     main_workbook=main_workbook,     product_name=product_name,     single_name=single_name,     category_name=category_name,     amount=amount,     month=month,     day=day,     unit_name=unit_name,     row_data=row_data,     header_index=header_index,     remark=remark,     quantity=quantity,     price=price,     company_name=company_name ) # ä¼ é€’ context åˆ°ä¸‹ä¸€å±‚å‡½æ•° update_company_sheet(context) updata_import_sheet(context) update_inventory_sheet(context)`

### âœ… å‡½æ•°å®šä¹‰

python

`def update_company_sheet(context):     print(f"Updating company sheet for {context.product_name}")     # ä½¿ç”¨ context.amount, context.company_name ç­‰å­—æ®µ def updata_import_sheet(context):     print(f"Updating import sheet for {context.single_name}")     # å¯ä»¥ä¿®æ”¹ context ä¸­çš„å­—æ®µ     context.month = 6  # ä¿®æ”¹åï¼Œåç»­å‡½æ•°ä¹Ÿèƒ½è¯»åˆ°`

---

## âœ… ä¼˜ç‚¹æ€»ç»“

|ä¼˜ç‚¹|è¯´æ˜|
|---|---|
|**å‚æ•°é›†ä¸­ç®¡ç†**|æ‰€æœ‰å‚æ•°éƒ½åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œé¿å…äº†å±‚å±‚ä¼ é€’|
|**æ˜“äºæ‰©å±•**|æ–°å¢å­—æ®µåªéœ€åœ¨Â `Context`Â ä¸­æ·»åŠ ï¼Œä¸å½±å“å·²æœ‰å‡½æ•°|
|**å¯è¯»æ€§å¼º**|å‡½æ•°ç­¾åç®€æ´ï¼Œé€»è¾‘æ¸…æ™°|
|**ä¾¿äºè°ƒè¯•**|æ‰“å°æ•´ä¸ªÂ `context`Â å³å¯æŸ¥çœ‹å½“å‰çŠ¶æ€|
|**æ”¯æŒé“¾å¼æ›´æ–°**|å‡½æ•°å¯ä»¥ä¿®æ”¹Â `context`ï¼Œåç»­å‡½æ•°è‡ªåŠ¨æ„ŸçŸ¥å˜åŒ–|

---

## âœ… å¯é€‰è¿›é˜¶ï¼šç»“åˆè£…é¥°å™¨è‡ªåŠ¨æ³¨å…¥ä¸Šä¸‹æ–‡

python

`def inject_context(func):     def wrapper(context: Context):         return func(context)     return wrapper @inject_context def update_company_sheet(context: Context):     print(f"Updating company sheet for {context.product_name}")`

è¿™æ ·å¯ä»¥ç»Ÿä¸€å‡½æ•°ç­¾åï¼Œæé«˜ä¸€è‡´æ€§ã€‚

---

## âœ… å¯é€‰è¿›é˜¶ï¼šä½¿ç”¨Â `dataclass`Â ç®€åŒ–å®šä¹‰

python

`from dataclasses import dataclass @dataclass class Context:     app: object     main_workbook: object     product_name: str     single_name: str     category_name: str     amount: float     month: int = None     day: int = None     unit_name: str = None     row_data: list = None     header_index: dict = None     remark: str = None     quantity: float = None     price: float = None     company_name: str = None`

è¿™æ ·å¯ä»¥çœç•¥æ„é€ å‡½æ•°ï¼Œè‡ªåŠ¨æ”¯æŒé»˜è®¤å€¼ã€ç±»å‹æç¤ºç­‰ã€‚

---

## âœ… å¯é€‰è¿›é˜¶ï¼šä½¿ç”¨Â `State Management`ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰

å¦‚æœä½ çš„é¡¹ç›®è§„æ¨¡è¿›ä¸€æ­¥æ‰©å¤§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ï¼š

- **PyState**ï¼ˆç±»ä¼¼ Reduxï¼‰
- **äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰**
- **çŠ¶æ€å®¹å™¨ï¼ˆState Containerï¼‰**

è¿™ç±»æ–¹æ¡ˆå¯ä»¥å®ç°ï¼š

- å…¨å±€çŠ¶æ€ç»Ÿä¸€ç®¡ç†ï¼›
- å‡½æ•°é—´é€šè¿‡ç›‘å¬äº‹ä»¶æˆ–è¯»å–çŠ¶æ€é€šä¿¡ï¼›
- æ— éœ€å±‚å±‚ä¼ å‚ï¼Œä¹Ÿä¸ä¾èµ–åµŒå¥—è°ƒç”¨ã€‚

---

## âœ… ç¤ºä¾‹é‡æ„å‰åå¯¹æ¯”

### âŒ åŸå§‹æ–¹å¼ï¼ˆåµŒå¥— + ä¼ å‚å¤šï¼‰

python

`update_company_sheet(self, main_workbook, product_name, company_name, amount) updata_import_sheet(self, main_workbook, product_name, single_name, row_data, header_index, month, day, unit_name)`

### âœ… é‡æ„åæ–¹å¼ï¼ˆç»Ÿä¸€ Contextï¼‰

python

`context = Context(...) update_company_sheet(context) updata_import_sheet(context)`

---

## âœ… æœ€ä½³å®è·µå»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨ Context ç±»**ï¼šå°†åµŒå¥—å‚æ•°å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼›
2. **é¿å…å…¨å±€å˜é‡æ»¥ç”¨**ï¼šé™¤éæ˜¯çœŸæ­£å…¨å±€é…ç½®ï¼›
3. **ç»Ÿä¸€æ¥å£è®¾è®¡**ï¼šæ‰€æœ‰å‡½æ•°éƒ½æ¥å—Â `context`Â ä½œä¸ºå”¯ä¸€å‚æ•°ï¼›
4. **ä½¿ç”¨Â `dataclass`**ï¼šæé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼›
5. **é€‚å½“ä½¿ç”¨è£…é¥°å™¨**ï¼šç»Ÿä¸€å‡½æ•°ç­¾åï¼Œå‡å°‘é‡å¤é€»è¾‘ï¼›
6. **é€æ­¥é‡æ„**ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§é‡å†™æ‰€æœ‰å‡½æ•°ï¼Œå¯ä»¥é€æ­¥æ›¿æ¢ï¼›
7. **ä¿ç•™åŸå§‹å‡½æ•°ä½œä¸ºé€‚é…å™¨**ï¼ˆå¯é€‰ï¼‰ï¼š
    
    python
    
    `def update_company_sheet(context):     _update_company_sheet(context.app, context.main_workbook, context.product_name, ...)`
    

---

## âœ… æ€»ç»“

|é—®é¢˜|è§£å†³æ–¹æ¡ˆ|
|---|---|
|å‡½æ•°åµŒå¥—æ·±ã€ä¼ å‚å¤š|ä½¿ç”¨Â `Context`Â ç±»å°è£…å‚æ•°|
|å‚æ•°ä¿®æ”¹å½±å“å¤šå±‚å‡½æ•°|`Context`Â æ”¯æŒåŠ¨æ€æ›´æ–°|
|å¯è¯»æ€§å·®|`Context`Â +Â `dataclass`Â æé«˜å¯è¯»æ€§|
|ç»´æŠ¤æˆæœ¬é«˜|ç»Ÿä¸€æ¥å£ï¼Œå‡½æ•°åªæ¥å—Â `context`|

---

å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ æŠŠå½“å‰ä»£ç ç»“æ„ä¸­æŸæ®µå‡½æ•°é“¾ç”¨Â `Context`Â æ¨¡å¼é‡æ„ï¼Œæˆ‘å¯ä»¥æä¾›å®Œæ•´çš„ä»£ç è¿ç§»æ–¹æ¡ˆã€‚æ¬¢è¿ç»§ç»­æé—®ï¼