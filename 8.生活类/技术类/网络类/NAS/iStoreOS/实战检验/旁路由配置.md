# 物理机&双网口&单路由
## 1. 背景
双网口路由器不想作为家庭主干网络信息流必经之路的一部分，因为这样一旦该NAS出现故障会导致整个网络无法正常使用。并且如果该路由器开启了VPN服务，则主干网络中的部分包会被错误转发造成部分游戏无法正常游玩的情况发生，这样会给家里不需要这个服务的人带来不便，故此研究旁路由方案。

>优点：旁路由模式下，iStoreOS 只为特定设备提供代理，不影响未手动配置网关的网络设备，这样即使出现异常也不会导致全军覆没。

## 2. 知识

### 2.1 旁路由
- 参考：[旁路由是什么？OpenWrt作为旁路由配置举例-腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/2465061)

> 旁路由： 旁路由其实并不是路由，路由是用来连接不同网络的，最常用的就是用来连接互联网和局域网。旁路由起到的主要是网关的作用，是用来分流数据和扩展插件的。因此，严谨一点的叫法应该是**旁路网关**，只是大家好像约定俗成了都叫做旁路由，所以我们这里也跟着叫旁路由，但是要明白它的核心是网关而不是路由。

![1736319628423.png](https://www.helloimg.com/i/2025/01/08/677e220c99eb1.png)


> **解释**：如图所示，对于普通流量，由于旁路由不修改任何内容，我们期望旁路由只转发上行数据，而下行数据由主路由直接发送给主机。对于需要代理的流量，则下行数据也得交给旁路由处理，然后才能转发给主机。

>**总结**：所有流量必须走主路由，但是旁路由我们得手动指定客户端的代理为旁路由，这样经过主路由的流量还会经过旁路由处理一遍，再转发给客户端。在这个角度上旁路由相当于多走了一此转发。

>**注意**：旁路由可以只有一个物理LAN接口，但是通过一个LAN物理接口可以引申出多个LAN虚拟接口


## 3. 配置

### 3.1 自动配置
我们希望静态配置 iStoreOS 的 IP 地址，需要先访问 DHCP 得到的地址配置路由，修改 IP 地址并设置旁路由模式，iStoreOS 的默认账户密码为：root/password

我们在网络向导中选择 **旁路由 -> 手动配置 -> 配置旁路由**：

![alt text](https://wiki.wbuntu.com/linux/pve/6-istoreos-as-bypass-router/img-005.png)

![alt text](https://wiki.wbuntu.com/linux/pve/6-istoreos-as-bypass-router/img-006.png)

![alt text](https://wiki.wbuntu.com/linux/pve/6-istoreos-as-bypass-router/img-007.png)

这里设置静态 IP 为 192.168.1.3，子网掩码为 255.255.255.0，网关地址（即主路由地址）为 192.168.1.1，关闭 **提供DHCPv4 服务**（继续由主路由提供 DHCP 服务），启用 **自动获取 IPv6**，保存后会应用配置，等待配置完成就可以使用 192.168.1.3 访问 iStoreOS：

![alt text](https://wiki.wbuntu.com/linux/pve/6-istoreos-as-bypass-router/img-008.png)


### 3.2 手动配置

- 获取上有路由器地址：用作此NAS的DNS地址





- 